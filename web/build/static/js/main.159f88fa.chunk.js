(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1219:function(e,t,a){},1225:function(e,t,a){},1230:function(e,t,a){"use strict";a.r(t);a(673);var n=a(40),r=a(0),i=a.n(r),l=a(81),s=a.n(l),o=a(22),c=a(23),d=a(25),u=a(24),m=a(26),h=(a(309),a(1243)),p=a(1245),f=a(1242),b=(a(74),a(41)),g=a(15),y=a(1244),E=(a(133),a(70)),v=(a(688),a(645)),S=(a(134),a(21)),k=(a(279),a(209)),I=(a(280),a(151)),C=(a(281),a(67)),D=(a(96),a(10)),O=(a(108),a(35)),x=a(608),w=a(609),j=a(610),T=a(611),L=a(1241),M={topMenus:[{menuTitle:"\u6211\u7684",icon:"user",subMenus:[{title:"\u4fee\u6539\u5bc6\u7801",route:"/admin/permission/password"},{title:"\u9000\u51fa",route:"/admin/logout"}]}],sideMenus:[{menuTitle:"\u4e91\u8d44\u6e90",icon:"CloudServerOutlined",subMenus:[{title:"\u670d\u52a1\u5668",route:"/admin/cloud_resource/cloud_server"},{title:"\u6570\u636e\u5e93",route:"/admin/cloud_resource/cloud_rds"},{title:"KV-Store",route:"/admin/cloud_resource/cloud_kv"},{title:"\u8d1f\u8f7d\u5747\u8861",route:"/admin/cloud_resource/cloud_slb"},{title:"\u5176\u5b83\u8d44\u6e90",route:"/admin/cloud_resource/cloud_other"},{title:"\u4e91\u8d26\u53f7",route:"/admin/cloud_resource/cloud_account"}]},{menuTitle:"\u5de5\u4f5c\u534f\u52a9",icon:"TeamOutlined",subMenus:[{title:"\u63d0\u4ea4\u5de5\u5355",route:"/admin/task/deploy_project"},{title:"\u5de5\u5355\u5217\u8868",route:"/admin/task/jobs"}]},{menuTitle:"DMS\u64cd\u4f5c",icon:"DatabaseOutlined",subMenus:[{title:"\u5b9e\u4f8b\u7ba1\u7406",route:"/admin/dms/instance_manage"},{title:"\u6743\u9650\u7ba1\u7406",route:"/admin/dms/auth_manage"},{title:"\u6570\u636e\u64cd\u4f5c",route:"/admin/dms/data_manage"}]},{menuTitle:"CI & CD",icon:"GitlabOutlined",subMenus:[]},{menuTitle:"Kubernetes",icon:"ClusterOutlined",subMenus:[{title:"\u96c6\u7fa4\u7ba1\u7406",route:"/admin/k8s_cluster/info"}]},{menuTitle:"\u6570\u636e\u7ba1\u7406",icon:"DatabaseOutlined",subMenus:[{title:"\u963f\u91cc\u4e91",route:"/admin/data/syncAliyun"}]},{menuTitle:"\u6743\u9650\u7ba1\u7406",icon:"KeyOutlined",subMenus:[{title:"\u7528\u6237\u7ba1\u7406",route:"/admin/permission/users"},{title:"\u89d2\u8272\u7ba1\u7406",route:"/admin/permission/roles"},{title:"\u6743\u9650\u94fe\u63a5",route:"/admin/permission/permissions"}]},{menuTitle:"\u7cfb\u7edf\u7ba1\u7406",icon:"GroupOutlined",subMenus:[{title:"\u7528\u6237\u53cd\u9988",route:"/admin/system/user_feedback"}]}],noAuthMenus:["/admin/task/deploy_project","/admin/task/jobs"]},A=a(277),_=a.n(A);_.a.interceptors.request.use(function(e){return e}),_.a.interceptors.response.use(function(e){return e});var R="ws://commonops.com:9999/";_.a.defaults.headers.post["Content-Type"]="application/json";var N=_.a.create({baseURL:"http://commonops.com:9999/",timeout:7e3,withCredentials:!1});N.interceptors.request.use(function(e){return e.headers.Authorization=localStorage.getItem("ops_token"),e.headers.ClusterId=localStorage.getItem("clusterId"),e},function(e){return Promise.reject(e)}),N.interceptors.response.use(function(e){return e.data},function(e){var t=e.response.status;switch(console.log(e),t){case 400:D.b.error("[400]\u5ba2\u6237\u7aef\u8bf7\u6c42\u53c2\u6570\u9519\u8bef");break;case 401:window.location.href="/login?code=401";break;case 403:window.location.href="/login?code=403";break;case 500:D.b.error("[500]\u670d\u52a1\u5f02\u5e38\uff0c\u8bf7\u8054\u7cfb\u8fd0\u7ef4\u5904\u7406"),this.props.history.push("/exception500");break;default:D.b.error("\u670d\u52a1\u5f02\u5e38\uff0c\u8bf7\u8054\u7cfb\u8fd0\u7ef4\u5904\u7406")}return Promise.reject(e)});var z=function(e,t,a){return new Promise(function(n,r){N({method:"get",url:e,params:t,timeout:a}).then(function(e){n(e)}).catch(function(e){D.b.error(e.toLocaleString()),console.log(e,"\u5f02\u5e38")})})},P=function(e,t,a){return new Promise(function(n,r){N({method:"post",url:e,data:t,timeout:a}).then(function(e){n(e)}).catch(function(e){D.b.error(e.toString()),console.log(e,"\u5f02\u5e38")})})},V=function(e,t,a){return new Promise(function(n,r){N({method:"put",url:e,data:t,timeout:a}).then(function(e){n(e)}).catch(function(e){D.b.error(e.toLocaleString()),console.log(e,"\u5f02\u5e38")})})},B=function(e,t,a){return new Promise(function(n,r){N({method:"delete",url:e,data:t,timeout:a}).then(function(e){n(e)}).catch(function(e){D.b.error(e.toLocaleString()),console.log(e,"\u5f02\u5e38")})})},q=function(e,t){return z("user/list",{page:e,size:t})},Y=function(e){return P("user/updatePassword",e)},F=b.a.Header,U=O.a.TextArea,K=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).showFeedbackModal=a.showFeedbackModal.bind(Object(g.a)(a)),a.handleOk=a.handleOk.bind(Object(g.a)(a)),a.handleCancel=a.handleCancel.bind(Object(g.a)(a)),a.formRef=i.a.createRef(),a.state={feedbackModalVisible:!1},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"showFeedbackModal",value:function(){this.setState({feedbackModalVisible:!0})}},{key:"handleOk",value:function(){var e=this;this.formRef.current.validateFields().then(function(t){var a;(a=t,P("user/feedback",a)).then(function(t){0===t.code?(e.setState({feedbackModalVisible:!1}),D.b.success("\u5df2\u7ecf\u6536\u5230\u60a8\u7684\u53cd\u9988\uff01")):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})})}},{key:"handleCancel",value:function(){this.setState({feedbackModalVisible:!1})}},{key:"render",value:function(){var e=i.a.createElement(C.a,null,M.topMenus.map(function(e){return e.subMenus.map(function(e){return i.a.createElement(C.a.Item,{key:e.title},i.a.createElement(L.a,{to:e.hasOwnProperty("route")?e.route:""},e.title))})}));return i.a.createElement(F,{style:{background:"#fff",padding:0}},i.a.createElement("div",{style:{background:"#001529"}},i.a.createElement("span",{style:{color:"#fff",paddingLeft:"2%",fontSize:"1.4em"}},this.props.menuCollapsed?i.a.createElement(x.a,{className:"trigger",onClick:this.props.handleSiderMenu,style:{cursor:"pointer"}}):i.a.createElement(w.a,{className:"trigger",onClick:this.props.handleSiderMenu,style:{cursor:"pointer"}})),i.a.createElement("span",{style:{color:"#fff",fontSize:"1.4em",float:"right",cursor:"pointer",width:"30px",textAlign:"center",marginLeft:"20px",marginRight:"30px"}},i.a.createElement(I.a,{overlay:e,overlayStyle:{width:"150px"}},i.a.createElement(j.a,null))),i.a.createElement("span",{style:{color:"#fff",fontSize:"1.4em",float:"right",cursor:"pointer",width:"30px",textAlign:"center"},onClick:this.showFeedbackModal},i.a.createElement(k.a,{content:"\u63d0\u4ea4\u9700\u6c42\u53cd\u9988"},i.a.createElement(T.a,null))),i.a.createElement(E.a,{title:"\u300cBug & \u9700\u6c42\u300d\u53cd\u9988",destroyOnClose:!0,visible:this.state.feedbackModalVisible,onOk:this.handleOk,onCancel:this.handleCancel,width:700},i.a.createElement(S.a,Object.assign({},{labelCol:{span:5},wrapperCol:{span:17}},{ref:this.formRef}),i.a.createElement(S.a.Item,{label:"\u53cd\u9988\u5185\u5bb9",name:"advice",rules:[{required:!0,message:"\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a"}]},i.a.createElement(U,{rows:4})),i.a.createElement(S.a.Item,{label:"\u5f53\u524d\u7248\u672c\u6ee1\u610f\u5ea6",name:"score",rules:[{required:!0,message:"\u8bf7\u5bf9\u5f53\u524d\u7248\u672c\u8fdb\u884c\u6253\u5206"}]},i.a.createElement(v.a,{tooltips:["\u96be\u7528","\u4e0d\u597d\u7528","\u4f53\u9a8c\u4e00\u822c","\u4f53\u9a8c\u826f\u597d","\u975e\u5e38\u68d2"]}))))))}}]),t}(r.Component),H=Object(y.a)(K),J=a(127),G=b.a.Sider,Q=C.a.SubMenu,W=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={authList:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){var e=this;z("user/permissions").then(function(t){if(0===t.code){var a=t.data,n=[];a.map(function(e){return n.push(e.urlPath)}),e.setState({authList:n})}else D.b.error("\u83b7\u53d6\u7528\u6237\u83dc\u5355\u6743\u9650\u5f02\u5e38")}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"hasSubMenusAllowed",value:function(e){var t=this,a=!1;return e.map(function(e){return t.state.authList.indexOf(e.route)>-1||M.noAuthMenus.indexOf(e.route)>-1?a=!0:null}),a}},{key:"hasMenuAllowed",value:function(e){return this.state.authList.indexOf(e)>-1||M.noAuthMenus.indexOf(e)>-1}},{key:"render",value:function(){var e=this;return i.a.createElement(G,{trigger:null,collapsed:this.props.menuCollapsed,style:{textAlign:"center"}},i.a.createElement("span",{className:"logo",style:(this.props.menuCollapsed,{backgroundSize:"80%"})}),i.a.createElement("span",{className:"logo-text",style:this.props.menuCollapsed?{display:"none"}:{}},"\u8fd0\u7ef4\u5e73\u53f0"),i.a.createElement(C.a,{theme:"dark",mode:"inline",style:{textAlign:"left"}},M.sideMenus.map(function(t){if(t.subMenus.length&&e.hasSubMenusAllowed(t.subMenus)){var a=i.a.createElement(J[t.icon]);return i.a.createElement(Q,{key:t.menuTitle,title:i.a.createElement("span",null,a,i.a.createElement("span",null,t.menuTitle))},t.subMenus.map(function(t){return e.hasMenuAllowed(t.route)?i.a.createElement(C.a.Item,{key:t.title},i.a.createElement(L.a,{to:t.route},t.title)):null}))}return null})))}}]),t}(r.Component),Z=(a(135),a(72)),$=b.a.Footer,X=Z.a.Text,ee=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={currentYear:(new Date).getFullYear()},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement($,{style:{textAlign:"center",padding:"15px 50px"}},"\xa92019-",this.state.currentYear," Created by \xa0",i.a.createElement(k.a,{content:i.a.createElement("div",{className:"wechat"})},i.a.createElement(X,{underline:!0},"KevinYang")))}}]),t}(r.Component),te=b.a.Content,ae=function(e){function t(){return Object(o.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(te,{style:{height:"100%"}},i.a.createElement("div",{className:"welcome-ad"}))}}]),t}(r.Component),ne=(a(146),a(73)),re=(a(233),a(156)),ie=(a(163),a(19)),le=(a(186),a(87)),se=(a(218),a(45)),oe=(a(102),a(36)),ce=(a(109),a(20)),de=(a(187),a(114)),ue=(a(171),a(86)),me=(a(89),a(16)),he=(a(350),a(176)),pe=(a(169),a(92)),fe=a(43),be=(a(219),a(106)),ge=(a(248),a(130)),ye=(a(177),a(65)),Ee=(a(188),a(94)),ve=a(614),Se=a(613),ke=a(619),Ie=a(617),Ce=(a(889),a(506)),De=function(e){function t(){return Object(o.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(Ce.a,{style:{margin:"5px 0px 10px 0px"}},this.props.pathData.map(function(e){return i.a.createElement(Ce.a.Item,{key:e},e)}))}}]),t}(r.Component);De.defaultProps={pathData:[]};var Oe=De,xe=a(56),we=a.n(xe),je=function(e){return z("cloud/servers",e)},Te=function(e){return z("cloud/servers/"+e)},Le=function(e,t){return z("cloud/accounts",{page:e,size:t})},Me=function(e){return P("cloud/accounts",e)},Ae=function(e){return V("cloud/accounts",e)},_e=function(e){return B("cloud/accounts",e)},Re=function(e,t,a){return z("cloud/monitor/ecs",{instanceId:e,timeDimension:t,metricDimension:a})},Ne=function(e,t,a){return z("cloud/monitor/rds",{instanceId:e,timeDimension:t,metricDimension:a})},ze=function(e,t,a){return z("cloud/monitor/kv",{instanceId:e,timeDimension:t,metricDimension:a})},Pe=function(e,t,a){return z("cloud/monitor/slb",{instanceId:e,timeDimension:t,metricDimension:a})},Ve=function(e){return z("cloud/rds",e)},Be=function(e){return z("cloud/kv",e)},qe=function(e){return z("cloud/slb",e)},Ye=function(e){return z("cloud/rds/"+e)},Fe=function(e){return z("cloud/kv/"+e)},Ue=function(e){return z("cloud/slb/"+e)},Ke=function(e){return z("cloud/other",e)};a(473);we.a.locale("zh-cn");var He=[{label:"\u6765\u6e90",key:"resForm",type:"input",disabled:!0},{label:"\u5b9e\u4f8bId",key:"instanceId",type:"input"},{label:"\u5b9e\u4f8b\u540d\u79f0",key:"instanceName",type:"input"},{label:"\u5185\u7f51ip",key:"innerIpAddress",type:"input"},{label:"\u5916\u7f51ip",key:"publicIpAddress",type:"input"},{label:"\u79c1\u6709ip",key:"privateIpAddress",type:"input"},{label:"CPU",key:"cpu",type:"input"},{label:"\u5185\u5b58(G)",key:"memory",type:"input"},{label:"\u8fc7\u671f\u65f6\u95f4",key:"expiredTime",type:"date_input"},{label:"SSH Port",key:"sshPort",type:"input"},{label:"SSH \u7528\u6237",key:"sshUser",type:"input"},{label:"SSH \u5bc6\u7801",key:"sshPwd",type:"input"}],Je=[{label:"\u6765\u6e90",key:"resForm",type:"input",disabled:!0},{label:"\u5b9e\u4f8b\u540d\u79f0",key:"dbInstanceDescription",type:"input"},{label:"\u5185\u5b58(G)",key:"dbMemory",type:"input"},{label:"\u78c1\u76d8(G)",key:"dbInstanceStorage",type:"input"},{label:"\u8fc7\u671f\u65f6\u95f4",key:"dbExpiredTime",type:"date_input"}],Ge=[{label:"\u6765\u6e90",key:"resForm",type:"input",disabled:!0},{label:"\u5b9e\u4f8b\u540d\u79f0",key:"kvInstanceName",type:"input"},{label:"\u5e26\u5bbd",key:"kvBandwidth",type:"input"},{label:"\u5bb9\u91cf(G)",key:"kvCapacity",type:"input"},{label:"\u8fc7\u671f\u65f6\u95f4",key:"kvExpiredTime",type:"date_input"}],Qe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).handleOk=a.handleOk.bind(Object(g.a)(a)),a.handleCancel=a.handleCancel.bind(Object(g.a)(a)),a.switchChange=a.switchChange.bind(Object(g.a)(a)),a.formRef=i.a.createRef(),a.state={usersData:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.generateBaseInfoForm()}},{key:"switchChange",value:function(e){this.setState({renewSwitch:e})}},{key:"handleOk",value:function(){var e=this;this.formRef.current.validateFields().then(function(t){"expiredTime"in t&&(t.expiredTime=we()(t.expiredTime).format("YYYY-MM-DD 00:00:00")),"dbExpiredTime"in t&&(t.dbExpiredTime=we()(t.dbExpiredTime).format("YYYY-MM-DD 00:00:00")),"kvExpiredTime"in t&&(t.kvExpiredTime=we()(t.kvExpiredTime).format("YYYY-MM-DD 00:00:00")),e.props.handleOk(t)})}},{key:"handleCancel",value:function(){this.formRef.current.resetFields(),this.props.handleCancel()}},{key:"getInputItem",value:function(e,t){var a=i.a.createElement(O.a,null);switch(e.type){case"input":a=i.a.createElement(O.a,{disabled:e.disabled||t});break;case"date_input":a=i.a.createElement(be.a,{format:"YYYY-MM-DD",disabled:e.disabled||t})}return a}},{key:"generateBaseInfoForm",value:function(){var e=this;if("single"!==this.props.updateMode)return"";var t=this.props.resType,a=[],n={labelCol:{span:7},wrapperCol:{span:17}},r=[];switch(t){case"ecs":r=He;break;case"rds":r=Je;break;case"kv":r=Ge}var l=r.map(function(t,a){var r=a%2===0?0:1;return i.a.createElement(ce.a,{span:11,offset:r,key:t.key},i.a.createElement(S.a.Item,Object.assign({},n,{label:t.label,name:t.key,rules:[{required:t.required,message:"\u8be5\u503c\u4e3a\u5fc5\u586b\u9879\uff01"}]}),e.getInputItem(t,!1)))});return a.push(l),i.a.createElement("div",null,i.a.createElement(ue.a,{orientation:"left",style:{marginTop:"0px",color:"rgb(255, 80, 23)"}},"\u57fa\u672c\u4fe1\u606f"),i.a.createElement(oe.a,{gutter:12},a))}},{key:"render",value:function(){return i.a.createElement(E.a,{visible:this.props.visible,destroyOnClose:!0,title:"\u5b8c\u5584\u8d44\u6e90\u4fe1\u606f",onOk:this.handleOk,onCancel:this.handleCancel,centered:!0,width:700},i.a.createElement(S.a,Object.assign({ref:this.formRef},{labelCol:{span:7},wrapperCol:{span:14}},{initialValues:this.props.editData}),this.generateBaseInfoForm()))}}]),t}(r.Component),We=a(382),Ze=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).id=a.uuid(),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"uuid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},{key:"componentDidMount",value:function(){var e=this,t=this.id,a=this.props.data,n=this.props.xField?this.props.xField:"date",r=this.props.yField?this.props.yField:"value";setTimeout(function(){e.line=new We.Line(t,{data:a,width:e.props.width,height:e.props.height,padding:"auto",xField:n,yField:r,meta:{yField:{}}}),e.line.render()},300)}},{key:"componentDidUpdate",value:function(){var e=this;setTimeout(function(){return e.line.changeData(e.props.data)},400)}},{key:"render",value:function(){return i.a.createElement("div",{id:this.id,style:{height:this.props.height,width:this.props.width}})}}]),t}(r.Component),$e=a(458),Xe=function(){return i.a.createElement("svg",{width:"15px",height:"15px",t:"1562667653974",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2507"},i.a.createElement("path",{d:"M486.4 134.4L960 64v422.4H486.4V134.4z",fill:"#90C300","p-id":"2508"}),i.a.createElement("path",{d:"M64 198.4l358.4-51.2v345.6H64V198.4z",fill:"#F8672C","p-id":"2509"}),i.a.createElement("path",{d:"M486.4 889.6L960 960V550.4H486.4v339.2z",fill:"#FFC400","p-id":"2510"}),i.a.createElement("path",{d:"M64 825.6l358.4 51.2V550.4H64v275.2z",fill:"#00B4F2","p-id":"2511"}))},et=function(){return i.a.createElement("svg",{t:"1562667694279",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3672",width:"15px",height:"15px"},i.a.createElement("path",{d:"M839.73005 769.44c9.3-20 13.6-48 13.6-86.78 0-138.52-63.82-218.44-115.08-282.66-31.04-38.9-55.58-69.62-55.58-101.34v-10c0.32-58.88 1.02-181.48-64-246.94C591.05005 14 555.19005 0 511.99005 0c-89.62 0-149.32 43.54-149.32 256 0 58.48-24.62 106.38-50.66 157.08-11.4 22.24-23.22 45.24-33.12 69.54C259.19005 531.08 213.33005 649.68 213.33005 704a21.4 21.4 0 0 0 2.44 10l151 288a21.4 21.4 0 0 0 16.38 11.1 21.4 21.4 0 0 0 18.64-7.06c9.48-10.56 72.32-24.56 110.2-24.56h144.74a21.4 21.4 0 0 0 14.88-6l175.26-170.68a21.34 21.34 0 0 0-7.14-35.18z",fill:"#1A1A1A","p-id":"3673"}),i.a.createElement("path",{d:"M688.19005 717.3c-0.52-103.88-14.64-220.72-96.72-388.52C550.85005 356.26 476.29005 378 467.33005 378c-16.16 0-51.42-11.54-77.34-34.4-10.64 31.42-25.38 60.52-40 89-11 21.4-22.36 43.54-31.54 66.12C292.65005 562 263.19005 645.46 257.33005 689.78c18 12 30.64 38 44.54 67.14 14.4 30.12 30.7 64.26 51.72 78.92 38.48 26.78 58.42 64.98 63.64 99.68 14.64 1.46 33.1 2.72 54 2.72 52 0 122.6-10.56 174.82-42.24 2.9-56.44 12.82-146.96 42.14-178.7z",fill:"#FFFFFF","p-id":"3674"}),i.a.createElement("path",{d:"M892.85005 813.84c-8.84-5.8-18-11.8-24.44-18.26-3.76-3.76-2-21.2-1.12-30.58 1.76-18 3.6-36.58-8.5-50-4.56-5.04-12.94-11.06-26.8-11.06-11.4 0-19.74 9.04-20.24 20.44 0 0.3 0.12 0.58 0.12 0.9H725.33005A21.32 21.32 0 0 0 703.99005 704c-63.26 0-64 232.32-64.24 237.4-1.2 12.72-4 42.58 15.12 63.54 11.52 12.64 28 19.06 49.12 19.06 55.38 0 82.24-28.54 108.2-56.12 4.36-4.68 8.84-9.42 13.56-14.12 10.8-10.82 32-18.54 50.62-25.34 30.62-11.2 62.3-22.76 62.3-53.76s-25.34-47.44-45.82-60.82zM353.51005 835.84c-21.02-14.66-37.32-48.8-51.72-78.92-19.04-39.84-35.5-74.26-67.12-74.26-40 0-48.66 35.88-53.32 55.16-1.3 5.3-3.24 13.3-3.44 14.24-3.16 2-15.08 4.32-22.96 5.88C128.91005 763.1 85.33005 771.72 85.33005 810.66a162.48 162.48 0 0 0 3.54 30.98C92.17005 859.4 95.33005 876.14 86.01005 912a20.8 20.8 0 0 0-0.68 5.34c0 51.28 79.66 58 127.28 61.88 8 0.68 14.5 1.18 18.72 1.84 6.56 1.04 20.32 7.38 33.6 13.5C293.33005 1007.68 328.77005 1024 362.67005 1024c24.36 0 43.86-15.76 52.16-42.12 12.9-41.1-4.18-106.28-61.32-146.04z",fill:"#FDB515","p-id":"3675"}),i.a.createElement("path",{d:"M831.99005 661.34a20.64 20.64 0 0 0-10.92 3.44l-142.46-233.1a1140 1140 0 0 0-62.32-142.78 21.32 21.32 0 1 0-38 19.54c96.32 187.16 104.3 304 104.34 415.7-0.26 4.48-1.78 44.44 21.2 68.76a57.3 57.3 0 0 0 42.76 17.76h14.78c21.7 0 45.16-1.66 63.5-19.86 19.72-19.36 28.46-52.8 28.46-108.14a21.32 21.32 0 0 0-21.34-21.32z",fill:"#1A1A1A","p-id":"3676"}),i.a.createElement("path",{d:"M554.67005 129.78c-24.74 0-42.68 26.54-42.68 63.12s18 63.1 42.68 63.1S597.33005 229.46 597.33005 192.9s-18-63.12-42.66-63.12z",fill:"#FFFFFF","p-id":"3677"}),i.a.createElement("path",{d:"M535.31005 208.56a37.9 19.36 90 1 0 38.72 0 37.9 19.36 90 1 0-38.72 0Z","p-id":"3678"}),i.a.createElement("path",{d:"M426.67005 129.78c-24.74 0-42.68 26.54-42.68 63.12s18 63.1 42.68 63.1S469.33005 229.46 469.33005 192.9s-18-63.12-42.66-63.12z",fill:"#FFFFFF","p-id":"3679"}),i.a.createElement("path",{d:"M407.71005 207.82a37.14 18.96 90 1 0 37.92 0 37.14 18.96 90 1 0-37.92 0Z","p-id":"3680"}),i.a.createElement("path",{d:"M494.85005 213.76a21.16 21.16 0 0 0-4.18-0.42c-45.88 0-128 43.02-128 85.32 0 40 80.68 85.34 106.66 85.34 12.6 0 149.34-47.48 149.34-85.34 0-55.8-94.78-79.1-123.82-84.9z",fill:"#FDB515","p-id":"3681"}))},tt=function(){return i.a.createElement("svg",{t:"1570523496603",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1158",width:"20",height:"20"},i.a.createElement("path",{d:"M512 34.133333a486.4 486.4 0 1 0 486.4 486.4A486.4 486.4 0 0 0 512 34.133333z m288.580267 332.552534l-324.266667 347.426133a45.866667 45.866667 0 0 1-64.9216 2.6112 20.334933 20.334933 0 0 1-1.518933-1.518933l-185.258667-185.233067a46.344533 46.344533 0 0 1 65.3568-65.3568l152.541867 151.3472 290.423466-312.2432a46.293333 46.293333 0 1 1 71.68 58.632533 37.0944 37.0944 0 0 1-4.0192 4.343467z m0 0","p-id":"1159",fill:"#1296db"}))},at=function(){return i.a.createElement("svg",{t:"1570523553927",className:"icon",viewBox:"0 0 1160 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1721",width:"20",height:"20"},i.a.createElement("path",{d:"M610.84444476 70.65600031a454.39999969 454.39999969 0 1 1-0.70400062 908.79999938c-140.60800031-3.19999969-261.76000031-62.91199969-361.59999938-177.66399938a31.99999969 31.99999969 0 0 1 48.25599938-41.98400062c88.32 101.50399969 192.64000031 152.89600031 314.04800062 155.64800062a390.40000031 390.40000031 0 1 0-388.992-423.80800031l73.344-73.27999969a31.99999969 31.99999969 0 0 1 48.89599969 40.83199969l-3.648 4.48000031L231.83644476 572.16000031a31.99999969 31.99999969 0 0 1-40.83200062 3.71199938l-4.47999938-3.71199938-108.60800062-108.60800062a31.99999969 31.99999969 0 0 1 40.83200062-48.96l4.47999938 3.71200031 38.33600062 38.4A454.52800031 454.52800031 0 0 1 610.84444476 70.65600031z m0 224.19199969a31.99999969 31.99999969 0 0 1 31.99999969 31.99999969v178.81600031l162.36799969 156.35200031a31.99999969 31.99999969 0 0 1-44.41599938 46.08l-172.16000062-165.76000031a31.99999969 31.99999969 0 0 1-9.792-23.04V326.78400031a31.99999969 31.99999969 0 0 1 32.00000062-32.00000062z",fill:"#d81e06","p-id":"1722"}))},nt=function(){return i.a.createElement("svg",{t:"1569723850164",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"657",width:"30",height:"30"},i.a.createElement("path",{d:"M205.653333 737.066667c-29.184 0-55.637333-23.893333-55.637333-52.906667s23.893333-53.034667 55.68-53.034667c31.914667 0 55.893333 23.893333 55.893333 52.992s-26.538667 52.906667-55.68 52.906667z m683.178667-288.554667c-5.76-42.325333-32-76.8-66.56-103.253333l-13.44-10.666667-10.837333 13.226667c-21.077333 23.893333-29.44 66.261333-26.88 97.92 2.56 23.978667 10.24 47.786667 23.637333 66.304-10.837333 5.546667-24.234667 10.666667-34.56 16.085333a225.706667 225.706667 0 0 1-71.68 10.666667H4.138667l-2.56 15.786666a297.813333 297.813333 0 0 0 23.978666 151.04l10.410667 18.56v2.56c64 105.941333 177.92 153.6 301.994667 153.6 238.677333 0 434.432-103.253333 527.232-325.674666 60.8 2.645333 122.197333-13.226667 151.04-71.509334l7.68-13.226666-12.8-7.978667c-34.56-21.077333-81.92-23.893333-121.6-13.226667l-0.768 0.085334z m-341.674667-42.325333h-103.594666v103.253333h103.68V406.101333l-0.085334 0.128z m0-129.834667h-103.594666v103.253333h103.68V276.48l-0.085334-0.128z m0-132.437333h-103.594666v103.253333h103.68v-103.253333h-0.085334z m126.72 262.272H570.88v103.253333h103.253333V406.101333l-0.298666 0.128z m-383.914666 0H187.008v103.253333h103.338667V406.101333l-0.426667 0.128z m129.28 0h-102.4v103.253333H419.84V406.101333l-0.64 0.128z m-257.28 0H59.733333v103.253333h103.594667V406.101333l-1.28 0.128z m257.28-129.834667h-102.4v103.253333H419.84V276.48l-0.64-0.128z m-129.92 0H187.178667v103.253333H290.133333V276.48l-0.682666-0.128z",fill:"#1296db","p-id":"658"}))},rt=Object($e.a)({scriptUrl:"//at.alicdn.com/t/font_1740765_flmkngup1r.js"}),it=a(393),lt=a(394),st=(a(520),a(395));we.a.locale("zh-cn");var ot=Ee.a.TabPane,ct=Z.a.Text,dt=Z.a.Paragraph,ut=ye.a.Option,mt=b.a.Content,ht=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={cloudAccountList:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;Le(1,100).then(function(t){0===t.code?e.setState({cloudAccountList:t.data.accounts}):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"render",value:function(){var e,t={labelCol:{span:7},wrapperCol:{span:14}};return e=this.state.cloudAccountList.map(function(e){return i.a.createElement(ut,{key:e.id,value:e.id},e.accountName)}),i.a.createElement(E.a,{title:"\u670d\u52a1\u5668\u4fe1\u606f",destroyOnClose:!0,visible:this.props.server_info_modal_visible,onOk:this.props.handlePostServerInfoSubmit,onCancel:this.props.handlePostServerInfoCancel,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",centered:!0,width:600},i.a.createElement(S.a,{ref:this.props.formRef,initialValues:{osType:"linux"}},i.a.createElement(S.a.Item,Object.assign({label:"\u4e91\u8d26\u53f7"},t,{name:"cloudAccountId",rules:[{required:!0,message:"\u4e91\u8d26\u53f7\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(ye.a,null,e)),i.a.createElement(S.a.Item,Object.assign({label:"\u4e3b\u673a\u540d"},t,{name:"hostName"}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u5b9e\u4f8bId"},t,{name:"instanceId"}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u5b9e\u4f8b\u540d\u79f0"},t,{name:"instanceName",rules:[{required:!0,message:"\u5b9e\u4f8b\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u5b9e\u4f8b\u63cf\u8ff0"},t,{name:"description"}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u5185\u7f51IP"},t,{name:"innerIpAddress"}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u5916\u7f51IP"},t,{name:"publicIpAddress"}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u7cfb\u7edf\u7c7b\u578b"},t,{name:"osType",rules:[{required:!0,message:"\u7cfb\u7edf\u7c7b\u578b\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(ye.a,null,i.a.createElement(ut,{value:"linux"},"Linux"),i.a.createElement(ut,{value:"windows"},"Windows"))),i.a.createElement(S.a.Item,Object.assign({label:"CPU\u6838\u6570(\u4e2a)"},t,{name:"cpu",rules:[{type:"integer",required:!0,message:"\u8bf7\u8f93\u5165\u6570\u503c\u578b\u6570\u636e\uff01"}]}),i.a.createElement(ge.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u5185\u5b58(G)"},t,{name:"memory",rules:[{type:"integer",required:!0,message:"\u8bf7\u8f93\u5165\u6570\u503c\u578b\u6570\u636e\uff01"}]}),i.a.createElement(ge.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u78c1\u76d8(G)"},t,{name:"disk",rules:[{type:"integer"}]}),i.a.createElement(ge.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u521b\u5efa\u65f6\u95f4"},t,{name:"createTime",rules:[{required:!0,message:"\u521b\u5efa\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(be.a,{format:"YYYY-MM-DD"})),i.a.createElement(S.a.Item,Object.assign({label:"\u8fc7\u671f\u65f6\u95f4"},t,{name:"expiredTime"}),i.a.createElement(be.a,{format:"YYYY-MM-DD"})),i.a.createElement(S.a.Item,Object.assign({label:"SSH\u767b\u5f55\u7aef\u53e3"},t,{name:"sshPort",rules:[{type:"integer"}]}),i.a.createElement(ge.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"SSH\u767b\u5f55\u7528\u6237"},t,{name:"sshUser"}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"SSH\u767b\u5f55\u5bc6\u7801"},t,{name:"sshPwd"}),i.a.createElement(O.a.Password,{iconRender:function(e){return e?i.a.createElement(ve.a,null):i.a.createElement(Se.a,null)}}))))}}]),t}(r.Component),pt=function(e){function t(e){var a;Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).refreshTableData=function(){a.setState({tableLoading:!0});var e={page:a.state.pagination.page,size:a.state.pagination.pageSize,queryExpiredTime:null===a.state.queryExpiredTime?null:a.state.queryExpiredTime.format("YYYY-MM-DD HH:mm:ss"),queryKeyword:a.state.queryKeyword,queryCloudAccount:a.state.queryCloudAccount};je(e).then(function(e){var t=a.state.pagination;t.total=parseInt(e.data.total),t.page=parseInt(e.data.page),t.showTotal(parseInt(e.data.total)),a.setState({pagination:Object(fe.a)({},t)});for(var n=e.data.servers,r=[],i=0;i<n.length;i++)r.push({key:n[i].ID,ID:n[i].ID,Memory:n[i].Memory/1024,Cpu:n[i].Cpu,HostName:n[i].HostName,InstanceId:n[i].InstanceId,InnerIpAddress:n[i].InnerIpAddress,PublicIpAddress:n[i].PublicIpAddress,PrivateIpAddress:n[i].PrivateIpAddress,InternetMaxBandwidthIn:n[i].InternetMaxBandwidthIn,InternetMaxBandwidthOut:n[i].InternetMaxBandwidthOut,InternetChargeType:n[i].InternetChargeType,InstanceName:n[i].InstanceName,OSType:n[i].OSType,ZoneId:n[i].ZoneId,OSName:n[i].OSName,ExpiredTime:we()(n[i].ExpiredTime).format("YYYY-MM-DD"),Status:n[i].Status,CloudAccountName:n[i].CloudAccountName,DataStatus:n[i].DataStatus,SshPort:n[i].SshPort+"",SshUser:n[i].SshUser,SshPwd:n[i].SshPwd});a.setState({tableData:r,tableLoading:!1})}).catch(function(e){D.b.error(e)})},a.openMonitorDrawer=function(e){a.setState({drawerVisible:!0,instanceId:e.InstanceId,currentServerDetail:e},function(){a.refreshMonitorData(e.InstanceId,a.state.timeTagValue,a.state.metricTagValue),a.refreshSeverDetail()})},a.refreshMonitorData=function(e,t,n){a.setState({chartLoading:!0}),Re(e,t,n).then(function(e){if(0!==e.code)return D.b.error(e.msg),void a.setState({chartLoading:!1});if(""===e.data.Datapoints)return D.b.warn("\u672a\u83b7\u53d6\u5230\u76d1\u63a7\u6570\u636e\uff0c\u53ef\u80fd\u662f\u975e\u963f\u91cc\u4e91\u673a\u5668\u6216\u5176\u5b83\u539f\u56e0\uff01"),void a.setState({chartLoading:!1});for(var t=JSON.parse(e.data.Datapoints),n=[],r=0;r<t.length;r++)n.push({date:we()(t[r].timestamp).format("DD\u65e5HH:mm"),value:t[r].Average});a.setState({chartLoading:!1,chartData:n})}).catch(function(e){D.b.error(e.toLocaleString())})},a.refreshSeverDetail=function(e){a.setState({serverDetailLoading:!0}),Te(a.state.currentServerDetail.ID).then(function(e){0!==e.code&&D.b.error(e.msg),a.setState({currentServerDetail:e.data},function(){a.setState({serverDetailLoading:!1})})}).catch(function(e){D.b.error(e.toLocaleString())})},a.changePage=function(e,t){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e,pageSize:t})},function(){a.refreshTableData()})},a.onCloseDrawer=function(){a.setState({drawerVisible:!1})},a.handleTimeTagChange=function(e){a.setState({timeTagValue:e.target.value}),a.refreshMonitorData(a.state.instanceId,e.target.value,a.state.metricTagValue)},a.handleMetricTagChange=function(e){switch(a.setState({metricTagValue:e.target.value}),e.target.value){case"CPUUtilization":case"memory_usedutilization":case"diskusage_utilization":case"cpu_total":a.setState({chartFormat:"%"});break;default:a.setState({chartFormat:""})}a.refreshMonitorData(a.state.instanceId,a.state.timeTagValue,e.target.value)},a.onExpiredDateChange=function(e){null==e?a.setState({queryExpiredTime:null}):a.setState({queryExpiredTime:e})},a.keywordOnChange=function(e){a.setState({queryKeyword:e.target.value})},a.handleCloudAccountChange=function(e){a.setState({queryCloudAccount:e})},a.handleUserDefineGroupChange=function(e){a.setState({queryDefineGroup:e})},a.handleManageUserChange=function(e){a.setState({queryManageUser:e})},a.handleAdd=function(){a.setState({server_info_modal_visible:!0,ecsId:0})},a.handleQuery=function(){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:1,current:1})},function(){a.refreshTableData()})},a.onSelectChange=function(e){a.setState({selectedRowKeys:e})},a.initTerminal=function(){if(document.getElementById("server_terminal")){a.rws=new st.a(R+"ws/cloud/ssh?serverId="+a.state.currentServerDetail.ID+"&token="+localStorage.getItem("ops_token")),a.terminal=new it.Terminal({rows:36,fontSize:14,cursorBlink:!0,cursorStyle:"block",bellStyle:"sound",theme:"Console"}),a.terminal.prompt=function(){a.terminal.write("\r\n$ ")};var e=new lt.AttachAddon(a.rws);a.terminal.loadAddon(e),a.terminal.open(document.getElementById("server_terminal")),a.terminal.writeln("Welcome to use Web Terminal."),a.terminal.prompt(),a.initWsConnection(),a.terminal.focus(),a.timer||clearTimeout(a.timer)}else a.timer=setTimeout(a.initTerminal,0)},a.handlePostServerInfoSubmit=a.handlePostServerInfoSubmit.bind(Object(g.a)(a)),a.handlePostServerInfoCancel=a.handlePostServerInfoCancel.bind(Object(g.a)(a)),a.handleExtraInfoOk=a.handleExtraInfoOk.bind(Object(g.a)(a)),a.handleExtraInfoCancel=a.handleExtraInfoCancel.bind(Object(g.a)(a));var n=a.props.isSuperAdmin?220:100;return a.formRef=i.a.createRef(),a.state={columns:[{title:"Id",dataIndex:"ID",key:"ID",width:50,render:function(e){return i.a.createElement(ct,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8bid",dataIndex:"InstanceId",key:"InstanceId",width:200},{title:"\u5b9e\u4f8b\u540d\u79f0",dataIndex:"InstanceName",key:"InstanceName",width:200,textWrap:"word-break",render:function(e){return i.a.createElement(pe.a,{title:e},i.a.createElement(ct,{ellipsis:!0,style:{width:"200px"}},e))}},{title:"ip",dataIndex:"ip",key:"ip",width:200,render:function(e,t){var a="",n="",r="";return t.InnerIpAddress&&(a=i.a.createElement("div",null,i.a.createElement(dt,{style:{marginBottom:0,display:"inline"},copyable:""!==t.InnerIpAddress},t.InnerIpAddress),"(\u5185\u7f51)")),t.PrivateIpAddress&&(n=i.a.createElement("div",null,i.a.createElement(dt,{style:{marginBottom:0,display:"inline"},copyable:""!==t.PrivateIpAddress},t.PrivateIpAddress),"(\u79c1\u6709)")),t.PublicIpAddress&&(r=i.a.createElement("div",null,i.a.createElement(dt,{style:{marginBottom:0,display:"inline"},copyable:""!==t.PublicIpAddress},t.PublicIpAddress),"(\u5916\u7f51)")),i.a.createElement("div",{className:"ip_column"},a,n,r)}},{title:"\u914d\u7f6e",dataIndex:"\u914d\u7f6e",key:"\u914d\u7f6e",width:100,render:function(e,t){var a=i.a.createElement(dt,{style:{marginBottom:0,display:"inline"}},t.Cpu,"\u6838"),n=i.a.createElement(dt,{style:{marginBottom:0,display:"inline"}},t.Memory,"G"),r="";"PayByTraffic"===t.InternetChargeType&&(r="\u6d41\u91cf"),"PayByBandwidth"===t.InternetChargeType&&(r="\u5e26\u5bbd");var l=i.a.createElement("div",null,i.a.createElement(dt,{style:{marginBottom:0,display:"inline"}},t.InternetMaxBandwidthOut,"Mbps(",r,")"));return i.a.createElement("div",{className:"ip_column"},a," \xa0",n,l)}},{title:"\u7cfb\u7edf\u7c7b\u578b",dataIndex:"OSType",key:"OSType",align:"center",width:80,render:function(e,t){var a="error";return"Running"===t.Status&&(a="processing"),"windows"===e?i.a.createElement("div",null,i.a.createElement(Xe,null),i.a.createElement(he.a,{status:a,style:{marginLeft:"5px",position:"relative",top:"-10px"}})):"linux"===e?i.a.createElement("div",null,i.a.createElement(et,null),i.a.createElement(he.a,{status:a,style:{marginLeft:"5px",position:"relative",top:"-10px"}})):i.a.createElement(ct,{ellipsis:!0},e)}},{title:"\u533a\u57df",dataIndex:"ZoneId",key:"ZoneId",width:120,render:function(e){return i.a.createElement(ct,{ellipsis:!0},e)}},{title:"\u8fc7\u671f\u65f6\u95f4",dataIndex:"ExpiredTime",key:"ExpiredTime",width:120,render:function(e){return i.a.createElement(ct,{ellipsis:!0},e)}},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",width:{operWidth:n},align:"center",render:function(e,t){return i.a.createElement("div",null,i.a.createElement(me.a,{type:"primary",size:"small",onClick:a.openMonitorDrawer.bind(Object(g.a)(a),t)},"\u76d1\u63a7"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{type:"info",size:"small",onClick:a.serverEdit.bind(Object(g.a)(a),t)},"\u7f16\u8f91"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(de.a,{title:"\u786e\u5b9a\u5220\u9664\u8be5\u9879\u5185\u5bb9?",onConfirm:a.serverDelete.bind(Object(g.a)(a),t),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(me.a,{type:"danger",size:"small"},"\u5220\u9664")))}}],tableLoading:!1,webSocketReady:!1,chartData:[],tableData:[],pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:function(e,t){return a.onShowSizeChange(e,t)},showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e,t){return a.changePage(e,t)}},drawerVisible:!1,drawerPlacement:"left",instanceId:"",timeTagValue:"1h",metricTagValue:"CPUUtilization",chartFormat:"%",currentServerDetail:{},msgContent:"",server_info_modal_visible:!1,queryExpiredTime:null,queryKeyword:"",queryCloudAccount:"0",queryManageUser:"0",queryDefineGroup:"",cloudAccountList:[],selectedRowKeys:[],idsList:[],updateMode:"single",extraInfoData:{}},a.timer=null,a.terminal=null,a.rws=null,a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onShowSizeChange",value:function(e,t){var a=this,n=Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t});this.setState({pagination:n},function(){a.refreshTableData()})}},{key:"componentDidMount",value:function(){this.refreshTableData(),this.loadCloudAccountsData()}},{key:"componentWillUnmount",value:function(){null!==this.rws&&this.rws.close(),null!==this.terminal&&this.terminal.dispose()}},{key:"initWsConnection",value:function(){this.rws.addEventListener("open",function(){console.log("connect success")}),this.rws.addEventListener("close",function(){console.log("close")}),this.rws.addEventListener("message",function(e){console.log("message: ",e)}),this.rws.addEventListener("error",function(){console.log("error")})}},{key:"loadCloudAccountsData",value:function(){var e=this;Le(1,100).then(function(t){0===t.code?e.setState({cloudAccountList:t.data.accounts}):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"serverEdit",value:function(e){var t=this;Te(e.ID).then(function(a){if(0!==a.code)D.b.error(a.msg);else{var n={instanceId:a.data.InstanceId,innerIpAddress:a.data.InnerIpAddress,publicIpAddress:a.data.PublicIpAddress,privateIpAddress:a.data.PrivateIpAddress,instanceName:a.data.InstanceName,cpu:a.data.Cpu,memory:(a.data.Memory/1024).toString(),expiredTime:""!==a.data.ExpiredTime?we()(a.data.ExpiredTime):"",resForm:1===a.data.DataStatus?"\u963f\u91cc\u4e91":"\u624b\u52a8\u6dfb\u52a0",sshPort:a.data.SshPort+"",sshUser:a.data.SshUser,sshPwd:a.data.SshPwd};t.setState({extraInfoModalVisible:!0,ecsId:e.ID,updateMode:"single",resFrom:1===e.DataStatus?"\u963f\u91cc\u4e91":"\u624b\u52a8\u6dfb\u52a0",extraInfoData:n})}}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleExtraInfoOk",value:function(e){var t=this,a="";a="single"===this.state.updateMode?String(this.state.ecsId):this.state.idsList.join(","),function(e){return V("cloud/servers",e)}(Object(fe.a)({},e,{id:a})).then(function(e){0===e.code?(t.setState({extraInfoModalVisible:!1,selectedRowKeys:[]}),D.b.success("\u4fee\u6539\u6210\u529f"),t.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleExtraInfoCancel",value:function(e){this.setState({extraInfoModalVisible:!1})}},{key:"serverDelete",value:function(e){var t,a=this;(t=e.ID,B("cloud/servers",{id:t})).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),a.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handlePostServerInfoSubmit",value:function(){var e=this;this.formRef.current.validateFields().then(function(t){var a;(a=Object(fe.a)({},t,{createTime:t.createTime.format("YYYY-MM-DD HH:mm:ss"),expiredTime:void 0===t.expiredTime?void 0:t.expiredTime.format("YYYY-MM-DD HH:mm:ss")}),P("cloud/servers",a)).then(function(t){0===t.code?(D.b.success("\u6dfb\u52a0\u6210\u529f\uff0c\u8bf7\u5230\u6743\u9650\u7ba1\u7406\u4e2d\u589e\u52a0\u8bbf\u95ee\u6743\u9650\uff01"),e.setState({server_info_modal_visible:!1}),e.refreshTableData()):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})})}},{key:"handlePostServerInfoCancel",value:function(){this.setState({server_info_modal_visible:!1})}},{key:"detailTabChange",value:function(e){"3"===e&&this.initTerminal()}},{key:"render",value:function(){var e;return e=this.state.cloudAccountList.map(function(e){return i.a.createElement(ut,{key:e.id,value:e.id},e.accountName)}),i.a.createElement(mt,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u4e91\u8d44\u6e90","\u4e91\u670d\u52a1\u5668","\u670d\u52a1\u5668\u5217\u8868"]}),i.a.createElement(oe.a,{style:{padding:"0px 0px 10px 0px"}},i.a.createElement(ce.a,{span:3,className:"col-span"},i.a.createElement(be.a,{style:{width:"100%"},defaultValue:this.state.queryExpiredTime,placeholder:"\u5230\u671f\u622a\u6b62\u65f6\u95f4",onChange:this.onExpiredDateChange})),i.a.createElement(ce.a,{span:5,className:"col-span"},i.a.createElement(O.a,{placeholder:"\u8f93\u5165\u5b9e\u4f8bid\\ip\\\u5b9e\u4f8b\u540d\u79f0\u67e5\u8be2",value:this.state.queryKeyword,onChange:this.keywordOnChange})),i.a.createElement(ce.a,{span:4,className:"col-span"},i.a.createElement(ye.a,{defaultValue:this.state.queryCloudAccount,style:{width:"100%"},onChange:this.handleCloudAccountChange},i.a.createElement(ut,{value:"0"},"\u6240\u6709\u4e91\u8d26\u53f7"),e)),i.a.createElement(ce.a,{span:2,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},type:"primary",icon:i.a.createElement(ke.a,null),onClick:this.handleQuery},"\u67e5 \u8be2")),i.a.createElement(ce.a,{span:2,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},icon:i.a.createElement(Ie.a,null),onClick:this.handleAdd},"\u65b0 \u589e"))),i.a.createElement(ht,{formRef:this.formRef,server_info_modal_visible:this.state.server_info_modal_visible,handlePostServerInfoSubmit:this.handlePostServerInfoSubmit,handlePostServerInfoCancel:this.handlePostServerInfoCancel}),i.a.createElement(Qe,{editData:this.state.extraInfoData,resType:"ecs",updateMode:this.state.updateMode,resFrom:this.state.resFrom,visible:this.state.extraInfoModalVisible,handleOk:this.handleExtraInfoOk,handleCancel:this.handleExtraInfoCancel}),i.a.createElement(re.a,{title:"\u670d\u52a1\u5668\u8be6\u60c5\u53ca\u76d1\u63a7\u6570\u636e",placement:this.state.drawerPlacement,closable:!0,destroyOnClose:!0,onClose:this.onCloseDrawer,visible:this.state.drawerVisible,width:950},i.a.createElement(Ee.a,{defaultActiveKey:"1",tabPosition:"left",style:{marginLeft:-30},onChange:this.detailTabChange.bind(this)},i.a.createElement(ot,{tab:"\u76d1\u63a7\u8be6\u60c5",key:"1"},i.a.createElement(le.a,{tip:"\u56fe\u8868\u751f\u6210\u4e2d...",spinning:this.state.chartLoading},i.a.createElement(oe.a,{style:{marginBottom:"10px"}},i.a.createElement(ce.a,{span:3,style:{lineHeight:"30px"}},"\u65f6\u95f4\u7ef4\u5ea6\uff1a"),i.a.createElement(ce.a,{span:15},i.a.createElement(se.a.Group,{value:this.state.timeTagValue,onChange:this.handleTimeTagChange},i.a.createElement(se.a.Button,{value:"1h"},"1\u5c0f\u65f6"),i.a.createElement(se.a.Button,{value:"6h"},"6\u5c0f\u65f6"),i.a.createElement(se.a.Button,{value:"12h"},"12\u5c0f\u65f6"),i.a.createElement(se.a.Button,{value:"1d"},"1 \u5929"),i.a.createElement(se.a.Button,{value:"3d"},"3 \u5929"),i.a.createElement(se.a.Button,{value:"7d"},"7 \u5929"),i.a.createElement(se.a.Button,{value:"14d"},"14 \u5929")))),i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:3,style:{lineHeight:"30px"}},"\u76d1\u63a7\u7ef4\u5ea6\uff1a"),i.a.createElement(ce.a,{span:16},i.a.createElement(se.a.Group,{value:this.state.metricTagValue,onChange:this.handleMetricTagChange},i.a.createElement(se.a.Button,{value:"CPUUtilization"},"cpu\u4f7f\u7528\u7387"),i.a.createElement(se.a.Button,{value:"memory_usedutilization"},"\u5185\u5b58\u4f7f\u7528\u7387"),i.a.createElement(se.a.Button,{value:"diskusage_utilization"},"\u78c1\u76d8\u4f7f\u7528\u7387"),i.a.createElement(se.a.Button,{value:"cpu_total"},"\u5e73\u5747\u8d1f\u8f7d")))),i.a.createElement(oe.a,{style:{marginTop:20}},i.a.createElement(ce.a,null,i.a.createElement(Ze,{width:800,height:400,data:this.state.chartData}))))),i.a.createElement(ot,{tab:"\u4fe1\u606f\u8be6\u60c5",key:"2"},i.a.createElement(le.a,{tip:"\u6570\u636e\u83b7\u53d6\u4e2d...",spinning:this.state.serverDetailLoading},i.a.createElement(ie.a,{title:"\u57fa\u672c\u4fe1\u606f",bordered:!0,size:"small",column:2},i.a.createElement(ie.a.Item,{label:"\u4e3b\u673a\u540d"},this.state.currentServerDetail.HostName),i.a.createElement(ie.a.Item,{label:"\u673a\u5668\u63cf\u8ff0"},this.state.currentServerDetail.Description),i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8bID"},this.state.currentServerDetail.InstanceId),i.a.createElement(ie.a.Item,{label:"\u5185\u7f51IP"},this.state.currentServerDetail.InnerIpAddress),i.a.createElement(ie.a.Item,{label:"\u5916\u7f51IP"},this.state.currentServerDetail.PublicIpAddress),i.a.createElement(ie.a.Item,{label:"\u79c1\u6709IP"},this.state.currentServerDetail.PrivateIpAddress),i.a.createElement(ie.a.Item,{label:"Cpu"},this.state.currentServerDetail.Cpu,"\u6838"),i.a.createElement(ie.a.Item,{label:"\u5185\u5b58"},this.state.currentServerDetail.Memory/1024,"G"),i.a.createElement(ie.a.Item,{label:"\u516c\u7f51\u5165\u5e26\u5bbd"},this.state.currentServerDetail.InternetMaxBandwidthIn,"Mbps"),i.a.createElement(ie.a.Item,{label:"\u516c\u7f51\u51fa\u5e26\u5bbd"},this.state.currentServerDetail.InternetMaxBandwidthOut,"Mbps"),i.a.createElement(ie.a.Item,{label:"\u7f51\u7edc\u8ba1\u8d39"},this.state.currentServerDetail.InternetChargeType),i.a.createElement(ie.a.Item,{label:"\u521b\u5efa\u65f6\u95f4"},this.state.currentServerDetail.CreationTime),i.a.createElement(ie.a.Item,{label:"\u8fc7\u671f\u65f6\u95f4"},this.state.currentServerDetail.ExpiredTime),i.a.createElement(ie.a.Item,{label:"\u955c\u50cfID"},this.state.currentServerDetail.ImageId),i.a.createElement(ie.a.Item,{label:"\u4ed8\u8d39\u7c7b\u578b"},this.state.currentServerDetail.InstanceChargeType),i.a.createElement(ie.a.Item,{label:"\u7f51\u7edc\u7c7b\u578b"},this.state.currentServerDetail.InstanceNetworkType),i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8b\u7c7b\u578b"},this.state.currentServerDetail.InstanceType),i.a.createElement(ie.a.Item,{label:"\u7cfb\u7edf\u540d\u79f0"},this.state.currentServerDetail.OSName)))),i.a.createElement(ot,{tab:"\u7ec8\u7aef",key:"3"},i.a.createElement("div",{id:"server_terminal"})))),i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,bordered:!0,size:"small"}))}}]),t}(r.Component),ft=Z.a.Text,bt=Z.a.Paragraph,gt=ye.a.Option,yt=b.a.Content,Et=Ee.a.TabPane,vt=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={cloudAccountList:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;Le(1,100).then(function(t){0===t.code?e.setState({cloudAccountList:t.data.accounts}):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"render",value:function(){var e,t={labelCol:{span:7},wrapperCol:{span:14}};return e=this.state.cloudAccountList.map(function(e){return i.a.createElement(gt,{key:e.id,value:e.id},e.accountName)}),i.a.createElement(E.a,{title:"\u6570\u636e\u5e93\u4fe1\u606f",destroyOnClose:!0,visible:this.props.rds_info_modal_visible,onOk:this.props.handlePostRdsInfoSubmit,onCancel:this.props.handlePostRdsInfoCancel,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",width:600},i.a.createElement(S.a,{ref:this.props.formRef,initialValues:{engine:"Mysql"}},i.a.createElement(S.a.Item,Object.assign({label:"\u4e91\u8d26\u53f7"},t,{name:"cloudAccountId",rules:[{required:!0,message:"\u4e91\u8d26\u53f7\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(ye.a,null,e)),i.a.createElement(S.a.Item,Object.assign({label:"\u5b9e\u4f8bId"},t,{name:"dbInstanceId",rules:[{required:!0,message:"\u5b9e\u4f8bId\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u5b9e\u4f8b\u63cf\u8ff0"},t,{name:"dbInstanceDescription",rules:[{required:!0,message:"\u5b9e\u4f8b\u63cf\u8ff0\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u6570\u636e\u5e93\u7c7b\u578b"},t,{name:"engine",rules:[{required:!0,message:"\u6570\u636e\u5e93\u7c7b\u578b\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(ye.a,null,i.a.createElement(gt,{value:"Mysql"},"Mysql"),i.a.createElement(gt,{value:"SqlServer"},"SqlServer"))),i.a.createElement(S.a.Item,Object.assign({label:"\u8fde\u63a5\u4e32"},t,{name:"connectionString",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8fde\u63a5\u4e32\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u7aef\u53e3"},t,{name:"port",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7aef\u53e3\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u5185\u5b58(G)"},t,{name:"dbInstanceMemory",rules:[{type:"integer",required:!0,message:"\u8bf7\u8f93\u5165\u6570\u503c\u578b\u6570\u636e\uff01"}]}),i.a.createElement(ge.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u78c1\u76d8(G)"},t,{name:"dbInstanceStorage",rules:[{type:"integer",required:!0,message:"\u8bf7\u8f93\u5165\u6570\u503c\u578b\u6570\u636e\uff01"}]}),i.a.createElement(ge.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u521b\u5efa\u65f6\u95f4"},t,{name:"createTime",rules:[{required:!0,message:"\u521b\u5efa\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(be.a,{format:"YYYY-MM-DD"})),i.a.createElement(S.a.Item,Object.assign({label:"\u8fc7\u671f\u65f6\u95f4"},t,{name:"expireTime"}),i.a.createElement(be.a,{format:"YYYY-MM-DD"}))))}}]),t}(r.Component),St=function(e){function t(e){var a;Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).refreshTableData=function(){a.setState({tableLoading:!0});var e={page:a.state.pagination.page,size:a.state.pagination.pageSize,queryExpiredTime:null===a.state.queryExpiredTime?null:a.state.queryExpiredTime.format("YYYY-MM-DD HH:mm:ss"),queryKeyword:a.state.queryKeyword,queryCloudAccount:a.state.queryCloudAccount};Ve(e).then(function(e){var t=a.state.pagination;t.total=parseInt(e.data.total),t.page=parseInt(e.data.page),t.showTotal(parseInt(e.data.total)),a.setState({pagination:t});for(var n=e.data.rds,r=[],i=0;i<n.length;i++)r.push({key:n[i].ID,ID:n[i].ID,DBInstanceId:n[i].DBInstanceId,DBInstanceDescription:n[i].DBInstanceDescription,DBInstanceType:n[i].DBInstanceType,Engine:n[i].Engine,ExpireTime:we()(n[i].ExpireTime).format("YYYY-MM-DD"),DBInstanceStatus:n[i].DBInstanceStatus,ConnectionString:n[i].ConnectionString,Port:n[i].Port,DBInstanceMemory:n[i].DBInstanceMemory,DBInstanceStorage:n[i].DBInstanceStorage,CloudAccountName:n[i].CloudAccountName,DataStatus:n[i].DataStatus});a.setState({tableData:r,tableLoading:!1})}).catch(function(e){console.log(e)})},a.openMonitorDrawer=function(e){a.setState({drawerVisible:!0,instanceId:e.DBInstanceId,currentServerDetail:e},function(){a.refreshMonitorData(e.DBInstanceId,a.state.timeTagValue,a.state.metricTagValue),a.refreshSeverDetail()})},a.refreshMonitorData=function(e,t,n){a.setState({chartLoading:!0}),Ne(e,t,n).then(function(e){if(0!==e.code)return D.b.error(e.msg),void a.setState({chartLoading:!1});if(""===e.data.Datapoints)return D.b.warn("\u672a\u83b7\u53d6\u5230\u76d1\u63a7\u6570\u636e\uff0c\u53ef\u80fd\u662f\u975e\u963f\u91cc\u4e91\u673a\u5668\u6216\u5176\u5b83\u539f\u56e0\uff01"),void a.setState({chartLoading:!1});for(var t=JSON.parse(e.data.Datapoints),n=[],r=0;r<t.length;r++)n.push({date:we()(t[r].timestamp).format("DD\u65e5HH:mm"),value:t[r].Average});a.setState({chartLoading:!1,chartData:n})}).catch(function(e){console.log(e.toLocaleString())})},a.refreshSeverDetail=function(e){a.setState({serverDetailLoading:!0}),Ye(a.state.currentServerDetail.ID).then(function(e){0!==e.code&&D.b.error(e.msg),a.setState({currentServerDetail:e.data},function(){a.setState({serverDetailLoading:!1})})}).catch(function(e){console.log(e)})},a.changePage=function(e,t){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e,pageSize:t})},function(){a.refreshTableData()})},a.onExpiredDateChange=function(e){null==e?a.setState({queryExpiredTime:null}):a.setState({queryExpiredTime:e})},a.keywordOnChange=function(e){a.setState({queryKeyword:e.target.value})},a.handleCloudAccountChange=function(e){a.setState({queryCloudAccount:e})},a.handleQuery=function(){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:1,current:1})},function(){a.refreshTableData()})},a.onCloseDrawer=function(){a.setState({drawerVisible:!1})},a.handleTimeTagChange=function(e){a.setState({timeTagValue:e.target.value}),a.refreshMonitorData(a.state.instanceId,e.target.value,a.state.metricTagValue)},a.handleMetricTagChange=function(e){switch(a.setState({metricTagValue:e.target.value}),e.target.value){case"CpuUsage":case"MemoryUsage":case"ConnectionUsage":case"DiskUsage":case"IOPSUsage":a.setState({chartFormat:"%"});break;case"DataDelay":a.setState({chartFormat:"Count"});break;default:a.setState({chartFormat:"\u79d2"})}a.refreshMonitorData(a.state.instanceId,a.state.timeTagValue,e.target.value)},a.handleAdd=function(){a.setState({rds_info_modal_visible:!0,rdsId:0})},a.handleBatchUpdate=function(){var e=a.state.selectedRowKeys;0!==e.length?a.setState({extraInfoModalVisible:!0,updateMode:"batch",idsList:e}):D.b.warn("\u8bf7\u5148\u9009\u62e9\u6570\u636e")},a.onSelectChange=function(e){a.setState({selectedRowKeys:e})},a.handlePostRdsInfoSubmit=a.handlePostRdsInfoSubmit.bind(Object(g.a)(a)),a.handlePostRdsInfoCancel=a.handlePostRdsInfoCancel.bind(Object(g.a)(a)),a.handleExtraInfoOk=a.handleExtraInfoOk.bind(Object(g.a)(a)),a.handleExtraInfoCancel=a.handleExtraInfoCancel.bind(Object(g.a)(a));var n=a.props.isSuperAdmin?200:100;return a.formRef=i.a.createRef(),a.state={columns:[{title:"Id",dataIndex:"ID",key:"ID",width:50,render:function(e){return i.a.createElement(ft,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8bid",dataIndex:"DBInstanceId",key:"DBInstanceId",width:200,render:function(e){return i.a.createElement(ft,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8b\u63cf\u8ff0",dataIndex:"DBInstanceDescription",key:"DBInstanceDescription",width:250,render:function(e,t){return i.a.createElement(pe.a,{title:e},i.a.createElement(ft,{ellipsis:!0,style:{width:"200px"}},e))}},{title:"\u4e91\u8d26\u53f7",dataIndex:"CloudAccountName",key:"CloudAccountName",width:100,render:function(e){return i.a.createElement(ft,{ellipsis:!0},e)}},{title:"\u6570\u636e\u5e93\u7c7b\u578b",dataIndex:"Engine",key:"Engine",width:100,render:function(e){return i.a.createElement(ft,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8b\u7c7b\u578b",dataIndex:"DBInstanceType",key:"DBInstanceType",width:100,render:function(e){return i.a.createElement(ft,{ellipsis:!0},e)}},{title:"\u8fde\u63a5\u4e32",dataIndex:"ConnectionString",key:"ConnectionString",width:400,render:function(e){return i.a.createElement(bt,{style:{marginBottom:0,fontSize:13},copyable:!0},e)}},{title:"\u7aef\u53e3",dataIndex:"Port",key:"Port",width:50,render:function(e){return i.a.createElement(ft,{ellipsis:!0},e)}},{title:"\u914d\u7f6e",dataIndex:"\u914d\u7f6e",key:"\u914d\u7f6e",width:150,render:function(e,t){var a=i.a.createElement(bt,{style:{marginBottom:0,display:"inline"}},"\u5185\u5b58: ",t.DBInstanceMemory/1024,"G,"," "),n=i.a.createElement(bt,{style:{marginBottom:0,display:"inline"}},"\u78c1\u76d8: ",t.DBInstanceStorage,"G");return i.a.createElement("div",{className:"ip_column"},a,n)}},{title:"\u8fc7\u671f\u65f6\u95f4",dataIndex:"ExpireTime",key:"ExpireTime",width:100,render:function(e){return i.a.createElement(ft,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8b\u72b6\u6001",dataIndex:"DBInstanceStatus",key:"DBInstanceStatus",align:"center",width:100,render:function(e){return"Running"===e?i.a.createElement(he.a,{status:"processing"}):i.a.createElement(he.a,{status:"error"})}},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",width:{operWidth:n},align:"center",render:function(e,t){return i.a.createElement("div",null,i.a.createElement(me.a,{type:"primary",size:"small",onClick:a.openMonitorDrawer.bind(Object(g.a)(a),t)},"\u76d1\u63a7"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{type:"info",size:"small",onClick:a.rdsEdit.bind(Object(g.a)(a),t)},"\u7f16\u8f91"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(de.a,{title:"\u786e\u5b9a\u5220\u9664\u8be5\u9879\u5185\u5bb9?",onConfirm:a.rdsDelete.bind(Object(g.a)(a),t),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(me.a,{type:"danger",size:"small"},"\u5220\u9664")))}}],extraInfoModalVisible:!1,tableLoading:!1,tableData:[],chartData:[],pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:function(e,t){return a.onShowSizeChange(e,t)},showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e,t){return a.changePage(e,t)}},drawerVisible:!1,drawerPlacement:"left",instanceId:"",timeTagValue:"1h",metricTagValue:"CpuUsage",chartFormat:"%",currentServerDetail:{},queryExpiredTime:null,queryKeyword:"",queryCloudAccount:"0",queryManageUser:"0",queryDefineGroup:"",cloudAccountList:[],selectedRowKeys:[],idsList:[],updateMode:"single",extraInfoData:{}},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onShowSizeChange",value:function(e,t){var a=this,n=Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t});this.setState({pagination:n},function(){a.refreshTableData()})}},{key:"componentDidMount",value:function(){this.refreshTableData(),this.loadCloudAccountsData()}},{key:"loadCloudAccountsData",value:function(){var e=this;Le(1,100).then(function(t){0===t.code?e.setState({cloudAccountList:t.data.accounts}):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"rdsEdit",value:function(e){var t=this;Ye(e.ID).then(function(a){0!==a.code?D.b.error(a.msg):t.setState({extraInfoModalVisible:!0,rdsId:e.ID,updateMode:"single",resFrom:1===e.DataStatus?"\u963f\u91cc\u4e91":"\u624b\u52a8\u6dfb\u52a0",extraInfoData:{dbInstanceDescription:a.data.DBInstanceDescription,dbMemory:(a.data.DBInstanceMemory/1024).toString(),dbInstanceStorage:a.data.DBInstanceStorage.toString(),dbExpiredTime:""!==a.data.ExpireTime?we()(a.data.ExpireTime):"",resForm:1===a.data.DataStatus?"\u963f\u91cc\u4e91":"\u624b\u52a8\u6dfb\u52a0"}})}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleExtraInfoOk",value:function(e){var t=this,a="";a="single"===this.state.updateMode?String(this.state.rdsId):this.state.idsList.join(","),function(e){return V("cloud/rds",e)}(Object(fe.a)({},e,{id:a})).then(function(e){0===e.code?(D.b.success("\u4fee\u6539\u6210\u529f"),t.setState({extraInfoModalVisible:!1,selectedRowKeys:[]}),t.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleExtraInfoCancel",value:function(e){this.setState({extraInfoModalVisible:!1})}},{key:"rdsDelete",value:function(e){var t,a=this;(t=e.ID,B("cloud/rds",{id:t})).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),a.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handlePostRdsInfoSubmit",value:function(){var e=this;this.formRef.current.validateFields().then(function(t){var a;(a=Object(fe.a)({},t,{createTime:t.createTime.format("YYYY-MM-DD HH:mm:ss"),expireTime:void 0===t.expireTime?void 0:t.expireTime.format("YYYY-MM-DD HH:mm:ss")}),P("cloud/rds",a)).then(function(t){0===t.code?(D.b.success("\u6dfb\u52a0\u6210\u529f\uff0c\u8bf7\u5230\u6743\u9650\u7ba1\u7406\u4e2d\u589e\u52a0\u8bbf\u95ee\u6743\u9650\uff01"),e.setState({rds_info_modal_visible:!1}),e.refreshTableData()):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})})}},{key:"handlePostRdsInfoCancel",value:function(){this.setState({rds_info_modal_visible:!1})}},{key:"render",value:function(){var e;return e=this.state.cloudAccountList.map(function(e){return i.a.createElement(gt,{key:e.id,value:e.id},e.accountName)}),i.a.createElement(yt,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u4e91\u8d44\u6e90","\u4e91\u6570\u636e\u5e93","\u6570\u636e\u5e93\u5217\u8868"]}),i.a.createElement(oe.a,{style:{padding:"0px 0px 10px 0px"}},i.a.createElement(ce.a,{span:3,className:"col-span"},i.a.createElement(be.a,{style:{width:"100%"},placeholder:"\u5230\u671f\u622a\u6b62\u65f6\u95f4",defaultValue:this.state.queryExpiredTime,onChange:this.onExpiredDateChange})),i.a.createElement(ce.a,{span:5,className:"col-span"},i.a.createElement(O.a,{placeholder:"\u8f93\u5165\u5b9e\u4f8bid\\\u63cf\u8ff0\\\u8fde\u63a5\u4e32\u67e5\u8be2",value:this.state.queryKeyword,onChange:this.keywordOnChange})),i.a.createElement(ce.a,{span:3,className:"col-span"},i.a.createElement(ye.a,{defaultValue:this.state.queryCloudAccount,style:{width:"100%"},onChange:this.handleCloudAccountChange},i.a.createElement(gt,{value:"0"},"\u6240\u6709\u4e91\u8d26\u53f7"),e)),i.a.createElement(ce.a,{span:2,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},type:"primary",icon:i.a.createElement(ke.a,null),onClick:this.handleQuery},"\u67e5 \u8be2")),i.a.createElement(ce.a,{span:2,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},icon:i.a.createElement(Ie.a,null),onClick:this.handleAdd},"\u65b0 \u589e"))),i.a.createElement(vt,{formRef:this.formRef,rds_info_modal_visible:this.state.rds_info_modal_visible,handlePostRdsInfoSubmit:this.handlePostRdsInfoSubmit,handlePostRdsInfoCancel:this.handlePostRdsInfoCancel}),i.a.createElement(Qe,{editData:this.state.extraInfoData,resType:"rds",updateMode:this.state.updateMode,resFrom:this.state.resFrom,visible:this.state.extraInfoModalVisible,handleOk:this.handleExtraInfoOk,handleCancel:this.handleExtraInfoCancel}),i.a.createElement("div",null,i.a.createElement(re.a,{title:"\u6570\u636e\u5e93\u8be6\u60c5\u53ca\u76d1\u63a7\u6570\u636e",placement:this.state.drawerPlacement,closable:!0,destroyOnClose:!0,onClose:this.onCloseDrawer,visible:this.state.drawerVisible,width:950},i.a.createElement(Ee.a,{defaultActiveKey:"1",tabPosition:"left",style:{marginLeft:-30}},i.a.createElement(Et,{tab:"\u76d1\u63a7\u8be6\u60c5",key:"1"},i.a.createElement(le.a,{tip:"\u56fe\u8868\u751f\u6210\u4e2d...",spinning:this.state.chartLoading},i.a.createElement(oe.a,{style:{marginBottom:"10px"}},i.a.createElement(ce.a,{span:3,style:{lineHeight:"30px"}},"\u65f6\u95f4\u7ef4\u5ea6\uff1a"),i.a.createElement(ce.a,{span:15},i.a.createElement(se.a.Group,{value:this.state.timeTagValue,onChange:this.handleTimeTagChange},i.a.createElement(se.a.Button,{value:"1h"},"1\u5c0f\u65f6"),i.a.createElement(se.a.Button,{value:"6h"},"6\u5c0f\u65f6"),i.a.createElement(se.a.Button,{value:"12h"},"12\u5c0f\u65f6"),i.a.createElement(se.a.Button,{value:"1d"},"1 \u5929"),i.a.createElement(se.a.Button,{value:"3d"},"3 \u5929"),i.a.createElement(se.a.Button,{value:"7d"},"7 \u5929"),i.a.createElement(se.a.Button,{value:"14d"},"14 \u5929")))),i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:3,style:{lineHeight:"30px"}},"\u76d1\u63a7\u7ef4\u5ea6\uff1a"),i.a.createElement(ce.a,{span:16},i.a.createElement(se.a.Group,{value:this.state.metricTagValue,onChange:this.handleMetricTagChange},i.a.createElement(se.a.Button,{value:"CpuUsage"},"cpu\u4f7f\u7528\u7387"),i.a.createElement(se.a.Button,{value:"MemoryUsage"},"\u5185\u5b58\u4f7f\u7528\u7387"),i.a.createElement(se.a.Button,{value:"ConnectionUsage"},"\u8fde\u63a5\u6570\u4f7f\u7528\u7387"),i.a.createElement(se.a.Button,{value:"DiskUsage"},"\u78c1\u76d8\u4f7f\u7528\u7387"),i.a.createElement(se.a.Button,{value:"IOPSUsage"},"IOPS\u4f7f\u7528\u7387"),i.a.createElement(se.a.Button,{value:"DataDelay"},"\u53ea\u8bfb\u5b9e\u4f8b\u5ef6\u8fdf")))),i.a.createElement(oe.a,{style:{marginTop:20}},i.a.createElement(ce.a,null,i.a.createElement(Ze,{width:800,height:400,data:this.state.chartData}))))),i.a.createElement(Et,{tab:"\u4fe1\u606f\u8be6\u60c5",key:"2"},i.a.createElement(le.a,{tip:"\u6570\u636e\u83b7\u53d6\u4e2d...",spinning:this.state.serverDetailLoading},i.a.createElement(ie.a,{title:"\u57fa\u672c\u4fe1\u606f",bordered:!0,size:"small",column:2},i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8bID"},this.state.currentServerDetail.DBInstanceId),i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8b\u63cf\u8ff0"},this.state.currentServerDetail.DBInstanceDescription),i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8b\u72b6\u6001"},this.state.currentServerDetail.DBInstanceStatus),i.a.createElement(ie.a.Item,{label:"\u521b\u5efa\u65f6\u95f4"},this.state.currentServerDetail.CreateTime),i.a.createElement(ie.a.Item,{label:"\u8fc7\u671f\u65f6\u95f4"},this.state.currentServerDetail.ExpireTime),i.a.createElement(ie.a.Item,{label:"\u8fde\u63a5\u4e32"},this.state.currentServerDetail.ConnectionString),i.a.createElement(ie.a.Item,{label:"\u7aef\u53e3"},this.state.currentServerDetail.Port),i.a.createElement(ie.a.Item,{label:"\u6570\u636e\u5e93\u7c7b\u578b"},this.state.currentServerDetail.Engine),i.a.createElement(ie.a.Item,{label:"\u5185\u5b58"},this.state.currentServerDetail.DBInstanceMemory," ","M"),i.a.createElement(ie.a.Item,{label:"\u78c1\u76d8"},this.state.currentServerDetail.DBInstanceStorage," ","G"),i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8b\u7c7b\u578b"},this.state.currentServerDetail.DBInstanceType),i.a.createElement(ie.a.Item,{label:"\u6570\u636e\u5e93\u7248\u672c"},this.state.currentServerDetail.EngineVersion),i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8b\u7cfb\u5217"},this.state.currentServerDetail.Category)))))),i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,bordered:!0,size:"small"})))}}]),t}(r.Component),kt=Z.a.Text,It=Z.a.Paragraph,Ct=ye.a.Option,Dt=b.a.Content,Ot=Ee.a.TabPane,xt=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={cloudAccountList:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;Le(1,100).then(function(t){0===t.code?e.setState({cloudAccountList:t.data.accounts}):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"render",value:function(){var e,t={labelCol:{span:7},wrapperCol:{span:14}};return e=this.state.cloudAccountList.map(function(e){return i.a.createElement(Ct,{key:e.id,value:e.id},e.accountName)}),i.a.createElement(E.a,{title:"Redis\u4fe1\u606f",destroyOnClose:!0,visible:this.props.kv_info_modal_visible,onOk:this.props.handlePostKvInfoSubmit,onCancel:this.props.handlePostKvInfoCancel,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",width:600},i.a.createElement(S.a,{ref:this.props.formRef,initialValues:{instanceType:"Redis"}},i.a.createElement(S.a.Item,Object.assign({label:"\u4e91\u8d26\u53f7"},t,{name:"cloudAccountId",rules:[{required:!0,message:"\u4e91\u8d26\u53f7\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(ye.a,null,e)),i.a.createElement(S.a.Item,Object.assign({label:"\u5b9e\u4f8bId"},t,{name:"instanceId",rules:[{required:!0,message:"\u5b9e\u4f8bId\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u5b9e\u4f8b\u540d\u79f0"},t,{name:"instanceName",rules:[{required:!0,message:"\u5b9e\u4f8b\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u5b9e\u4f8b\u7c7b\u578b"},t,{name:"instanceType",rules:[{required:!0,message:"\u6570\u636e\u5e93\u7c7b\u578b\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(ye.a,null,i.a.createElement(Ct,{value:"Redis"},"Redis"))),i.a.createElement(S.a.Item,Object.assign({label:"\u8fde\u63a5\u4e32"},t,{name:"connectionString",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8fde\u63a5\u4e32\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u7aef\u53e3"},t,{name:"port",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7aef\u53e3\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u5bb9\u91cf(G)"},t,{name:"capacity",rules:[{type:"integer",required:!0,message:"\u8bf7\u8f93\u5165\u6570\u503c\u578b\u6570\u636e\uff01"}]}),i.a.createElement(ge.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u5e26\u5bbd(M)"},t,{name:"bandwidth",rules:[{type:"integer",required:!0,message:"\u8bf7\u8f93\u5165\u6570\u503c\u578b\u6570\u636e\uff01"}]}),i.a.createElement(ge.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u521b\u5efa\u65f6\u95f4"},t,{name:"createTime",rules:[{required:!0,message:"\u521b\u5efa\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(be.a,{format:"YYYY-MM-DD"})),i.a.createElement(S.a.Item,Object.assign({label:"\u8fc7\u671f\u65f6\u95f4"},t,{name:"endTime"}),i.a.createElement(be.a,{format:"YYYY-MM-DD"}))))}}]),t}(r.Component),wt=function(e){function t(e){var a;Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).refreshTableData=function(){a.setState({tableLoading:!0});var e={page:a.state.pagination.page,size:a.state.pagination.pageSize,queryExpiredTime:null===a.state.queryExpiredTime?null:a.state.queryExpiredTime.format("YYYY-YY-DD HH:mm:ss"),queryKeyword:a.state.queryKeyword,queryCloudAccount:a.state.queryCloudAccount};Be(e).then(function(e){var t=a.state.pagination;t.total=parseInt(e.data.total),t.page=parseInt(e.data.page),t.showTotal(parseInt(e.data.total)),a.setState({pagination:t});for(var n=e.data.kv,r=[],i=0;i<n.length;i++)r.push({key:n[i].ID,ID:n[i].ID,InstanceId:n[i].InstanceId,InstanceName:n[i].InstanceName,InstanceType:n[i].InstanceType,ConnectionDomain:n[i].ConnectionDomain,EndTime:we()(n[i].EndTime).format("YYYY-MM-DD"),InstanceStatus:n[i].InstanceStatus,Capacity:n[i].Capacity,QPS:n[i].QPS,Bandwidth:n[i].Bandwidth,Connections:n[i].Connections,CloudAccountName:n[i].CloudAccountName,DataStatus:n[i].DataStatus});a.setState({tableData:r,tableLoading:!1})}).catch(function(e){console.log(e)})},a.openMonitorDrawer=function(e){a.setState({drawerVisible:!0,instanceId:e.InstanceId,currentServerDetail:e},function(){a.refreshMonitorData(e.InstanceId,a.state.timeTagValue,a.state.metricTagValue),a.refreshSeverDetail()})},a.refreshMonitorData=function(e,t,n){a.setState({chartLoading:!0}),ze(e,t,n).then(function(e){if(0!==e.code)return D.b.error(e.msg),void a.setState({chartLoading:!1});if(""===e.data.Datapoints)return D.b.warn("\u672a\u83b7\u53d6\u5230\u76d1\u63a7\u6570\u636e\uff0c\u53ef\u80fd\u662f\u975e\u963f\u91cc\u4e91\u673a\u5668\u6216\u5176\u5b83\u539f\u56e0\uff01"),void a.setState({chartLoading:!1});for(var t=JSON.parse(e.data.Datapoints),n=[],r=0;r<t.length;r++)n.push({date:we()(t[r].timestamp).format("DD\u65e5HH:mm"),value:t[r].Average});a.setState({chartLoading:!1,chartData:n})}).catch(function(e){D.b.error(e.toLocaleString())})},a.refreshSeverDetail=function(e){a.setState({serverDetailLoading:!0}),Fe(a.state.currentServerDetail.ID).then(function(e){0!==e.code&&D.b.error(e.msg),a.setState({currentServerDetail:e.data},function(){a.setState({serverDetailLoading:!1})})}).catch(function(e){console.log(e)})},a.changePage=function(e,t){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e,pageSize:t})},function(){a.refreshTableData()})},a.onExpiredDateChange=function(e){null==e?a.setState({queryExpiredTime:null}):a.setState({queryExpiredTime:e})},a.keywordOnChange=function(e){a.setState({queryKeyword:e.target.value})},a.handleCloudAccountChange=function(e){a.setState({queryCloudAccount:e})},a.handleQuery=function(){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:1,current:1})},function(){console.log(a.state.pagination.page),a.refreshTableData()})},a.onCloseDrawer=function(){a.setState({drawerVisible:!1})},a.handleTimeTagChange=function(e){a.setState({timeTagValue:e.target.value}),a.refreshMonitorData(a.state.instanceId,e.target.value,a.state.metricTagValue)},a.handleMetricTagChange=function(e){switch(a.setState({metricTagValue:e.target.value}),e.target.value){case"StandardConnectionUsage":case"StandardCpuUsage":a.setState({chartFormat:"%"});break;case"StandardAvgRt":a.setState({chartFormat:"us"});break;case"Standardappend":a.setState({chartFormat:"Count/Second"});break;default:a.setState({chartFormat:""})}a.refreshMonitorData(a.state.instanceId,a.state.timeTagValue,e.target.value)},a.handleAdd=function(){a.setState({kv_info_modal_visible:!0,kvId:0})},a.handleBatchUpdate=function(){var e=a.state.selectedRowKeys;0!==e.length?a.setState({extraInfoModalVisible:!0,updateMode:"batch",idsList:e}):D.b.warn("\u8bf7\u5148\u9009\u62e9\u6570\u636e")},a.onSelectChange=function(e){a.setState({selectedRowKeys:e})},a.handlePostKvInfoSubmit=a.handlePostKvInfoSubmit.bind(Object(g.a)(a)),a.handlePostKvInfoCancel=a.handlePostKvInfoCancel.bind(Object(g.a)(a)),a.handleExtraInfoOk=a.handleExtraInfoOk.bind(Object(g.a)(a)),a.handleExtraInfoCancel=a.handleExtraInfoCancel.bind(Object(g.a)(a));var n=a.props.isSuperAdmin?220:100;return a.formRef=i.a.createRef(),a.state={columns:[{title:"Id",dataIndex:"ID",key:"ID",width:50,render:function(e){return i.a.createElement(kt,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8bid",dataIndex:"InstanceId",key:"InstanceId",width:200,render:function(e){return i.a.createElement(kt,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8b\u540d\u79f0",dataIndex:"InstanceName",key:"InstanceName",width:250,render:function(e,t){return i.a.createElement(pe.a,{title:e},i.a.createElement(kt,{ellipsis:!0,style:{width:"100%"}},e))}},{title:"\u4e91\u8d26\u53f7",dataIndex:"CloudAccountName",key:"CloudAccountName",width:100,render:function(e){return i.a.createElement(kt,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8b\u7c7b\u578b",dataIndex:"InstanceType",key:"InstanceType",width:100,render:function(e){return i.a.createElement(kt,{ellipsis:!0},e)}},{title:"\u8fde\u63a5\u4e32",dataIndex:"ConnectionDomain",key:"ConnectionDomain",width:400,render:function(e){return i.a.createElement(It,{style:{marginBottom:0,fontSize:13},copyable:!0},e)}},{title:"\u5e26\u5bbd",dataIndex:"Bandwidth",key:"Bandwidth",width:100,render:function(e){return i.a.createElement(kt,{ellipsis:!0},e,"MB/s")}},{title:"\u8fde\u63a5\u6570",dataIndex:"Connections",key:"Connections",width:100,render:function(e){return i.a.createElement(kt,{ellipsis:!0},e)}},{title:"\u5bb9\u91cf",dataIndex:"Capacity",key:"Capacity",width:50,render:function(e){return i.a.createElement(kt,{ellipsis:!0},e/1024,"G")}},{title:"QPS",dataIndex:"QPS",key:"QPS",width:100,render:function(e){return i.a.createElement(kt,{ellipsis:!0},e)}},{title:"\u8fc7\u671f\u65f6\u95f4",dataIndex:"EndTime",key:"EndTime",width:100,render:function(e){return i.a.createElement(kt,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8b\u72b6\u6001",dataIndex:"InstanceStatus",key:"InstanceStatus",align:"center",width:100,render:function(e){return"Normal"===e?i.a.createElement(he.a,{status:"processing"}):i.a.createElement(he.a,{status:"error"})}},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",width:{operWidth:n},align:"center",render:function(e,t){return i.a.createElement("div",null,i.a.createElement(me.a,{type:"primary",size:"small",onClick:a.openMonitorDrawer.bind(Object(g.a)(a),t)},"\u76d1\u63a7"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{type:"info",size:"small",onClick:a.kvEdit.bind(Object(g.a)(a),t)},"\u7f16\u8f91"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(de.a,{title:"\u786e\u5b9a\u5220\u9664\u8be5\u9879\u5185\u5bb9?",onConfirm:a.kvDelete.bind(Object(g.a)(a),t),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(me.a,{type:"danger",size:"small"},"\u5220\u9664")))}}],extraInfoModalVisible:!1,tableLoading:!1,tableData:[],chartData:[],pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:function(e,t){return a.onShowSizeChange(e,t)},showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e,t){return a.changePage(e,t)}},drawerVisible:!1,drawerPlacement:"left",instanceId:"",timeTagValue:"1h",metricTagValue:"StandardConnectionUsage",chartFormat:"%",currentServerDetail:{},queryExpiredTime:null,queryKeyword:"",queryCloudAccount:"0",queryManageUser:"0",queryDefineGroup:"",cloudAccountList:[],kv_info_modal_visible:!1,selectedRowKeys:[],idsList:[],updateMode:"single",extraInfoData:{}},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onShowSizeChange",value:function(e,t){var a=this,n=Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t});this.setState({pagination:n},function(){a.refreshTableData()})}},{key:"componentDidMount",value:function(){this.refreshTableData(),this.loadCloudAccountsData()}},{key:"loadCloudAccountsData",value:function(){var e=this;Le(1,100).then(function(t){0===t.code?e.setState({cloudAccountList:t.data.accounts}):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"kvEdit",value:function(e){var t=this;Fe(e.ID).then(function(a){if(0!==a.code)D.b.error(a.msg);else{var n=!1;1===a.data.RenewStatus&&(n=!0);var r={renewStatus:n,renewSiteId:parseInt(a.data.RenewSiteId)?parseInt(a.data.RenewSiteId):null,bankAccount:parseInt(a.data.BankAccount)?parseInt(a.data.BankAccount):null,manageUser:parseInt(a.data.ManageUser)?parseInt(a.data.ManageUser):null,cost:a.data.Cost?a.data.Cost:"0",costType:a.data.CostType?a.data.CostType:"\u5143/\u6708",kvInstanceName:a.data.InstanceName,kvBandwidth:a.data.Bandwidth.toString(),kvCapacity:(a.data.Capacity/1024).toString(),kvExpiredTime:""!==a.data.EndTime?we()(a.data.EndTime):"",resForm:1===a.data.DataStatus?"\u963f\u91cc\u4e91":"\u624b\u52a8\u6dfb\u52a0"};t.setState({extraInfoModalVisible:!0,kvId:e.ID,updateMode:"single",resFrom:1===e.DataStatus?"\u963f\u91cc\u4e91":"\u624b\u52a8\u6dfb\u52a0",extraInfoData:r})}}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleExtraInfoOk",value:function(e){var t=this,a="";a="single"===this.state.updateMode?String(this.state.kvId):this.state.idsList.join(","),function(e){return V("cloud/kv",e)}(Object(fe.a)({},e,{id:a})).then(function(e){0===e.code?(D.b.success("\u4fee\u6539\u6210\u529f"),t.setState({extraInfoModalVisible:!1,selectedRowKeys:[]}),t.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleExtraInfoCancel",value:function(e){this.setState({extraInfoModalVisible:!1})}},{key:"kvDelete",value:function(e){var t,a=this;(t=e.ID,B("cloud/kv",{id:t})).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),a.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handlePostKvInfoSubmit",value:function(){var e=this;this.formRef.current.validateFields().then(function(t){var a;(a=Object(fe.a)({},t,{createTime:t.createTime.format("YYYY-MM-DD HH:mm:ss"),endTime:void 0===t.endTime?void 0:t.endTime.format("YYYY-MM-DD HH:mm:ss")}),P("cloud/kv",a)).then(function(t){0===t.code?(D.b.success("\u6dfb\u52a0\u6210\u529f\uff0c\u8bf7\u5230\u6743\u9650\u7ba1\u7406\u4e2d\u589e\u52a0\u8bbf\u95ee\u6743\u9650\uff01"),e.setState({kv_info_modal_visible:!1}),e.refreshTableData()):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})})}},{key:"handlePostKvInfoCancel",value:function(){this.setState({kv_info_modal_visible:!1})}},{key:"render",value:function(){var e;return e=this.state.cloudAccountList.map(function(e){return i.a.createElement(Ct,{key:e.id,value:e.id},e.accountName)}),i.a.createElement(Dt,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u4e91\u8d44\u6e90","KV\u5b58\u50a8","KV\u5217\u8868"]}),i.a.createElement(oe.a,{style:{padding:"0px 0px 10px 0px"}},i.a.createElement(ce.a,{span:3,className:"col-span"},i.a.createElement(be.a,{style:{width:"100%"},placeholder:"\u5230\u671f\u622a\u6b62\u65f6\u95f4",defaultValue:this.state.queryExpiredTime,onChange:this.onExpiredDateChange})),i.a.createElement(ce.a,{span:5,className:"col-span"},i.a.createElement(O.a,{placeholder:"\u8f93\u5165\u5b9e\u4f8bid\\\u540d\u79f0\\\u8fde\u63a5\u4e32\u67e5\u8be2",value:this.state.queryKeyword,onChange:this.keywordOnChange})),i.a.createElement(ce.a,{span:3,className:"col-span"},i.a.createElement(ye.a,{defaultValue:this.state.queryCloudAccount,style:{width:"100%"},onChange:this.handleCloudAccountChange},i.a.createElement(Ct,{value:"0"},"\u6240\u6709\u4e91\u8d26\u53f7"),e)),i.a.createElement(ce.a,{span:2,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},type:"primary",icon:i.a.createElement(ke.a,null),onClick:this.handleQuery},"\u67e5 \u8be2")),i.a.createElement(ce.a,{span:2,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},icon:i.a.createElement(Ie.a,null),onClick:this.handleAdd},"\u65b0 \u589e"))),i.a.createElement(xt,{formRef:this.formRef,kv_info_modal_visible:this.state.kv_info_modal_visible,handlePostKvInfoSubmit:this.handlePostKvInfoSubmit,handlePostKvInfoCancel:this.handlePostKvInfoCancel}),i.a.createElement(Qe,{editData:this.state.extraInfoData,resType:"kv",updateMode:this.state.updateMode,resFrom:this.state.resFrom,visible:this.state.extraInfoModalVisible,handleOk:this.handleExtraInfoOk,handleCancel:this.handleExtraInfoCancel}),i.a.createElement("div",null,i.a.createElement(re.a,{title:"\u5b9e\u4f8b\u8be6\u60c5\u53ca\u76d1\u63a7\u6570\u636e",placement:this.state.drawerPlacement,closable:!0,destroyOnClose:!0,onClose:this.onCloseDrawer,visible:this.state.drawerVisible,width:950},i.a.createElement(Ee.a,{defaultActiveKey:"1",tabPosition:"left",style:{marginLeft:-30}},i.a.createElement(Ot,{tab:"\u76d1\u63a7\u8be6\u60c5",key:"1"},i.a.createElement(le.a,{tip:"\u56fe\u8868\u751f\u6210\u4e2d...",spinning:this.state.chartLoading},i.a.createElement(oe.a,{style:{marginBottom:"10px"}},i.a.createElement(ce.a,{span:3,style:{lineHeight:"30px"}},"\u65f6\u95f4\u7ef4\u5ea6\uff1a"),i.a.createElement(ce.a,{span:15},i.a.createElement(se.a.Group,{value:this.state.timeTagValue,onChange:this.handleTimeTagChange},i.a.createElement(se.a.Button,{value:"1h"},"1\u5c0f\u65f6"),i.a.createElement(se.a.Button,{value:"6h"},"6\u5c0f\u65f6"),i.a.createElement(se.a.Button,{value:"12h"},"12\u5c0f\u65f6"),i.a.createElement(se.a.Button,{value:"1d"},"1 \u5929"),i.a.createElement(se.a.Button,{value:"3d"},"3 \u5929"),i.a.createElement(se.a.Button,{value:"7d"},"7 \u5929"),i.a.createElement(se.a.Button,{value:"14d"},"14 \u5929")))),i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:3,style:{lineHeight:"30px"}},"\u76d1\u63a7\u7ef4\u5ea6\uff1a"),i.a.createElement(ce.a,{span:16},i.a.createElement(se.a.Group,{value:this.state.metricTagValue,onChange:this.handleMetricTagChange},i.a.createElement(se.a.Button,{value:"StandardConnectionUsage"},"\u8fde\u63a5\u6570\u4f7f\u7528\u7387"),i.a.createElement(se.a.Button,{value:"StandardCpuUsage"},"CPU \u4f7f\u7528\u7387"),i.a.createElement(se.a.Button,{value:"StandardAvgRt"},"\u5e73\u5747\u54cd\u5e94\u65f6\u95f4"),i.a.createElement(se.a.Button,{value:"Standardappend"},"append \u547d\u4ee4\u7684\u6267\u884c\u9891\u7387")))),i.a.createElement(oe.a,{style:{marginTop:20}},i.a.createElement(ce.a,null,i.a.createElement(Ze,{width:800,height:400,data:this.state.chartData}))))),i.a.createElement(Ot,{tab:"\u4fe1\u606f\u8be6\u60c5",key:"2"},i.a.createElement(le.a,{tip:"\u6570\u636e\u83b7\u53d6\u4e2d...",spinning:this.state.serverDetailLoading},i.a.createElement(ie.a,{title:"\u57fa\u672c\u4fe1\u606f",bordered:!0,size:"small",column:2},i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8bID"},this.state.currentServerDetail.InstanceId),i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8b\u540d\u79f0"},this.state.currentServerDetail.InstanceName),i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8b\u7c7b\u578b"},this.state.currentServerDetail.InstanceType),i.a.createElement(ie.a.Item,{label:"\u67b6\u6784\u7c7b\u578b"},this.state.currentServerDetail.ArchitectureType),i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8b\u5e26\u5bbd"},this.state.currentServerDetail.Bandwidth),i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8b\u5bb9\u91cf"},this.state.currentServerDetail.Capacity),i.a.createElement(ie.a.Item,{label:"\u5e26\u5bbd"},this.state.currentServerDetail.Bandwidth),i.a.createElement(ie.a.Item,{label:"\u8fde\u63a5\u5730\u5740"},this.state.currentServerDetail.ConnectionDomain),i.a.createElement(ie.a.Item,{label:"\u7aef\u53e3"},this.state.currentServerDetail.Port),i.a.createElement(ie.a.Item,{label:"\u79c1\u6709IP"},this.state.currentServerDetail.PrivateIp),i.a.createElement(ie.a.Item,{label:"\u8fde\u63a5\u6570\u9650\u5236"},this.state.currentServerDetail.Connections),i.a.createElement(ie.a.Item,{label:"\u521b\u5efa\u65f6\u95f4"},this.state.currentServerDetail.CreateTime),i.a.createElement(ie.a.Item,{label:"\u8fc7\u671f\u65f6\u95f4"},this.state.currentServerDetail.EndTime),i.a.createElement(ie.a.Item,{label:"QPS"},this.state.currentServerDetail.QPS)))))),i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,bordered:!0,size:"small"})))}}]),t}(r.Component),jt=Z.a.Text,Tt=Z.a.Paragraph,Lt=b.a.Content,Mt=ye.a.Option,At=Ee.a.TabPane,_t=function(e){function t(e){var a;Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).refreshTableData=function(){a.setState({tableLoading:!0});var e={page:a.state.pagination.page,size:a.state.pagination.pageSize,queryKeyword:a.state.queryKeyword,queryCloudAccount:a.state.queryCloudAccount};qe(e).then(function(e){var t=a.state.pagination;t.total=parseInt(e.data.total),t.page=parseInt(e.data.page),t.showTotal(parseInt(e.data.total)),a.setState({pagination:t});for(var n=e.data.slb,r=[],i=0;i<n.length;i++)r.push({key:n[i].ID,ID:n[i].ID,LoadBalancerId:n[i].LoadBalancerId,LoadBalancerName:n[i].LoadBalancerName,Address:n[i].Address,InternetChargeType:n[i].InternetChargeType,CreateTime:we()(n[i].CreateTime).format("YYYY-MM-DD"),LoadBalancerStatus:n[i].LoadBalancerStatus,CloudAccountName:n[i].CloudAccountName});a.setState({tableData:r,tableLoading:!1})}).catch(function(e){D.b.error(e)})},a.openMonitorDrawer=function(e){a.setState({drawerVisible:!0,instanceId:e.LoadBalancerId,currentServerDetail:e},function(){a.refreshMonitorData(e.LoadBalancerId,a.state.timeTagValue,a.state.metricTagValue),a.refreshSeverDetail()})},a.refreshMonitorData=function(e,t,n){a.setState({chartLoading:!0}),Pe(e,t,n).then(function(e){if(0!==e.code)return D.b.error(e.msg),void a.setState({chartLoading:!1});if(""===e.data.Datapoints)return D.b.warn("\u672a\u83b7\u53d6\u5230\u76d1\u63a7\u6570\u636e\uff0c\u53ef\u80fd\u662f\u975e\u963f\u91cc\u4e91\u673a\u5668\u6216\u5176\u5b83\u539f\u56e0\uff01"),void a.setState({chartLoading:!1});for(var t=JSON.parse(e.data.Datapoints),n=[],r=0;r<t.length;r++)n.push({date:we()(t[r].timestamp).format("DD\u65e5HH:mm"),value:t[r].Average});a.setState({chartLoading:!1,chartData:n})}).catch(function(e){console.log(e)})},a.refreshSeverDetail=function(e){a.setState({serverDetailLoading:!0}),Ue(a.state.currentServerDetail.ID).then(function(e){0!==e.code&&D.b.error(e.msg),a.setState({currentServerDetail:e.data},function(){a.setState({serverDetailLoading:!1})})}).catch(function(e){console.log(e)})},a.changePage=function(e,t){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e,pageSize:t})},function(){a.refreshTableData()})},a.keywordOnChange=function(e){a.setState({queryKeyword:e.target.value})},a.handleCloudAccountChange=function(e){a.setState({queryCloudAccount:e})},a.handleQuery=function(){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:1,current:1})},function(){a.refreshTableData()})},a.onCloseDrawer=function(){a.setState({drawerVisible:!1})},a.handleTimeTagChange=function(e){a.setState({timeTagValue:e.target.value}),a.refreshMonitorData(a.state.instanceId,e.target.value,a.state.metricTagValue)},a.handleMetricTagChange=function(e){switch(a.setState({metricTagValue:e.target.value}),e.target.value){case"ActiveConnection":case"MaxConnection":case"HeathyServerCount":case"UnhealthyServerCount":a.setState({chartFormat:"Count"});break;default:a.setState({chartFormat:""})}a.refreshMonitorData(a.state.instanceId,a.state.timeTagValue,e.target.value)},a.onSelectChange=function(e){a.setState({selectedRowKeys:e})},a.changePage=a.changePage.bind(Object(g.a)(a));var n=a.props.isSuperAdmin?200:100;return a.state={columns:[{title:"Id",dataIndex:"ID",key:"ID",render:function(e){return i.a.createElement(jt,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8bid",dataIndex:"LoadBalancerId",key:"LoadBalancerId",render:function(e){return i.a.createElement(jt,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8b\u540d\u79f0",dataIndex:"LoadBalancerName",key:"LoadBalancerName",render:function(e,t){return i.a.createElement(pe.a,{title:e},i.a.createElement(jt,{ellipsis:!0,style:{width:"100%"}},e))}},{title:"\u4e91\u8d26\u53f7",dataIndex:"CloudAccountName",key:"CloudAccountName",render:function(e){return i.a.createElement(jt,{ellipsis:!0},e)}},{title:"\u670d\u52a1\u5730\u5740",dataIndex:"Address",key:"Address",width:200,render:function(e){return i.a.createElement(Tt,{style:{marginBottom:0},copyable:!0},e)}},{title:"\u8ba1\u8d39\u65b9\u5f0f",dataIndex:"InternetChargeType",key:"InternetChargeType",render:function(e){return e="4"===e?"\u6309\u6d41\u91cf\u8ba1\u8d39":"\u6309\u5e26\u5bbd\u8ba1\u8d39",i.a.createElement(jt,{ellipsis:!0},e)}},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"CreateTime",key:"CreateTime",render:function(e){return i.a.createElement(jt,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8b\u72b6\u6001",dataIndex:"LoadBalancerStatus",key:"LoadBalancerStatus",align:"center",render:function(e){return"active"===e?i.a.createElement(he.a,{status:"processing"}):i.a.createElement(he.a,{status:"error"})}},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",align:"center",width:{operWidth:n},render:function(e,t){return i.a.createElement("div",null,i.a.createElement(me.a,{type:"primary",size:"small",onClick:a.openMonitorDrawer.bind(Object(g.a)(a),t)},"\u76d1\u63a7"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(de.a,{title:"\u786e\u5b9a\u5220\u9664\u8be5\u9879\u5185\u5bb9?",onConfirm:a.slbDelete.bind(Object(g.a)(a),t),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(me.a,{type:"danger",size:"small"},"\u5220\u9664")))}}],tableLoading:!1,tableData:[],chartData:[],pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:function(e,t){return a.onShowSizeChange(e,t)},showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e,t){return a.changePage(e,t)}},extraInfoModalVisible:!1,drawerVisible:!1,drawerPlacement:"left",cloudAccountList:[],slbId:0,instanceId:"",timeTagValue:"1h",metricTagValue:"ActiveConnection",chartFormat:"Count",currentServerDetail:{},queryKeyword:"",queryCloudAccount:"0",queryManageUser:"0",queryDefineGroup:"",selectedRowKeys:[],idsList:[],updateMode:"single"},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onShowSizeChange",value:function(e,t){var a=this,n=Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t});this.setState({pagination:n},function(){a.refreshTableData()})}},{key:"componentDidMount",value:function(){this.refreshTableData(),this.loadCloudAccountsData()}},{key:"loadCloudAccountsData",value:function(){var e=this;Le(1,100).then(function(t){0===t.code?e.setState({cloudAccountList:t.data.accounts}):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"userDefineEdit",value:function(e){this.userDefineInfoFormRef.props.form.setFieldsValue({userRemark:e.UserRemark,userDefineGroup:e.UserDefineGroup}),this.setState({slbId:e.ID,userDefineInfoModalVisible:!0})}},{key:"slbDelete",value:function(e){var t,a=this;(t=e.ID,B("cloud/slb",{id:t})).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),a.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"render",value:function(){var e;return e=this.state.cloudAccountList.map(function(e){return i.a.createElement(Mt,{key:e.id,value:e.id},e.accountName)}),i.a.createElement(Lt,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u4e91\u8d44\u6e90","\u8d1f\u8f7d\u5747\u8861","\u8d1f\u8f7d\u5747\u8861\u5217\u8868"]}),i.a.createElement(oe.a,{style:{padding:"0px 0px 10px 0px"}},i.a.createElement(ce.a,{span:6,className:"col-span"},i.a.createElement(O.a,{style:{width:"100%"},placeholder:"\u8f93\u5165\u5b9e\u4f8bid\\\u540d\u79f0\\\u670d\u52a1\u5730\u5740\u67e5\u8be2",value:this.state.queryKeyword,onChange:this.keywordOnChange})),i.a.createElement(ce.a,{span:4,className:"col-span"},i.a.createElement(ye.a,{defaultValue:this.state.queryCloudAccount,style:{width:"100%"},onChange:this.handleCloudAccountChange},i.a.createElement(Mt,{value:"0"},"\u6240\u6709\u4e91\u8d26\u53f7"),e)),i.a.createElement(ce.a,{span:2,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},type:"primary",icon:i.a.createElement(ke.a,null),onClick:this.handleQuery},"\u67e5 \u8be2"))),i.a.createElement("div",null,i.a.createElement(re.a,{title:"\u5b9e\u4f8b\u8be6\u60c5\u53ca\u76d1\u63a7\u6570\u636e",placement:this.state.drawerPlacement,closable:!0,destroyOnClose:!0,onClose:this.onCloseDrawer,visible:this.state.drawerVisible,width:950},i.a.createElement(Ee.a,{defaultActiveKey:"1",tabPosition:"left",style:{marginLeft:-30}},i.a.createElement(At,{tab:"\u76d1\u63a7\u8be6\u60c5",key:"1"},i.a.createElement(le.a,{tip:"\u56fe\u8868\u751f\u6210\u4e2d...",spinning:this.state.chartLoading},i.a.createElement(oe.a,{style:{marginBottom:"10px"}},i.a.createElement(ce.a,{span:3,style:{lineHeight:"30px"}},"\u65f6\u95f4\u7ef4\u5ea6\uff1a"),i.a.createElement(ce.a,{span:15},i.a.createElement(se.a.Group,{value:this.state.timeTagValue,onChange:this.handleTimeTagChange},i.a.createElement(se.a.Button,{value:"1h"},"1\u5c0f\u65f6"),i.a.createElement(se.a.Button,{value:"6h"},"6\u5c0f\u65f6"),i.a.createElement(se.a.Button,{value:"12h"},"12\u5c0f\u65f6"),i.a.createElement(se.a.Button,{value:"1d"},"1 \u5929"),i.a.createElement(se.a.Button,{value:"3d"},"3 \u5929"),i.a.createElement(se.a.Button,{value:"7d"},"7 \u5929"),i.a.createElement(se.a.Button,{value:"14d"},"14 \u5929")))),i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:3,style:{lineHeight:"30px"}},"\u76d1\u63a7\u7ef4\u5ea6\uff1a"),i.a.createElement(ce.a,{span:16},i.a.createElement(se.a.Group,{value:this.state.metricTagValue,onChange:this.handleMetricTagChange},i.a.createElement(se.a.Button,{value:"ActiveConnection"},"\u7aef\u53e3\u5f53\u524d\u6d3b\u8dc3\u8fde\u63a5\u6570"),i.a.createElement(se.a.Button,{value:"MaxConnection"},"\u7aef\u53e3\u5f53\u524d\u5e76\u53d1\u8fde\u63a5\u6570"),i.a.createElement(se.a.Button,{value:"HeathyServerCount"},"\u540e\u7aef\u5065\u5eb7ECS\u5b9e\u4f8b\u4e2a\u6570"),i.a.createElement(se.a.Button,{value:"UnhealthyServerCount"},"\u540e\u7aef\u5f02\u5e38ECS\u5b9e\u4f8b\u4e2a\u6570")))),i.a.createElement(oe.a,{style:{marginTop:20}},i.a.createElement(ce.a,null,i.a.createElement(Ze,{width:800,height:400,data:this.state.chartData}))))),i.a.createElement(At,{tab:"\u4fe1\u606f\u8be6\u60c5",key:"2"},i.a.createElement(le.a,{tip:"\u6570\u636e\u83b7\u53d6\u4e2d...",spinning:this.state.serverDetailLoading},i.a.createElement(ie.a,{title:"\u57fa\u672c\u4fe1\u606f",bordered:!0,size:"small",column:2},i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8bID"},this.state.currentServerDetail.LoadBalancerId),i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8b\u540d\u79f0"},this.state.currentServerDetail.LoadBalancerName),i.a.createElement(ie.a.Item,{label:"\u5b9e\u4f8b\u72b6\u6001"},this.state.currentServerDetail.LoadBalancerStatus),i.a.createElement(ie.a.Item,{label:"\u670d\u52a1\u5730\u5740"},this.state.currentServerDetail.Address),i.a.createElement(ie.a.Item,{label:"\u8ba1\u8d39\u65b9\u5f0f"},this.state.currentServerDetail.InternetChargeType),i.a.createElement(ie.a.Item,{label:"\u4ed8\u8d39\u7c7b\u578b"},this.state.currentServerDetail.PayType),i.a.createElement(ie.a.Item,{label:"IP\u7248\u672c"},this.state.currentServerDetail.AddressIPVersion),i.a.createElement(ie.a.Item,{label:"\u521b\u5efa\u65f6\u95f4"},this.state.currentServerDetail.CreateTime)))))),i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,bordered:!0,size:"small"})))}}]),t}(r.Component),Rt=Z.a.Text,Nt=Z.a.Paragraph,zt=b.a.Content,Pt=ye.a.Option,Vt=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).confirm=function(e){a.handleDeleteAccountInfo(e)},a.showAddAccountModal=function(){a.setState({current_data_id:null,add_new_account_visible:!0})},a.handleAddAccountSubmit=function(e){a.formRef.current.validateFields().then(function(e){null!=a.state.current_data_id?(e.id=a.state.current_data_id,Ae(e).then(function(e){0===e.code&&(a.setState({add_new_account_visible:!1}),D.b.success("\u66f4\u65b0\u6210\u529f\uff01")),a.refreshTableData()}).catch(function(e){console.log(e)})):Me(e).then(function(e){0===e.code&&(a.setState({add_new_account_visible:!1}),D.b.success("\u65b0\u589e\u6210\u529f\uff01")),a.refreshTableData()}).catch(function(e){console.log(e)})})},a.handleAddAccountCancel=function(e){a.setState({add_new_account_visible:!1})},a.handleEditAccountInfo=function(e){setTimeout(function(){a.formRef.current.setFieldsValue({id:e.id,accountType:e.accountType,accountName:e.accountName,accountPwd:e.accountPwd,accountKey:e.accountKey,accountSecret:e.accountSecret,accountRegion:e.accountRegion,bankAccount:e.bankAccountId})},300),a.setState({current_data_id:e.id,add_new_account_visible:!0})},a.handleDeleteAccountInfo=function(e){_e({id:e.id}).then(function(e){0===e.code&&D.b.success("\u5220\u9664\u6210\u529f\uff01"),a.refreshTableData()}).catch(function(e){console.log(e)})},a.changePage=function(e,t){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e,pageSize:t})},function(){a.refreshTableData()})},a.refreshTableData=function(){a.setState({tableLoading:!0}),Le(a.state.pagination.page,a.state.pagination.pageSize).then(function(e){var t=a.state.pagination;t.total=parseInt(e.data.total),t.page=parseInt(e.data.page),t.showTotal(parseInt(e.data.total)),a.setState({pagination:t});for(var n=e.data.accounts,r=[],i=0;i<n.length;i++)r.push({id:n[i].id,key:n[i].id,accountType:n[i].accountType,accountName:n[i].accountName,accountPwd:n[i].accountPwd,accountKey:n[i].accountKey,accountSecret:n[i].accountSecret,accountRegion:n[i].accountRegion,bankAccountId:n[i].bankAccountId});a.setState({tableData:r,tableLoading:!1})}).catch(function(e){console.log(e)})},a.onShowSizeChange=a.onShowSizeChange.bind(Object(g.a)(a)),a.formRef=i.a.createRef(),a.state={columns:[{title:"\u4e91\u7c7b\u578b",dataIndex:"accountType",key:"accountType",className:"small_font",render:function(e){return i.a.createElement(Rt,{ellipsis:!0},e)}},{title:"\u8d26\u53f7\u540d\u79f0",dataIndex:"accountName",key:"accountName",className:"small_font",render:function(e){return i.a.createElement(Rt,{ellipsis:!0},e)}},{title:"\u8d26\u53f7\u5bc6\u7801",dataIndex:"accountPwd",key:"accountPwd",className:"small_font",render:function(e){return i.a.createElement(Rt,{ellipsis:!0},e)}},{title:"\u8bbf\u95eekey",dataIndex:"accountKey",key:"accountKey",className:"small_font",render:function(e){return i.a.createElement(Nt,{style:{marginBottom:0},copyable:!0},e)}},{title:"\u8bbf\u95eesecret",dataIndex:"accountSecret",key:"accountSecret",className:"small_font",render:function(e){return i.a.createElement(Nt,{style:{marginBottom:0},copyable:!0},e)}},{title:"\u6240\u5c5e\u533a\u57df",dataIndex:"accountRegion",key:"accountRegion",className:"small_font",render:function(e){return i.a.createElement(Rt,{ellipsis:!0},e)}},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",width:160,align:"center",className:"small_font",render:function(e,t){var n;return n=a.props.isSuperAdmin?i.a.createElement(r.Fragment,null,i.a.createElement(me.a,{type:"primary",size:"small",onClick:a.handleEditAccountInfo.bind(Object(g.a)(a),t)},"\u7f16\u8f91"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(de.a,{title:"\u786e\u5b9a\u5220\u9664\u8be5\u9879\u5185\u5bb9?",onConfirm:a.confirm.bind(Object(g.a)(a),t),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(me.a,{type:"danger",size:"small"},"\u5220\u9664"))):i.a.createElement("span",null,"\u65e0\u64cd\u4f5c\u6743\u9650"),i.a.createElement("div",null,n)}}],tableData:[],tableLoading:!1,add_new_account_visible:!1,current_data_id:null,pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:function(e,t){return a.onShowSizeChange(e,t)},showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e,t){return a.changePage(e,t)}}},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onShowSizeChange",value:function(e,t){var a=this,n=Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t});this.setState({pagination:n},function(){a.refreshTableData()})}},{key:"componentDidMount",value:function(){this.refreshTableData()}},{key:"render",value:function(){var e={labelCol:{span:7},wrapperCol:{span:14}};return i.a.createElement(zt,{style:{background:"#fff",padding:20,margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u4e91\u8d44\u6e90","\u4e91\u8d26\u53f7","\u8d26\u53f7\u5217\u8868"]}),this.props.isSuperAdmin?i.a.createElement("div",{style:{marginBottom:10}},i.a.createElement(me.a,{type:"primary",onClick:this.showAddAccountModal},"\u65b0\u589e\u8d26\u53f7")):"",i.a.createElement(E.a,{title:"\u4e91\u8d26\u53f7\u4fe1\u606f\u8be6\u60c5",visible:this.state.add_new_account_visible,onOk:this.handleAddAccountSubmit,onCancel:this.handleAddAccountCancel,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(S.a,{ref:this.formRef,initialValues:{accountType:"\u79c1\u6709\u4e91"}},i.a.createElement(S.a.Item,Object.assign({label:"\u4e91\u8d26\u53f7\u7c7b\u578b"},e,{name:"accountType",rules:[{required:!0,message:"\u8d26\u53f7\u7c7b\u578b\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(ye.a,{size:"default"},i.a.createElement(Pt,{value:"\u79c1\u6709\u4e91"},"\u79c1\u6709\u4e91"),i.a.createElement(Pt,{value:"\u963f\u91cc\u4e91"},"\u963f\u91cc\u4e91"))),i.a.createElement(S.a.Item,Object.assign({label:"\u4e91\u8d26\u53f7\u540d\u79f0"},e,{name:"accountName",rules:[{required:!0,message:"\u8d26\u53f7\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u4e91\u8d26\u53f7\u5bc6\u7801"},e,{name:"accountPwd",rules:[]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u4e91\u8d26\u53f7key"},e,{name:"accountKey",rules:[]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u4e91\u8d26\u53f7secret"},e,{name:"accountSecret",rules:[]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u6240\u5c5e\u533a\u57df"},e,{name:"accountRegion",rules:[{required:!0,message:"\u6240\u5c5e\u533a\u57df\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(O.a,null)))),i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,bordered:!0,size:"small"}))}}]),t}(r.Component),Bt=a(656),qt=(a(925),a(655)),Yt=(a(330),a(161)),Ft=(a(136),a(76)),Ut=(a(932),a(654)),Kt=(a(1236),a(505)),Ht=(a(939),a(316)),Jt=a(616),Gt=a(620),Qt=a(615),Wt=function(e){return z("daily_job/",e)},Zt=function(e){return V("daily_job/",e)},$t=function(e){return V("daily_job/executorUser",e)},Xt=Kt.a.Step,ea=b.a.Content,ta=ye.a.Option,aa=O.a.TextArea,na=[{value:"\u65e5\u5e38\u5de5\u4f5c",label:"\u65e5\u5e38\u5de5\u4f5c",children:[{value:"\u534f\u52a9",label:"\u534f\u52a9"}]}],ra={"":[{field:"task_content",text:"\u95ee\u9898\u63cf\u8ff0",type:"text",errorMessage:"\u8bf7\u8f93\u5165\u5177\u4f53\u95ee\u9898\u63cf\u8ff0",required:!0}],"\u65e5\u5e38\u5de5\u4f5c-\u534f\u52a9":[{field:"task_content",text:"\u5de5\u4f5c\u5185\u5bb9",type:"text",errorMessage:"\u8bf7\u8f93\u5165\u5177\u4f53\u5de5\u4f5c\u5185\u5bb9"},{field:"open_deploy_auto_config",text:"\u81ea\u5b9a\u4e49\u9879",type:"kvinput"}]},ia=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).addNewConfig=a.addNewConfig.bind(Object(g.a)(a)),a.state={configCount:0,configData:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.onChange=this.props.onChange}},{key:"deleteConfigItem",value:function(e){var t=e.index,a=this.state.configData;a.splice(t,1),this.setState({configData:a}),this.onChange(this.state.configData)}},{key:"addNewConfig",value:function(){var e=this.state.configData;e.push({key:"",value:""}),this.setState(e)}},{key:"handleKeyChange",value:function(e,t){var a=e.index,n=this.state.configData;n[a].key=t.target.value,this.setState(n),this.onChange(this.state.configData)}},{key:"handleValueChange",value:function(e,t){var a=e.index,n=this.state.configData;n[a].value=t.target.value,this.setState(n),this.onChange(this.state.configData)}},{key:"render",value:function(){var e=this,t=this.state.configData.map(function(t,a){return i.a.createElement(oe.a,null,i.a.createElement(Ht.a,{span:10,style:{marginRight:10}},i.a.createElement(O.a,{key:"k{index}",addonBefore:"\u952e",value:t.key,onChange:e.handleKeyChange.bind(e,{index:a})})),i.a.createElement(Ht.a,{span:10,style:{marginRight:10}},i.a.createElement(O.a,{key:"v{index}",addonBefore:"\u503c",value:t.value,onChange:e.handleValueChange.bind(e,{index:a})})),i.a.createElement(Ht.a,{span:2},i.a.createElement(me.a,{type:"sdanger",icon:i.a.createElement(Jt.a,null),shape:"circle",onClick:e.deleteConfigItem.bind(e,{index:a})})))});return i.a.createElement(r.Fragment,null,t,i.a.createElement(oe.a,null,i.a.createElement(Ht.a,{span:5},i.a.createElement(me.a,{type:"primary",icon:i.a.createElement(Ie.a,null),onClick:this.addNewConfig},"\u6dfb\u52a0\u65b0\u9879"))))}}]),t}(r.Component),la=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={deptData:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e={labelCol:{span:8},wrapperCol:{span:10}};return i.a.createElement(ea,{style:{height:"100%"}},i.a.createElement(S.a,{ref:this.props.formRef,initialValues:{importantDegree:"\u666e\u901a"}},i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u5de5\u5355\u540d\u79f0",name:"jobName",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5de5\u5355\u4efb\u52a1\u540d\u79f0"}]}),i.a.createElement(O.a,{placeholder:"\u8bf7\u8f93\u5165\u5de5\u5355\u4efb\u52a1\u540d\u79f0"})),i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u5de5\u5355\u7c7b\u578b",name:"jobType",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5de5\u5355\u7c7b\u578b"}]}),i.a.createElement(Ut.a,{placeholder:"\u8bf7\u9009\u62e9\u5de5\u5355\u7c7b\u578b",options:na})),i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u8be5\u4efb\u52a1\u7d27\u6025\u7a0b\u5ea6",style:{textAlign:"left"},name:"importantDegree",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u4efb\u52a1\u7d27\u6025\u7a0b\u5ea6"}]}),i.a.createElement(se.a.Group,{buttonStyle:"solid"},i.a.createElement(pe.a,{placement:"topLeft",title:"\u7b49\u5f85\u76f8\u5173\u4eba\u5458\u6839\u636e\u81ea\u8eab\u4efb\u52a1\u9879\u5b89\u6392\u65f6\u95f4\u5904\u7406"},i.a.createElement(se.a.Button,{value:"\u666e\u901a"},"\u666e\u901a")),i.a.createElement(pe.a,{placement:"topLeft",title:"\u9700\u8981\u5728\u534a\u5c0f\u65f6\u5185\u5904\u7406\u5b8c\u6210"},i.a.createElement(se.a.Button,{value:"\u7d27\u6025"},"\u7d27\u6025")),i.a.createElement(pe.a,{placement:"topLeft",title:"\u9700\u8981\u7acb\u5373\u5b89\u6392\u4eba\u5458\u5904\u7406"},i.a.createElement(se.a.Button,{value:"\u975e\u5e38\u7d27\u6025"},"\u975e\u5e38\u7d27\u6025"))))))}}]),t}(r.Component),sa=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).getFormInputContent=a.getFormInputContent.bind(Object(g.a)(a)),a.state={},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"getFormInputContent",value:function(e){var t;switch(e.type){case"char":t=i.a.createElement(O.a,null);break;case"text":t=i.a.createElement(aa,{rows:4});break;case"select":t=i.a.createElement(ye.a,{style:{width:120}},e.options.map(function(e,t){return i.a.createElement(ta,{key:t,value:e},e)}));break;case"kvinput":t=i.a.createElement(ia,null);break;default:t=i.a.createElement(O.a,null)}return t}},{key:"render",value:function(){var e,t=this,a={labelCol:{span:4},wrapperCol:{span:18}},n=ra[this.props.jobType];return void 0===n&&(n=ra[""]),e=n.map(function(e,n){return i.a.createElement(S.a.Item,Object.assign({key:n},a,{label:e.text,style:{textAlign:"left"},name:e.field,rules:[{required:e.required,message:e.errorMessage}]}),t.getFormInputContent(e))}),i.a.createElement(ea,{style:{height:"100%"}},i.a.createElement(S.a,{ref:this.props.formRef},i.a.createElement(S.a.Item,Object.assign({},a,{label:"\u5173\u5065\u4fe1\u606f",required:!0}),i.a.createElement(Ft.a,{span:20,size:"small",title:"\u586b\u5199\u5b8c\u5584\u548c\u51c6\u786e\u53ef\u4ee5\u63d0\u9ad8\u5de5\u5355\u5904\u7406\u6548\u7387\u54e6",headStyle:{backgroundColor:"#e6f7ff",fontWeight:"350"}},e)),i.a.createElement(oe.a,{style:{marginBottom:10}},i.a.createElement(Ht.a,{span:4}),i.a.createElement(Ht.a,{span:18},i.a.createElement(Yt.a,{message:"\u4f60\u53ef\u4ee5\u5728\u5907\u6ce8\u4fe1\u606f\u4e2d\u586b\u5199\u6ce8\u610f\u4e8b\u9879\uff0c\u53ef\u4ee5\u907f\u514d\u6267\u884c\u8fc7\u7a0b\u4e2d\u51fa\u9519\u54e6",type:"info",closable:!0}))),i.a.createElement(S.a.Item,Object.assign({},a,{label:"\u5907\u6ce8\u4fe1\u606f",name:"remark"}),i.a.createElement(aa,{rows:4}))))}}]),t}(r.Component),oa=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).submitJobForm=a.submitJobForm.bind(Object(g.a)(a)),a.baseInfoFormRef=i.a.createRef(),a.configInfoFormRef=i.a.createRef(),a.state={current:0,stepStatus:"wait",jobTypeStr:"",form1Data:null,form2Data:null,submitLoading:!1},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"next",value:function(){var e=this;0===this.state.current&&this.baseInfoFormRef.current.validateFields().then(function(t){var a=e.state.current+1,n=Object.assign({},e.state.form1Data,t);e.setState({current:a,stepStatus:"process",jobTypeStr:t.jobType.join("-"),form1Data:n}),e.carousel.next()}).catch(function(t){e.setState({stepStatus:"error"})})}},{key:"prev",value:function(){switch(this.state.current){case 2:this.setState({form3Data:null});break;case 1:this.setState({form2Data:null})}var e=this.state.current-1;this.setState({current:e}),this.carousel.prev()}},{key:"submitJobForm",value:function(){var e=this;this.configInfoFormRef.current.validateFields().then(function(t){var a=Object.assign({},e.state.form2Data,t);e.setState({stepStatus:"finish",form2Data:a},function(){e.setState({submitLoading:!0});var t,a=Object(fe.a)({},e.state.form1Data,e.state.form2Data,{jobType:e.state.form1Data.jobType.join("-"),open_deploy_auto_config:JSON.stringify(e.state.form2Data.open_deploy_auto_config)});(t=a,P("daily_job/",t)).then(function(t){0===t.code?(e.setState({submitLoading:!1}),D.b.success(t.msg),e.props.history.push("/admin/task/jobs")):(e.setState({submitLoading:!1}),D.b.error(t.msg))}).catch(function(t){e.setState({submitLoading:!1}),D.b.error(t.toLocaleString())})})}).catch(function(t){e.setState({stepStatus:"error"})})}},{key:"render",value:function(){var e=this,t=this.state.current;return i.a.createElement(ea,{style:{background:"#fff",margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u5de5\u4f5c\u534f\u52a9","\u65e5\u5e38\u5de5\u5355"]}),i.a.createElement(Kt.a,{current:t,size:"small",style:{marginTop:20},status:this.state.stepStatus},i.a.createElement(Xt,{title:"\u4efb\u52a1\u57fa\u672c\u4fe1\u606f",icon:i.a.createElement(Gt.a,null)}),i.a.createElement(Xt,{title:"\u4efb\u52a1\u8be6\u60c5",icon:i.a.createElement(Qt.a,null)})),i.a.createElement("div",{className:"steps-content",style:{textAlign:"center",padding:20}},i.a.createElement(qt.a,{ref:function(t){e.carousel=t},dots:!1,effect:"fade",adaptiveHeight:!0,style:{textAlign:"center"}},i.a.createElement(r.Fragment,{key:1},i.a.createElement(la,{formRef:this.baseInfoFormRef})),i.a.createElement(r.Fragment,{key:2},i.a.createElement(sa,{formRef:this.configInfoFormRef,jobType:this.state.jobTypeStr,loadConfigDataTemplateSpin:this.state.loadConfigDataTemplateSpin})))),i.a.createElement("div",{className:"steps-action",style:{textAlign:"center",marginTop:20}},t<1&&i.a.createElement(me.a,{type:"primary",onClick:function(){return e.next()}},"\u4e0b\u4e00\u6b65"),1===t&&i.a.createElement(me.a,{type:"primary",loading:this.state.submitLoading,onClick:this.submitJobForm},"\u63d0 \u4ea4"),t>0&&i.a.createElement(me.a,{style:{marginLeft:8},onClick:function(){return e.prev()}},"\u4e0a\u4e00\u6b65")))}}]),t}(r.Component),ca=(a(172),a(50)),da=a(327),ua=a.n(da);function ma(){var e=localStorage.getItem("ops_token");if(void 0!==e&&null!==e&&""!==e)return ua()(e).userInfo.userId;window.location.href="/login"}we.a.locale("zh-cn");var ha,pa=O.a.TextArea,fa=Z.a.Text,ba=Z.a.Paragraph,ga=b.a.Content,ya="0001-01-01 00:00:00",Ea=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).changePage=function(e,t){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e,pageSize:t})},function(){a.refreshTableData()})},a.handlerChangeExecutorCommit=function(){if(0!==a.state.changeToUserId){var e={jobId:a.state.jobChangeId,changeUserId:a.state.changeToUserId};$t(e).then(function(e){0===e.code?(D.b.success(e.msg),a.setState({changeExecutorModalVisible:!1}),a.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}else D.b.error("\u8bf7\u9009\u62e9\u4efb\u52a1\u6267\u884c\u4eba")},a.handlerRefuseJobCommit=function(){0!==a.state.refuseId?""!==a.state.refuseReason?Zt({id:a.state.refuseId,refuseReason:a.state.refuseReason,action:"refuseJob"}).then(function(e){0===e.code?(a.setState({refuseJobModalVisible:!1}),D.b.success("\u64cd\u4f5c\u6210\u529f"),a.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())}):D.b.error("\u5fc5\u987b\u586b\u5199\u62d2\u7edd\u539f\u56e0"):D.b.error("\u672a\u9009\u62e9\u62d2\u7edd\u5de5\u5355")},a.refreshTableData=function(){a.setState({tableLoading:!0});var e={page:a.state.pagination.page,size:a.state.pagination.pageSize,queryKeyword:a.state.queryKeyword,queryCreateTime:a.state.queryCreateTime};Wt(e).then(function(e){var t=a.state.pagination;t.total=parseInt(e.data.total),t.page=parseInt(e.data.page),t.showTotal(parseInt(e.data.total)),a.setState({pagination:t});for(var n=e.data.jobs,r=[],i=0;i<n.length;i++)r.push({key:n[i].id,id:n[i].id,job_name:n[i].job_name,job_type:n[i].job_type,important_degree:n[i].important_degree,creator_user_name:n[i].creator_user_name,executor_user_name:n[i].executor_user_name,status:n[i].status,create_time:n[i].create_time,accept_time:n[i].accept_time,end_time:n[i].end_time,approve_id:n[i].approve_id,approve_content:n[i].approve_content,refuse_reason:n[i].refuse_reason,isExecutorChangable:2===n[i].status&&n[i].executor_user_id===ma(),isGetEnable:1===n[i].status,isFinishEnable:2===n[i].status&&n[i].executor_user_id===ma(),isDeleteEnable:n[i].creator_user_id===ma()&&n[i].status<2,isRefuseEnable:1===n[i].status});a.setState({tableData:r,tableLoading:!1})}).catch(function(e){console.log(e)})},a.keywordOnChange=function(e){a.setState({queryKeyword:e.target.value})},a.handleQuery=function(){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:1,current:1})},function(){a.refreshTableData()})},a.onDrawerClose=function(){a.setState({drawerVisible:!1})},a.onQueryDateChange=function(e){null==e?a.setState({queryCreateTime:null}):a.setState({queryCreateTime:e.format("YYYY-MM-DD")})},a.downloadFile=a.downloadFile.bind(Object(g.a)(a)),a.ChangeExecutorSelect=a.ChangeExecutorSelect.bind(Object(g.a)(a)),a.changeRefuseReason=a.changeRefuseReason.bind(Object(g.a)(a)),a.autoCreateJob=a.autoCreateJob.bind(Object(g.a)(a)),a.state={columns:[{title:"Id",dataIndex:"id",key:"id",width:50,render:function(e){return i.a.createElement(fa,{ellipsis:!0},e)}},{title:"\u7d27\u6025\u5ea6",dataIndex:"important_degree",key:"important_degree",width:70,render:function(e){var t;switch(e){case"\u975e\u5e38\u7d27\u6025":t=i.a.createElement(ca.a,{color:"#f50"},e);break;case"\u7d27\u6025":t=i.a.createElement(ca.a,{color:"rgb(255, 147, 137)"},e);break;default:t=i.a.createElement(ca.a,{color:"#108ee9"},e)}return t}},{title:"\u72b6\u6001",dataIndex:"status",key:"status",width:50,render:function(e){var t=a.getStatusText(e);return i.a.createElement(fa,{ellipsis:!0},t)}},{title:"\u4efb\u52a1\u540d",dataIndex:"job_name",key:"job_name",width:200,render:function(e){return i.a.createElement(fa,{ellipsis:!0},e)}},{title:"\u4efb\u52a1\u7c7b\u578b",dataIndex:"job_type",key:"job_type",width:100,render:function(e){return i.a.createElement(fa,{ellipsis:!0},e)}},{title:"\u521b\u5efa\u4eba",dataIndex:"creator_user_name",key:"creator_user_name",width:70,render:function(e){return i.a.createElement(fa,{ellipsis:!0},e)}},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"create_time",key:"create_time",width:150,render:function(e){return i.a.createElement(fa,{ellipsis:!0},we()(e).format("MM\u6708DD\u65e5HH:mm"))}},{title:"\u6267\u884c\u4eba",dataIndex:"executor_user_name",key:"executor_user_name",width:70,render:function(e){return i.a.createElement(fa,{ellipsis:!0},e)}},{title:"\u54cd\u5e94\u65f6\u95f4",dataIndex:"accept_time",key:"accept_time",width:150,render:function(e){return e===ya?i.a.createElement(fa,{ellipsis:!0},"-"):i.a.createElement(fa,{ellipsis:!0},we()(e).format("MM\u6708DD\u65e5HH:mm"))}},{title:"\u7ed3\u675f\u65f6\u95f4",dataIndex:"end_time",key:"end_time",width:150,render:function(e){return e===ya?i.a.createElement(fa,{ellipsis:!0},"-"):i.a.createElement(fa,{ellipsis:!0},we()(e).format("MM\u6708DD\u65e5HH:mm"))}},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",align:"center",render:function(e,t){return i.a.createElement(r.Fragment,null,i.a.createElement(me.a,{type:"primary",size:"small",onClick:a.showJobDetail.bind(Object(g.a)(a),t)},"\u8be6\u60c5"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{type:"info",size:"small",disabled:!t.isGetEnable,onClick:a.startJob.bind(Object(g.a)(a),t.id)},"\u9886\u53d6"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{type:"info",size:"small",disabled:!t.isFinishEnable,onClick:a.finishJob.bind(Object(g.a)(a),t.id)},"\u5b8c\u6210"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{type:"danger",size:"small",disabled:!t.isRefuseEnable,onClick:a.refuseJob.bind(Object(g.a)(a),t.id)},"\u62d2\u7edd"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{type:"danger",size:"small",disabled:!t.isDeleteEnable,onClick:a.deleteJob.bind(Object(g.a)(a),t.id)},"\u5220\u9664"))}}],tableLoading:!1,drawerSpinning:!1,drawerVisible:!1,opsUsersList:[],changeExecutorModalVisible:!1,refuseJobModalVisible:!1,refuseId:0,refuseReason:"",changeToUserId:0,jobChangeId:0,tableData:[],pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:function(e,t){return a.onShowSizeChange(e,t)},showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e,t){return a.changePage(e,t)}},job_file:"",queryKeyword:"",currentJob:"",currentJobDetail:"",isGetEnable:!0,isFinishEnable:!0,isDeleteEnable:!0,queryCreateTime:null},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onShowSizeChange",value:function(e,t){var a=this,n=Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t});this.setState({pagination:n},function(){a.refreshTableData()})}},{key:"componentDidMount",value:function(){this.refreshTableData()}},{key:"showJobDetail",value:function(e){var t,a=this;this.setState({drawerVisible:!0,drawerSpinning:!0,currentJob:e}),(t=e.id,z("daily_job/info/"+t)).then(function(e){0===e.code?a.setState(Object(fe.a)({},e.data,{currentJobDetail:e.data}),function(){}):D.b.error(e.msg),a.setState({drawerSpinning:!1})}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"startJob",value:function(e){var t=this;Zt({id:e,action:"getJob"}).then(function(e){if(0===e.code){var a=Object.assign({},t.state.currentJob,{isGetEnable:!1});D.b.success("\u9886\u53d6\u6210\u529f"),t.setState({currentJob:a}),t.refreshTableData()}else D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"changeExecutor",value:function(e){this.setState({changeExecutorModalVisible:!0,jobChangeId:e})}},{key:"ChangeExecutorSelect",value:function(e){this.setState({changeToUserId:e})}},{key:"changeRefuseReason",value:function(e){this.setState({refuseReason:e.target.value})}},{key:"finishJob",value:function(e){var t=this;Zt({id:e,action:"finishJob"}).then(function(e){0===e.code?(D.b.success("\u6210\u529f\u5b8c\u6210\uff0c\u7ee7\u7eed\u52aa\u529b"),t.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"refuseJob",value:function(e){this.setState({refuseJobModalVisible:!0,refuseId:e})}},{key:"deleteJob",value:function(e){var t=this;Zt({id:e,action:"deleteJob"}).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),t.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"downloadFile",value:function(){window.open("http://commonops.com:9999/fileDownload?objectName="+encodeURIComponent(this.state.job_file),"_blank")}},{key:"autoCreateJob",value:function(){localStorage.setItem("job_template",JSON.stringify(this.state.currentJobDetail)),this.props.history.push({pathname:"/admin/task/deploy_project"})}},{key:"getStatusText",value:function(e){var t;switch(e){case 1:t=i.a.createElement(ca.a,{color:"volcano"},"\u5f85\u9886\u53d6");break;case 2:t=i.a.createElement(ca.a,{color:"geekblue"},"\u5904\u7406\u4e2d");break;case 3:t=i.a.createElement(ca.a,{color:"green"},"\u5df2\u5b8c\u6210");break;case 0:t=i.a.createElement(ca.a,{color:"magenta"},"\u5df2\u62d2\u7edd");break;default:t=i.a.createElement(ca.a,{color:"lime"},"\u5df2\u5220\u9664")}return t}},{key:"render",value:function(){var e,t=this;if(this.state.status>0&&this.state.status<3){var a=we()(this.state.create_time),n=we()(we()().format("YYYY-MM-DD HH:mm:ss")),l=we.a.duration(n-a,"ms");e=this.state.creator_user_name+" \u5df2\u7b49\u5f85 "+l.humanize()}else{var s=we()(this.state.create_time),o=we()(this.state.end_time);e="\u5de5\u5355\u7528\u65f6: "+we.a.duration(o-s,"ms").humanize()}var c=i.a.createElement(ie.a.Item,{label:"\u65e0\u914d\u7f6e"},"\u7528\u6237\u672a\u8bbe\u7f6e");void 0!==this.state.open_deploy_auto_config&&""!==this.state.open_deploy_auto_config&&(c=JSON.parse(this.state.open_deploy_auto_config).map(function(e,t){return i.a.createElement(ie.a.Item,{key:t,label:e.key},i.a.createElement(ba,{style:{marginBottom:0,width:"300px"},ellipsis:!0,copyable:""!==e.value},e.value))}));var d="";0===this.state.status&&(d=i.a.createElement(Yt.a,{style:{marginTop:10},message:i.a.createElement(r.Fragment,null,"\u62d2\u7edd\u539f\u56e0\uff1a",this.state.refuse_reason),type:"error"}));var u=i.a.createElement("div",null,i.a.createElement("span",{style:{marginRight:"20px"}},"\u5de5\u5355\u8be6\u60c5"));return i.a.createElement(ga,{stmayle:{background:"#fff",margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u5de5\u4f5c\u534f\u52a9","\u5de5\u5355\u5217\u8868"]}),i.a.createElement("div",{style:{marginBottom:20}},i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:8,className:"col-span"},i.a.createElement(O.a,{placeholder:"\u8f93\u5165\u5de5\u5355\u540d\u79f0\u3001\u521b\u5efa\u4eba\u3001\u6267\u884c\u4eba\u67e5\u8be2",value:this.state.queryKeyword,onChange:this.keywordOnChange})),i.a.createElement(ce.a,{span:3,className:"col-span"},i.a.createElement(be.a,{style:{width:"100%"},defaultValue:this.state.queryCreateTime,placeholder:"\u521b\u5efa\u65f6\u95f4",onChange:this.onQueryDateChange})),i.a.createElement(ce.a,{span:3},i.a.createElement(me.a,{type:"primary",icon:i.a.createElement(ke.a,null),onClick:this.handleQuery},"\u67e5 \u8be2")))),i.a.createElement(E.a,{title:"\u4f60\u6b63\u5728\u62d2\u7edd\u4ed6\u4eba\u5de5\u5355\uff0c\u8bf7\u8c28\u614e\u64cd\u4f5c\uff01",visible:this.state.refuseJobModalVisible,onOk:this.handlerRefuseJobCommit,onCancel:function(){t.setState({refuseJobModalVisible:!1})},style:{textAlign:"center"}},i.a.createElement(Yt.a,{type:"warning",message:"\u8bf7\u8be6\u7ec6\u586b\u5199\u4f60\u7684\u62d2\u7edd\u7406\u7531\uff0c\u5c06\u53cd\u9988\u7ed9\u5de5\u5355\u521b\u5efa\u8005\u5e76\u7559\u5b58\uff01",style:{marginBottom:10}}),i.a.createElement(pa,{rows:4,placeholder:"\u586b\u5199\u8be6\u7ec6\u62d2\u7edd\u539f\u56e0\uff0c\u4ee5\u4fbf\u5bf9\u65b9\u540e\u7eed\u5b8c\u5584",onChange:this.changeRefuseReason})),i.a.createElement(re.a,{title:u,placement:"left",closable:!0,onClose:this.onDrawerClose,visible:this.state.drawerVisible,width:800},i.a.createElement(le.a,{tip:"\u6570\u636e\u52a0\u8f7d\u4e2d...",spinning:this.state.drawerSpinning},i.a.createElement(oe.a,{style:{marginBottom:10}},i.a.createElement(ce.a,{span:24,style:{fontSize:15}},i.a.createElement(Yt.a,{message:i.a.createElement(r.Fragment,null,this.getStatusText(this.state.status),this.state.job_name),type:"info"}),d)),i.a.createElement(oe.a,{style:{marginBottom:10}},i.a.createElement(ce.a,{span:24},i.a.createElement(Yt.a,{message:e,type:"warning",showIcon:!0}))),i.a.createElement(oe.a,{style:{marginTop:"10px"}},i.a.createElement(Ft.a,{size:"small",title:"\u5de5\u5355\u57fa\u672c\u4fe1\u606f",style:{marginBottom:10,width:"100%"}},i.a.createElement(ie.a,{bordered:!0,size:"small",column:2},i.a.createElement(ie.a.Item,{label:"\u4efb\u52a1\u7c7b\u578b"},this.state.job_type),i.a.createElement(ie.a.Item,{label:"\u7d27\u6025\u5ea6"},this.state.important_degree),i.a.createElement(ie.a.Item,{label:"\u53d1\u8d77\u65f6\u95f4"},this.state.create_time)))),i.a.createElement(oe.a,{style:{marginTop:"10px"}},i.a.createElement(Ft.a,{size:"small",title:"\u5de5\u4f5c\u5185\u5bb9",style:{marginBottom:10,width:"100%"}},i.a.createElement(ba,{style:{marginBottom:0},ellipsis:!0,copyable:""!==this.state.task_content},this.state.task_content)),i.a.createElement(Ft.a,{size:"small",title:"\u81ea\u5b9a\u4e49\u9879",style:{width:"100%"}},i.a.createElement(ie.a,{bordered:!0,size:"small",column:1,style:{marginTop:"10px"}},c)),i.a.createElement(Ft.a,{size:"small",title:"\u7528\u6237\u5907\u6ce8",style:{width:"100%"}},i.a.createElement(ba,{style:{marginBottom:0},ellipsis:!0,copyable:""!==this.state.remark},this.state.remark))),i.a.createElement(oe.a,{style:{textAlign:"center",marginTop:20}},i.a.createElement(ce.a,{span:7}),i.a.createElement(ce.a,{span:4},i.a.createElement(me.a,{type:"primary",disabled:!this.state.currentJob.isGetEnable,onClick:this.startJob.bind(this,this.state.currentJob.id)},"\u4e00\u952e\u9886\u53d6")),i.a.createElement(ce.a,{offset:1}),i.a.createElement(ce.a,{span:4},i.a.createElement(me.a,{type:"danger",disabled:!this.state.currentJob.isFinishEnable,onClick:this.finishJob.bind(this,this.state.currentJob.id)},"\u6211\u5df2\u5b8c\u6210")),i.a.createElement(ce.a,{span:7})),i.a.createElement(oe.a,{style:{minHeight:30}}))),i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,bordered:!0,size:"small"}))}}]),t}(r.Component),va=Ea,Sa=Bt.Layout.Content,ka=function(e){function t(){return Object(o.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(Sa,{style:{background:"#fff",padding:20,margin:0,height:"100%"}},i.a.createElement(p.a,null,i.a.createElement(f.a,{path:"/admin/task/deploy_project",component:oa}),i.a.createElement(f.a,{path:"/admin/task/jobs",component:va})))}}]),t}(r.Component),Ia=ka,Ca=b.a.Content,Da=Z.a.Text,Oa={overFlow:"hidden",textOverflow:"ellipsis",display:"-webkit-box"},xa=function(e){function t(){return Object(o.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e={labelCol:{span:7},wrapperCol:{span:14}};return i.a.createElement(E.a,{title:"\u65b0\u589e\u7528\u6237",destroyOnClose:!0,visible:this.props.userModalVisible,onOk:this.props.handleAddUserSubmit,onCancel:this.props.handleAddUserCancel,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",centered:!0,width:600},i.a.createElement(S.a,{ref:this.props.formRef},i.a.createElement(S.a.Item,Object.assign({label:"\u90ae\u7bb1"},e,{name:"email",rules:[{required:!0,message:"\u6ce8\u518c\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u7528\u6237\u540d"},e,{name:"username",rules:[{required:!0,message:"\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u521d\u59cb\u5bc6\u7801"},e,{name:"password",rules:[{required:!0,message:"\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u804c\u4f4d"},e,{name:"position",rules:[{required:!0,message:"\u804c\u4f4d\u4e0d\u80fd\u4e3a\u7a7a\uff01"}]}),i.a.createElement(O.a,null))))}}]),t}(r.Component),wa=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).changePage=function(e,t){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e,pageSize:t})},function(){a.refreshTableData()})},a.refreshTableData=function(){a.setState({tableLoading:!0}),q(a.state.pagination.page,a.state.pagination.pageSize).then(function(e){var t=a.state.pagination;t.total=parseInt(e.data.total),t.page=parseInt(e.data.page),t.showTotal(parseInt(e.data.total)),a.setState({pagination:t});for(var n=e.data.users,r=[],i=0;i<n.length;i++)r.push({ID:n[i].ID,username:n[i].username,email:n[i].email,position:n[i].position,active:n[i].active,count:n.length});a.setState({tableData:r,tableLoading:!1})}).catch(function(e){console.log(e)})},a.onShowSizeChange=a.onShowSizeChange.bind(Object(g.a)(a)),a.handleAdd=a.handleAdd.bind(Object(g.a)(a)),a.handleAddUserSubmit=a.handleAddUserSubmit.bind(Object(g.a)(a)),a.handleAddUserCancel=a.handleAddUserCancel.bind(Object(g.a)(a)),a.formRef=i.a.createRef(),a.state={columns:[{title:"ID",dataIndex:"ID",key:"ID",width:60,render:function(e){return i.a.createElement(Da,{ellipsis:!0},e)}},{title:"\u7528\u6237\u540d",dataIndex:"username",key:"username",width:100,render:function(e){return i.a.createElement(Da,{ellipsis:!0},e)}},{title:"\u90ae\u7bb1",dataIndex:"email",key:"email",className:{columnStyle:Oa},width:100,render:function(e){return i.a.createElement(Da,{ellipsis:!0},e)}},{title:"\u804c\u4f4d",dataIndex:"position",key:"position",className:{columnStyle:Oa},width:100,render:function(e){return i.a.createElement(Da,{ellipsis:!0},e)}},{title:"\u72b6\u6001",dataIndex:"active",key:"active",className:{columnStyle:Oa},width:100,render:function(e){return!0===e?i.a.createElement(Da,{ellipsis:!0},i.a.createElement(ca.a,{color:"geekblue"},"\u6b63\u5e38")):i.a.createElement(Da,{ellipsis:!0},i.a.createElement(ca.a,{color:"red"},"\u7981\u7528"))}},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",width:140,align:"center",render:function(e,t){var n=!1;return 1===t.count&&"admin@ops.com"===t.email&&(n=!0),i.a.createElement("div",null,i.a.createElement(me.a,{type:"primary",size:"small",disabled:n,onClick:a.updateUserActiveStatus.bind(Object(g.a)(a),t.email,!0)},"\u542f\u7528"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{type:"danger",size:"small",disabled:n,onClick:a.updateUserActiveStatus.bind(Object(g.a)(a),t.email,!1)},"\u7981\u7528"))}}],tableData:[],tableLoading:!1,add_new_account_visible:!1,current_data_id:null,current_user:{},detailDrawerVisible:!1,pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:function(e,t){return a.onShowSizeChange(e,t)},showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e,t){return a.changePage(e,t)}},userModalVisible:!1},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onShowSizeChange",value:function(e,t){var a=this,n=Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t});this.setState({pagination:n},function(){a.refreshTableData()})}},{key:"componentDidMount",value:function(){this.refreshTableData()}},{key:"handleAdd",value:function(){this.setState({userModalVisible:!0})}},{key:"handleAddUserSubmit",value:function(){var e=this;this.formRef.current.validateFields().then(function(t){var a;(a=Object(fe.a)({},t),P("user/create",a)).then(function(t){0===t.code?(e.setState({userModalVisible:!1}),e.refreshTableData()):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})})}},{key:"handleAddUserCancel",value:function(){this.setState({userModalVisible:!1})}},{key:"updateUserActiveStatus",value:function(e,t){var a,n=this;(a={email:e,active:t},V("user/active",a)).then(function(e){0===e.code?(D.b.success("\u64cd\u4f5c\u6210\u529f\uff01"),n.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"render",value:function(){return i.a.createElement(Ca,{style:{background:"#fff",padding:20,margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u6743\u9650\u7ba1\u7406","\u7528\u6237\u7ba1\u7406","\u7528\u6237\u5217\u8868"]}),i.a.createElement(oe.a,{style:{padding:"0px 0px 10px 0px"}},i.a.createElement(ce.a,{span:2,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},icon:i.a.createElement(Ie.a,null),onClick:this.handleAdd},"\u65b0 \u589e"))),i.a.createElement(xa,{formRef:this.formRef,userModalVisible:this.state.userModalVisible,handleAddUserSubmit:this.handleAddUserSubmit,handleAddUserCancel:this.handleAddUserCancel}),i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,size:"small"}))}}]),t}(r.Component),ja=wa,Ta=(a(1199),a(213)),La=function(e){return B("roles/deleteRole",e)},Ma=function(e){return B("roles/authLink",e)},Aa=function(e,t){return z("roles/list",{page:e,size:t})},_a=function(e,t){return z("roles/resources",{roleId:e,resourceType:t})},Ra=function(e,t){return z("permissions/list",{page:e,size:t})},Na=b.a.Content,za=E.a.confirm,Pa=Ee.a.TabPane,Va={overFlow:"hidden",textOverflow:"ellipsis",display:"-webkit-box"},Ba=function(e){function t(){return Object(o.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e={labelCol:{span:6},wrapperCol:{span:14}},t=this.props.roleActionType,a="\u65b0\u5efa\u89d2\u8272";return a="add"===t?"\u65b0\u5efa\u89d2\u8272":"\u7f16\u8f91\u89d2\u8272",i.a.createElement(r.Fragment,null,i.a.createElement(E.a,{title:a,visible:this.props.roleModalVisible,closable:!0,onOk:"add"===t?this.props.handleAddRole:this.props.handleEditRole,onCancel:this.props.handleCancelAddRole,centered:!0,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(S.a,{ref:this.props.formRef},i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u89d2\u8272\u540d\u79f0",name:"roleName",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0"}]}),i.a.createElement(O.a,{placeholder:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0"})),i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u89d2\u8272\u63cf\u8ff0",name:"description",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u89d2\u8272\u63cf\u8ff0"}]}),i.a.createElement(O.a,{placeholder:"\u8bf7\u8f93\u5165\u89d2\u8272\u63cf\u8ff0"})))))}}]),t}(r.Component),qa=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).filterOption=function(e,t){return t.username.indexOf(e)>-1},a.state={roleId:0,inGroupData:[],allGroupData:[],transferLodding:!1},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.roleId;this.loadRoleUsersData(e)}},{key:"loadRoleUsersData",value:function(e){var t=this;this.setState({roleId:e,transferLodding:!0}),function(e){return z("roles/users",{roleId:e})}(e).then(function(e){if(0===e.code){var a=[],n=[];e.data.all.forEach(function(e){n.push({key:String(e.ID),id:String(e.ID),username:e.username,position:e.position})}),e.data.in.forEach(function(e){a.push(String(e.ID))}),t.setState({inGroupData:a,allGroupData:n,transferLodding:!1})}else D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleTransferChange",value:function(e,t,a){this.setState({inGroupData:e})}},{key:"handleConfirmUserManager",value:function(){var e,t=this;this.setState({transferLodding:!0}),(e={roleId:parseInt(this.state.roleId),userIdList:this.state.inGroupData},P("roles/users",e)).then(function(e){0===e.code?(t.setState({transferLodding:!1}),t.props.hideModal(),D.b.success("\u64cd\u4f5c\u6210\u529f")):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"render",value:function(){return i.a.createElement(E.a,{title:"\u7ba1\u7406\u7528\u6237\u89d2\u8272 - "+this.props.currentRoleName,destroyOnClose:"true",visible:this.props.userManagerModalVisible,onOk:this.handleConfirmUserManager.bind(this),onCancel:this.props.handleCancelUserManager,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",centered:!0,width:680,style:{textAlign:"center"}},i.a.createElement(le.a,{spinning:this.state.transferLodding},i.a.createElement(Ta.a,{dataSource:this.state.allGroupData,showSearch:!0,locale:{itemUnit:"\u4eba",itemsUnit:"\u4eba",searchPlaceholder:"\u4f7f\u7528\u59d3\u540d\u641c\u7d22"},filterOption:this.filterOption,targetKeys:this.state.inGroupData,onChange:this.handleTransferChange.bind(this),render:function(e){return e.username+"-"+e.position},listStyle:{width:250,height:"60vh",textAlign:"left"},operations:["\u52a0\u5165\u89d2\u8272\u7ec4","\u79fb\u51fa\u89d2\u8272\u7ec4"]})))}}]),t}(r.Component),Ya=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).ecsFilterOption=function(e,t){return t.instance_name.indexOf(e)>-1||t.ip.indexOf(e)>-1},a.rdsFilterOption=function(e,t){return t.db_instance_description.indexOf(e)>-1||t.db_instance_id.indexOf(e)>-1},a.kvFilterOption=function(e,t){return t.instance_name.indexOf(e)>-1||t.connection_domain.indexOf(e)>-1},a.slbFilterOption=function(e,t){return t.load_balance_name.indexOf(e)>-1||t.address.indexOf(e)>-1},a.otherResFilterOption=function(e,t){return t.instance_name.indexOf(e)>-1||t.address.indexOf(e)>-1},a.handleTabClick=function(e){},a.handleConfirmRoleResourceManager=a.handleConfirmRoleResourceManager.bind(Object(g.a)(a)),a.state={roleId:0,tabSpinning:!1,ecsInGroupData:[],ecsAllGroupData:[],rdsInGroupData:[],rdsAllGroupData:[],kvInGroupData:[],kvAllGroupData:[],slbInGroupData:[],slbAllGroupData:[],otherAllGroupData:[],otherInGroupData:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.roleId;this.setState({roleId:e}),this.loadRoleEcsData(e),this.loadRoleRdsData(e),this.loadRoleKvData(e),this.loadRoleSlbData(e),this.loadRoleOtherResData(e)}},{key:"loadRoleEcsData",value:function(e){var t=this;this.setState({ecsTransferLodding:!0});var a=[],n=[];_a(e,"ecs").then(function(e){0===e.code?(e.data.all.forEach(function(e){a.push({key:String(e.ID),id:String(e.ID),instance_name:e.InstanceName,ip:e.InnerIpAddress+" "+e.PublicIpAddress})}),e.data.in.forEach(function(e){n.push(String(e.ID))}),t.setState({ecsAllGroupData:a,ecsInGroupData:n,ecsTransferLodding:!1})):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"loadRoleRdsData",value:function(e){var t=this;this.setState({rdsTransferLodding:!0});var a=[],n=[];_a(e,"rds").then(function(e){0===e.code?(e.data.all.forEach(function(e){a.push({key:String(e.ID),id:String(e.ID),db_instance_description:e.DBInstanceDescription,db_instance_id:e.DBInstanceId})}),e.data.in.forEach(function(e){n.push(String(e.ID))}),t.setState({rdsAllGroupData:a,rdsInGroupData:n,rdsTransferLodding:!1})):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"loadRoleKvData",value:function(e){var t=this;this.setState({kvTransferLodding:!0});var a=[],n=[];_a(e,"kv").then(function(e){0===e.code?(e.data.all.forEach(function(e){a.push({key:String(e.ID),id:String(e.ID),instance_name:e.InstanceName,connection_domain:e.ConnectionDomain})}),e.data.in.forEach(function(e){n.push(String(e.ID))}),t.setState({kvAllGroupData:a,kvInGroupData:n,kvTransferLodding:!1})):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"loadRoleSlbData",value:function(e){var t=this;this.setState({slbTransferLodding:!0});var a=[],n=[];_a(e,"slb").then(function(e){0===e.code?(e.data.all.forEach(function(e){a.push({key:String(e.ID),id:String(e.ID),load_balance_name:e.LoadBalancerName,address:e.Address})}),e.data.in.forEach(function(e){n.push(String(e.ID))}),t.setState({slbAllGroupData:a,slbInGroupData:n,slbTransferLodding:!1})):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"loadRoleOtherResData",value:function(e){var t=this;this.setState({otherResTransferLodding:!0});var a=[],n=[];_a(e,"other").then(function(e){0===e.code?(e.data.all.forEach(function(e){a.push({key:String(e.ID),id:String(e.ID),instance_name:e.InstanceName,res_type:e.ResType})}),e.data.in.forEach(function(e){n.push(String(e.ID))}),t.setState({otherAllGroupData:a,otherInGroupData:n,otherResTransferLodding:!1})):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleResTransferChange",value:function(e,t){switch(e){case"ecs":this.setState({ecsInGroupData:t});break;case"rds":this.setState({rdsInGroupData:t});break;case"kv":this.setState({kvInGroupData:t});break;case"slb":this.setState({slbInGroupData:t});break;case"other":this.setState({otherInGroupData:t})}}},{key:"handleConfirmRoleResourceManager",value:function(){var e,t=this;this.setState({tabSpinning:!0}),(e={roleId:parseInt(this.state.roleId),ecsIdList:this.state.ecsInGroupData,rdsIdList:this.state.rdsInGroupData,kvIdList:this.state.kvInGroupData,slbIdList:this.state.slbInGroupData,otherIdList:this.state.otherInGroupData},P("roles/resources",e)).then(function(e){0===e.code?(t.setState({tabSpinning:!1}),t.props.hideModal(),D.b.success("\u64cd\u4f5c\u6210\u529f")):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"render",value:function(){return i.a.createElement(E.a,{title:"\u7ba1\u7406\u89d2\u8272\u7ec4\u5173\u8054\u8d44\u6e90 - "+this.props.currentRoleName,destroyOnClose:"true",visible:this.props.resourceManagerModalVisible,onOk:this.handleConfirmRoleResourceManager,onCancel:this.props.handleCancelResourceManager,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",centered:!0,width:1e3,style:{textAlign:"center"}},i.a.createElement(le.a,{spinning:this.state.tabSpinning,tip:"\u8bf7\u6c42\u5904\u7406\u4e2d..."},i.a.createElement(Ee.a,{defaultActiveKey:"ecs",tabPosition:"left",onTabClick:this.handleTabClick.bind(this)},i.a.createElement(Pa,{tab:"\u4e91\u670d\u52a1\u5668",key:"ecs"},i.a.createElement(le.a,{spinning:this.state.ecsTransferLodding},i.a.createElement(Ta.a,{showSearch:!0,locale:{itemUnit:"\u53f0",itemsUnit:"\u53f0",searchPlaceholder:"\u4f7f\u7528ip\u6216\u673a\u5668\u540d\u79f0\u641c\u7d22"},filterOption:this.ecsFilterOption,dataSource:this.state.ecsAllGroupData,targetKeys:this.state.ecsInGroupData,onChange:this.handleResTransferChange.bind(this,"ecs"),render:function(e){return e.ip+" "+e.instance_name},listStyle:{width:350,height:"60vh",textAlign:"left"},operations:["\u52a0\u5165\u89d2\u8272\u7ec4","\u79fb\u51fa\u89d2\u8272\u7ec4"]}))),i.a.createElement(Pa,{tab:"\u4e91\u6570\u636e\u5e93",key:"rds"},i.a.createElement(le.a,{spinning:this.state.rdsTransferLodding},i.a.createElement(Ta.a,{showSearch:!0,locale:{itemUnit:"\u53f0",itemsUnit:"\u53f0",searchPlaceholder:"\u4f7f\u7528\u8fde\u63a5\u4e32\u6216\u540d\u79f0\u641c\u7d22"},filterOption:this.rdsFilterOption,dataSource:this.state.rdsAllGroupData,targetKeys:this.state.rdsInGroupData,onChange:this.handleResTransferChange.bind(this,"rds"),render:function(e){return e.db_instance_description+" "+e.db_instance_id},listStyle:{width:350,height:"60vh",textAlign:"left"},operations:["\u52a0\u5165\u89d2\u8272\u7ec4","\u79fb\u51fa\u89d2\u8272\u7ec4"]}))),i.a.createElement(Pa,{tab:"KVStore",key:"kv"},i.a.createElement(le.a,{spinning:this.state.kvTransferLodding},i.a.createElement(Ta.a,{showSearch:!0,locale:{itemUnit:"\u53f0",itemsUnit:"\u53f0",searchPlaceholder:"\u4f7f\u7528\u8fde\u63a5\u4e32\u6216\u540d\u79f0\u641c\u7d22"},filterOption:this.kvFilterOption,dataSource:this.state.kvAllGroupData,targetKeys:this.state.kvInGroupData,onChange:this.handleResTransferChange.bind(this,"kv"),render:function(e){return e.instance_name+" "+e.connection_domain},listStyle:{width:350,height:"60vh",textAlign:"left"},operations:["\u52a0\u5165\u89d2\u8272\u7ec4","\u79fb\u51fa\u89d2\u8272\u7ec4"]}))),i.a.createElement(Pa,{tab:"SLB",key:"slb"},i.a.createElement(le.a,{spinning:this.state.slbTransferLodding},i.a.createElement(Ta.a,{showSearch:!0,locale:{itemUnit:"\u4e2a",itemsUnit:"\u4e2a",searchPlaceholder:"\u4f7f\u7528ip\u6216\u540d\u79f0\u641c\u7d22"},filterOption:this.slbFilterOption,dataSource:this.state.slbAllGroupData,targetKeys:this.state.slbInGroupData,onChange:this.handleResTransferChange.bind(this,"slb"),render:function(e){return e.load_balance_name+" "+e.address},listStyle:{width:350,height:"60vh",textAlign:"left"},operations:["\u52a0\u5165\u89d2\u8272\u7ec4","\u79fb\u51fa\u89d2\u8272\u7ec4"]}))),i.a.createElement(Pa,{tab:"\u5176\u5b83\u8d44\u6e90",key:"other"},i.a.createElement(le.a,{spinning:this.state.otherResTransferLodding},i.a.createElement(Ta.a,{showSearch:!0,locale:{itemUnit:"\u4e2a",itemsUnit:"\u4e2a",searchPlaceholder:"\u4f7f\u7528\u5b9e\u4f8b\u540d\u79f0\u641c\u7d22"},filterOption:this.otherResFilterOption,dataSource:this.state.otherAllGroupData,targetKeys:this.state.otherInGroupData,onChange:this.handleResTransferChange.bind(this,"other"),render:function(e){return e.res_type+" "+e.instance_name},listStyle:{width:350,height:"60vh",textAlign:"left"},operations:["\u52a0\u5165\u89d2\u8272\u7ec4","\u79fb\u51fa\u89d2\u8272\u7ec4"]}))))))}}]),t}(r.Component),Fa=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).filterOption=function(e,t){return t.name.indexOf(e)>-1||t.url_path.indexOf(e)>-1},a.state={roleId:0,inGroupData:[],allGroupData:[],transferLodding:!1},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.roleId;this.loadRoleAuthLinksData(e)}},{key:"loadRoleAuthLinksData",value:function(e){var t=this;this.setState({roleId:e,transferLodding:!0}),function(e){return z("roles/authLink",{roleId:e})}(e).then(function(e){if(0===e.code){var a=[],n=[];e.data.all.forEach(function(e){n.push({key:String(e.Id),id:String(e.Id),name:e.name,url_path:e.urlPath})}),e.data.in.forEach(function(e){a.push(String(e.Id))}),t.setState({inGroupData:a,allGroupData:n,transferLodding:!1})}else D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleTransferChange",value:function(e,t,a){this.setState({inGroupData:e})}},{key:"handleConfirmUserManager",value:function(){var e,t=this;this.setState({transferLodding:!0}),(e={roleId:parseInt(this.state.roleId),authLinkIdList:this.state.inGroupData},P("roles/authLinks",e)).then(function(e){0===e.code?(t.setState({transferLodding:!1}),t.props.hideModal(),D.b.success("\u64cd\u4f5c\u6210\u529f")):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"render",value:function(){return i.a.createElement(E.a,{title:"\u7ba1\u7406\u89d2\u8272\u5bf9\u5e94\u6743\u9650 - "+this.props.currentRoleName,destroyOnClose:"true",visible:this.props.authLinkManagerModalVisible,onOk:this.handleConfirmUserManager.bind(this),onCancel:this.props.handleCancelAuthLinkManager,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",centered:!0,width:680,style:{textAlign:"center"}},i.a.createElement(le.a,{spinning:this.state.transferLodding},i.a.createElement(Ta.a,{dataSource:this.state.allGroupData,showSearch:!0,locale:{itemUnit:"\u6761",itemsUnit:"\u6761",searchPlaceholder:"\u4f7f\u7528\u540d\u79f0\u6216\u8def\u5f84\u641c\u7d22"},filterOption:this.filterOption,targetKeys:this.state.inGroupData,onChange:this.handleTransferChange.bind(this),render:function(e){return e.name+" "+e.url_path},listStyle:{width:250,height:"60vh",textAlign:"left"},operations:["\u52a0\u5165\u89d2\u8272\u7ec4","\u79fb\u51fa\u89d2\u8272\u7ec4"]})))}}]),t}(r.Component),Ua=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).managerUser=function(e){a.setState({roleId:e.Id,userManagerModalVisible:!0,currentRoleName:e.name})},a.confirmDeleteRole=function(e){var t=Object(g.a)(a);za({title:"\u5371\u9669\u64cd\u4f5c\u63d0\u793a",content:"\u5220\u9664\u8be5\u89d2\u8272\u7ec4\u65f6\u8be5\u89d2\u8272\u7ec4\u548c\u4e0e\u4e4b\u7ed1\u5b9a\u7684\u6240\u6709\u7528\u6237\u7684\u5173\u7cfb\u3001\u6240\u6709\u8d44\u6e90\u7684\u5173\u7cfb\u548c\u6743\u9650\u94fe\u63a5\u7684\u5173\u7cfb\u4e5f\u4f1a\u88ab\u5220\u9664\uff0c\u8bf7\u8c28\u614e\u64cd\u4f5c\uff01",okText:"\u786e\u8ba4\u5220\u9664",okType:"danger",cancelText:"\u53d6\u6d88",onOk:function(){La({id:e.Id}).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),t.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})},onCancel:function(){}})},a.changePage=function(e,t){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e,pageSize:t})},function(){a.refreshTableData()})},a.managerResource=function(e){a.setState(function(){return{roleId:e.Id,resourceManagerModalVisible:!0,currentRoleName:e.name}})},a.managerAuthLink=function(e){a.setState(function(){return{roleId:e.Id,authLinkManagerModalVisible:!0,currentRoleName:e.name}})},a.refreshTableData=function(){a.setState({tableLoading:!0}),Aa(a.state.pagination.page,a.state.pagination.pageSize).then(function(e){var t=a.state.pagination;t.total=parseInt(e.data.total),t.page=parseInt(e.data.page),t.showTotal(parseInt(e.data.total)),a.setState({pagination:t});for(var n=e.data.roles,r=[],i=0;i<n.length;i++)r.push({key:n[i].Id,Id:n[i].Id,name:n[i].name,description:n[i].description});a.setState({tableData:r,tableLoading:!1})}).catch(function(e){console.log(e)})},a.handleAddRole=a.handleAddRole.bind(Object(g.a)(a)),a.handleEditRole=a.handleEditRole.bind(Object(g.a)(a)),a.handleCancelAddRole=a.handleCancelAddRole.bind(Object(g.a)(a)),a.createRole=a.createRole.bind(Object(g.a)(a)),a.roleEdit=a.roleEdit.bind(Object(g.a)(a)),a.onShowSizeChange=a.onShowSizeChange.bind(Object(g.a)(a)),a.formRef=i.a.createRef(),a.state={columns:[{title:"ID",dataIndex:"Id",key:"Id",width:60},{title:"\u89d2\u8272\u540d",dataIndex:"name",key:"name",width:160},{title:"\u89d2\u8272\u63cf\u8ff0",dataIndex:"description",key:"description",className:{columnStyle:Va},width:160},{},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",width:430,align:"center",render:function(e,t){return i.a.createElement("div",null,i.a.createElement(me.a,{size:"small",onClick:a.managerUser.bind(Object(g.a)(a),t)},"\u7ba1\u7406\u7528\u6237"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{size:"small",onClick:a.managerAuthLink.bind(Object(g.a)(a),t)},"\u7ba1\u7406\u6743\u9650"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{size:"small",onClick:a.managerResource.bind(Object(g.a)(a),t)},"\u7ba1\u7406\u8d44\u6e90"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{type:"info",size:"small",onClick:a.roleEdit.bind(Object(g.a)(a),t)},"\u7f16\u8f91"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{type:"danger",size:"small",onClick:a.confirmDeleteRole.bind(Object(g.a)(a),t)},"\u5220\u9664"))}}],tableData:[],tableLoading:!1,roleModalVisible:!1,roleActionType:"add",editRoleId:0,userManagerModalVisible:!1,resourceManagerModalVisible:!1,authLinkManagerModalVisible:!1,current_data_id:null,pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:function(e,t){return a.onShowSizeChange(e,t)},showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e,t){return a.changePage(e,t)}}},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onShowSizeChange",value:function(e,t){var a=this,n=Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t});this.setState({pagination:n},function(){a.refreshTableData()})}},{key:"createRole",value:function(){this.setState(function(){return{roleActionType:"add",roleModalVisible:!0}})}},{key:"roleEdit",value:function(e){this.formRef.current.setFieldsValue({roleName:e.name,description:e.description}),this.setState(function(){return{roleActionType:"update",roleModalVisible:!0,editRoleId:e.Id}})}},{key:"handleAddRole",value:function(){var e=this;this.formRef.current.validateFields().then(function(t){var a;(a=t,P("roles/addRole",a)).then(function(t){0===t.code?(D.b.success("\u521b\u5efa\u6210\u529f"),e.setState({roleModalVisible:!1}),e.formRef.current.resetFields(),e.refreshTableData()):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})})}},{key:"handleEditRole",value:function(){var e=this;this.formRef.current.validateFields().then(function(t){var a;(a=Object(fe.a)({},t,{id:e.state.editRoleId}),V("roles/updateRole",a)).then(function(t){0===t.code?(D.b.success("\u4fee\u6539\u6210\u529f"),e.setState({roleModalVisible:!1}),e.formRef.current.resetFields(),e.refreshTableData()):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})})}},{key:"handleCancelAddRole",value:function(){this.setState(function(){return{roleModalVisible:!1,userManagerModalVisible:!1,resourceManagerModalVisible:!1,authLinkManagerModalVisible:!1}})}},{key:"componentDidMount",value:function(){this.refreshTableData()}},{key:"render",value:function(){var e=this;return i.a.createElement(Na,{style:{background:"#fff",padding:20,margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u6743\u9650\u7ba1\u7406","\u89d2\u8272\u7ba1\u7406","\u89d2\u8272\u5217\u8868"]}),i.a.createElement("div",{style:{padding:"0px 0px 10px 0px"}},i.a.createElement(oe.a,null,i.a.createElement(ce.a,null,i.a.createElement(me.a,{type:"primary",onClick:this.createRole},"\u65b0\u5efa\u89d2\u8272")))),i.a.createElement(Ba,{formRef:this.formRef,roleModalVisible:this.state.roleModalVisible,roleActionType:this.state.roleActionType,handleAddRole:this.handleAddRole,handleEditRole:this.handleEditRole,handleCancelAddRole:this.handleCancelAddRole}),this.state.userManagerModalVisible?i.a.createElement(qa,{roleId:this.state.roleId,userManagerModalVisible:this.state.userManagerModalVisible,currentRoleName:this.state.currentRoleName,hideModal:function(){e.setState({userManagerModalVisible:!1})},handleCancelUserManager:this.handleCancelAddRole.bind(this)}):"",this.state.resourceManagerModalVisible?i.a.createElement(Ya,{roleId:this.state.roleId,resourceManagerModalVisible:this.state.resourceManagerModalVisible,currentRoleName:this.state.currentRoleName,hideModal:function(){e.setState({resourceManagerModalVisible:!1})},handleCancelResourceManager:this.handleCancelAddRole.bind(this)}):"",this.state.authLinkManagerModalVisible?i.a.createElement(Fa,{roleId:this.state.roleId,authLinkManagerModalVisible:this.state.authLinkManagerModalVisible,currentRoleName:this.state.currentRoleName,hideModal:function(){e.setState({authLinkManagerModalVisible:!1})},handleCancelAuthLinkManager:this.handleCancelAddRole.bind(this)}):"",i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,rowClassName:"fixedHeight",size:"small"}))}}]),t}(r.Component),Ka=Ua,Ha=b.a.Content,Ja={overFlow:"hidden",textOverflow:"ellipsis",display:"-webkit-box"},Ga=function(e){function t(){return Object(o.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e={labelCol:{span:6},wrapperCol:{span:14}};return i.a.createElement(r.Fragment,null,i.a.createElement(E.a,{title:"\u65b0\u5efa\u6743\u9650\u94fe\u63a5",destroyOnClose:"true",visible:this.props.authLinkModalVisible,onOk:this.props.handleAddAuthLink,onCancel:this.props.handleCancelAddAuthLink,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(S.a,{ref:this.props.formRef},i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u6743\u9650\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8def\u5f84\u6743\u9650\u540d\u79f0"}]}),i.a.createElement(O.a,{placeholder:"\u8bf7\u8f93\u5165\u8def\u5f84\u6743\u9650\u540d\u79f0"})),i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u6743\u9650\u63cf\u8ff0",name:"description",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6743\u9650\u63cf\u8ff0"}]}),i.a.createElement(O.a,{placeholder:"\u8bf7\u8f93\u5165\u6743\u9650\u63cf\u8ff0"})),i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u6743\u9650URI\u8def\u5f84",name:"path",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6743\u9650URI\u8def\u5f84"}]}),i.a.createElement(O.a,{placeholder:"\u8bf7\u8f93\u5165\u6743\u9650URI\u8def\u5f84"})))))}}]),t}(r.Component),Qa=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).confirmDeleteAuthLink=function(e){Ma({id:e.Id}).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),a.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})},a.changePage=function(e,t){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e,pageSize:t})},function(){a.refreshTableData()})},a.refreshTableData=function(){a.setState({tableLoading:!0}),Ra(a.state.pagination.page,a.state.pagination.pageSize).then(function(e){var t=a.state.pagination;t.total=parseInt(e.data.total),t.page=parseInt(e.data.page),t.showTotal(parseInt(e.data.total)),a.setState({pagination:t});for(var n=e.data.permissions,r=[],i=0;i<n.length;i++)r.push({Id:n[i].Id,name:n[i].name,description:n[i].description,urlPath:n[i].urlPath});a.setState({tableData:r,tableLoading:!1})}).catch(function(e){console.log(e)})},a.refreshTableData=a.refreshTableData.bind(Object(g.a)(a)),a.createAuthLink=a.createAuthLink.bind(Object(g.a)(a)),a.handleAddAuthLink=a.handleAddAuthLink.bind(Object(g.a)(a)),a.handleCancelAddAuthLink=a.handleCancelAddAuthLink.bind(Object(g.a)(a)),a.onShowSizeChange=a.onShowSizeChange.bind(Object(g.a)(a)),a.formRef=i.a.createRef(),a.state={columns:[{title:"ID",dataIndex:"Id",key:"Id",width:60},{title:"\u6743\u9650\u540d\u79f0",dataIndex:"name",key:"name",width:200},{title:"\u6743\u9650\u63cf\u8ff0",dataIndex:"description",key:"description",className:{columnStyle:Ja},width:260},{title:"\u6743\u9650\u8def\u5f84",dataIndex:"urlPath",key:"urlPath",className:{columnStyle:Ja},width:360},{},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",width:60,align:"center",render:function(e,t){return i.a.createElement("div",null,i.a.createElement(de.a,{title:"\u786e\u5b9a\u5220\u9664\u8be5\u9879\u5185\u5bb9\u5417?",onConfirm:a.confirmDeleteAuthLink.bind(Object(g.a)(a),t),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(me.a,{type:"danger",size:"small"},"\u5220\u9664")))}}],tableData:[],tableLoading:!1,authLinkModalVisible:!1,current_data_id:null,pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:function(e,t){return a.onShowSizeChange(e,t)},showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e,t){return a.changePage(e,t)}}},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onShowSizeChange",value:function(e,t){var a=this,n=Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t});this.setState({pagination:n},function(){a.refreshTableData()})}},{key:"componentDidMount",value:function(){this.refreshTableData()}},{key:"createAuthLink",value:function(){this.setState({authLinkModalVisible:!0})}},{key:"handleCancelAddAuthLink",value:function(){this.setState({authLinkModalVisible:!1})}},{key:"handleAddAuthLink",value:function(){var e=this;this.formRef.current.validateFields().then(function(t){var a;(a=t,P("roles/authLink",a)).then(function(t){0===t.code?(D.b.success("\u521b\u5efa\u6210\u529f"),e.setState({authLinkModalVisible:!1}),e.refreshTableData()):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})})}},{key:"render",value:function(){return i.a.createElement(Ha,{style:{background:"#fff",padding:20,margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u6743\u9650\u7ba1\u7406","\u94fe\u63a5\u6743\u9650","\u6743\u9650\u94fe\u63a5\u5217\u8868"]}),i.a.createElement("div",{style:{padding:"0px 0px 10px 0px"}},i.a.createElement(oe.a,null,i.a.createElement(ce.a,null,i.a.createElement(me.a,{type:"primary",onClick:this.createAuthLink},"\u65b0\u5efa\u6743\u9650\u94fe\u63a5")))),i.a.createElement(Ga,{formRef:this.formRef,authLinkModalVisible:this.state.authLinkModalVisible,handleAddAuthLink:this.handleAddAuthLink,handleCancelAddAuthLink:this.handleCancelAddAuthLink}),i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,size:"small"}))}}]),t}(r.Component),Wa=Qa,Za=b.a.Content,$a=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).compareToFirstPassword=function(e,t,n){var r=a.props.form;t&&t!==r.getFieldValue("password")?n("\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4!"):n()},a.updatePassword=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var a={password:t.password,confirm_password:t.confirm_password};Y(a).then(function(e){0===e.code&&D.b.success("\u5bc6\u7801\u4fee\u6539\u6210\u529f!")}).catch(function(e){console.log(e)})}})},a.setState({}),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t={labelCol:{span:2},wrapperCol:{span:6}};return i.a.createElement(Za,{style:{background:"#fff",padding:20,margin:0,height:"100%"}},i.a.createElement(S.a,{onSubmit:this.updatePassword},i.a.createElement(S.a.Item,Object.assign({label:"\u65b0\u5bc6\u7801",hasFeedback:!0},t),e("password",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u65b0\u5bc6\u7801"}]})(i.a.createElement(O.a,null))),i.a.createElement(S.a.Item,Object.assign({label:"\u786e\u8ba4\u5bc6\u7801",hasFeedback:!0},t),e("confirm_password",{rules:[{required:!0,message:"\u8bf7\u786e\u8ba4\u65b0\u5bc6\u7801"},{validator:this.compareToFirstPassword}]})(i.a.createElement(O.a,null))),i.a.createElement(S.a.Item,Object.assign({},t,{style:{textAlign:"center"}}),i.a.createElement(me.a,{type:"primary",htmlType:"submit"},"\u786e \u8ba4"))))}}]),t}(r.Component),Xa=$a,en=(a(1235),a(349)),tn=a(116),an=b.a.Content,nn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).syncAliyunEcs=a.syncAliyunEcs.bind(Object(g.a)(a)),a.syncAliyunRds=a.syncAliyunRds.bind(Object(g.a)(a)),a.syncAliyunKv=a.syncAliyunKv.bind(Object(g.a)(a)),a.syncAliyunSlb=a.syncAliyunSlb.bind(Object(g.a)(a)),a.state={syncEcsLoading:!1,syncRdsLoading:!1,syncKvLoading:!1,syncSlbLoading:!1},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.syncAliyunStatisData()}},{key:"syncAliyunStatisData",value:function(){var e=this;z("/data/syncAliyunStatisData").then(function(t){0===t.code?e.setState({ecsCount:t.data.ecsCount,rdsCount:t.data.rdsCount,kvCount:t.data.kvCount,slbCount:t.data.slbCount}):D.b.error("\u83b7\u53d6\u9489\u9489\u7edf\u8ba1\u6570\u636e\u5f02\u5e38")}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"syncAliyunEcs",value:function(){var e,t=this;this.setState(Object(tn.a)({},"syncEcsLoading",!0)),z("/data/syncAliyunEcs",e,9e4).then(function(e){0===e.code?(D.b.success("\u540c\u6b65\u6570\u636e\u6210\u529f"),t.setState(Object(tn.a)({},"syncEcsLoading",!1)),t.syncAliyunStatisData()):(D.b.error(e.msg),t.setState(Object(tn.a)({},"syncEcsLoading",!1)))}).catch(function(e){D.b.error(e.toLocaleString()),t.setState(Object(tn.a)({},"syncEcsLoading",!1))})}},{key:"syncAliyunRds",value:function(){var e,t=this;this.setState(Object(tn.a)({},"syncRdsLoading",!0)),z("/data/syncAliyunRds",e,9e4).then(function(e){0===e.code?(D.b.success("\u540c\u6b65\u6570\u636e\u6210\u529f"),t.setState(Object(tn.a)({},"syncRdsLoading",!1)),t.syncAliyunStatisData()):(D.b.error(e.msg),t.setState(Object(tn.a)({},"syncRdsLoading",!1)))}).catch(function(e){D.b.error(e.toLocaleString()),t.setState(Object(tn.a)({},"syncRdsLoading",!1))})}},{key:"syncAliyunKv",value:function(){var e=this;this.setState(Object(tn.a)({},"syncKvLoading",!0)),z("/data/syncAliyunKv",{},9e4).then(function(t){0===t.code?(D.b.success("\u540c\u6b65\u6570\u636e\u6210\u529f"),e.setState(Object(tn.a)({},"syncKvLoading",!1)),e.syncAliyunStatisData()):(D.b.error(t.msg),e.setState(Object(tn.a)({},"syncKvLoading",!1)))}).catch(function(t){D.b.error(t.toLocaleString()),e.setState(Object(tn.a)({},"syncKvLoading",!1))})}},{key:"syncAliyunSlb",value:function(){var e=this;this.setState(Object(tn.a)({},"syncSlbLoading",!0)),z("/data/syncAliyunSlb",{},9e4).then(function(t){0===t.code?(D.b.success("\u540c\u6b65\u6570\u636e\u6210\u529f"),e.setState(Object(tn.a)({},"syncSlbLoading",!1)),e.syncAliyunStatisData()):(D.b.error(t.msg),e.setState(Object(tn.a)({},"syncSlbLoading",!1)))}).catch(function(t){D.b.error(t.toLocaleString()),e.setState(Object(tn.a)({},"syncSlbLoading",!1))})}},{key:"render",value:function(){return i.a.createElement(an,{style:{background:"#fff",padding:20,margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u6570\u636e\u7ba1\u7406","\u963f\u91cc\u4e91\u6570\u636e"]}),i.a.createElement("div",{style:{marginBottom:20}},i.a.createElement(Ft.a,{size:"small",title:"\u5e73\u53f0\u6570\u636e\u603b\u89c8"},i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:5},i.a.createElement(en.a,{title:"ECS\u603b\u6570",value:this.state.ecsCount,precision:0}),i.a.createElement(me.a,{style:{marginTop:16},type:"primary",loading:this.state.syncEcsLoading,onClick:this.syncAliyunEcs},"\u540c\u6b65\u5e73\u53f0\u6570\u636e")),i.a.createElement(ce.a,{span:5},i.a.createElement(en.a,{title:"RDS\u603b\u6570",value:this.state.rdsCount,precision:0}),i.a.createElement(me.a,{style:{marginTop:16},type:"primary",loading:this.state.syncRdsLoading,onClick:this.syncAliyunRds},"\u540c\u6b65\u5e73\u53f0\u6570\u636e")),i.a.createElement(ce.a,{span:5},i.a.createElement(en.a,{title:"Redis\u603b\u6570",value:this.state.kvCount,precision:0}),i.a.createElement(me.a,{style:{marginTop:16},type:"primary",loading:this.state.syncKvLoading,onClick:this.syncAliyunKv},"\u540c\u6b65\u5e73\u53f0\u6570\u636e")),i.a.createElement(ce.a,{span:5},i.a.createElement(en.a,{title:"SLB\u603b\u6570",value:this.state.slbCount,precision:0}),i.a.createElement(me.a,{style:{marginTop:16},type:"primary",loading:this.state.syncSlbLoading,onClick:this.syncAliyunSlb},"\u540c\u6b65\u5e73\u53f0\u6570\u636e"))))))}}]),t}(r.Component),rn=ye.a.Option,ln=Z.a.Text,sn=Z.a.Paragraph,on=b.a.Content,cn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).switchChange=a.switchChange.bind(Object(g.a)(a)),a.state={sitesData:[],renewSwitch:!0,cloudAccountList:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.loadCloudAccountData()}},{key:"loadCloudAccountData",value:function(){var e=this;Le(1,100).then(function(t){0===t.code?e.setState({cloudAccountList:t.data.accounts}):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"switchChange",value:function(e){this.setState({renewSwitch:e})}},{key:"render",value:function(){var e,t={labelCol:{span:6},wrapperCol:{span:17}};e=this.state.cloudAccountList.map(function(e){return i.a.createElement(rn,{key:e.id,value:e.id},e.accountName)});var a="\u65b0\u589e";return"update"===this.props.actionType&&(a="\u7f16\u8f91"),i.a.createElement(E.a,{title:a+" - \u8d44\u6e90\u4fe1\u606f",destroyOnClose:!0,visible:this.props.server_info_modal_visible,onOk:this.props.handlePostServerInfoSubmit,onCancel:this.props.handlePostServerInfoCancel,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",centered:!0,width:1e3},i.a.createElement(S.a,{ref:this.props.formRef},i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:11,offset:1},i.a.createElement(S.a.Item,Object.assign({label:"\u8d44\u6e90\u7c7b\u578b"},t,{name:"resType",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u8d44\u6e90\u7c7b\u578b"}]}),i.a.createElement(ye.a,null,i.a.createElement(rn,{value:"MongoDB"},"MongoDB"),i.a.createElement(rn,{value:"MaxCompute"},"MaxCompute"),i.a.createElement(rn,{value:"SSL"},"SSL"),i.a.createElement(rn,{value:"\u5e26\u5bbd"},"\u5e26\u5bbd"),i.a.createElement(rn,{value:"\u540e\u4ed8\u8d39"},"\u540e\u4ed8\u8d39"),i.a.createElement(rn,{value:"\u5f39\u6027IP"},"\u5f39\u6027IP"),i.a.createElement(rn,{value:"Memcached"},"Memcached"),i.a.createElement(rn,{value:"Kafka"},"Kafka"),i.a.createElement(rn,{value:"NAS"},"NAS"),i.a.createElement(rn,{value:"PolarDB"},"PolarDB"),i.a.createElement(rn,{value:"HBase"},"HBase")))),i.a.createElement(ce.a,{span:11},i.a.createElement(S.a.Item,Object.assign({label:"\u5b9e\u4f8bID"},t,{name:"instanceId"}),i.a.createElement(O.a,null)))),i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:11,offset:1},i.a.createElement(S.a.Item,Object.assign({label:"\u5b9e\u4f8b\u540d\u79f0"},t,{name:"instanceName",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5b9e\u4f8b\u540d\u79f0"}]}),i.a.createElement(O.a,null))),i.a.createElement(ce.a,{span:11},i.a.createElement(S.a.Item,Object.assign({label:"\u8fde\u63a5\u5730\u5740"},t,{name:"connections"}),i.a.createElement(O.a,null)))),i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:11,offset:1},i.a.createElement(S.a.Item,Object.assign({label:"\u533a\u57df"},t,{name:"region"}),i.a.createElement(O.a,null))),i.a.createElement(ce.a,{span:11},i.a.createElement(S.a.Item,Object.assign({label:"Engine"},t,{name:"engine"}),i.a.createElement(O.a,null)))),i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:11,offset:1},i.a.createElement(S.a.Item,Object.assign({label:"CPU"},t,{name:"cpu"}),i.a.createElement(O.a,null))),i.a.createElement(ce.a,{span:11},i.a.createElement(S.a.Item,Object.assign({label:"\u78c1\u76d8"},t,{name:"disk"}),i.a.createElement(O.a,null)))),i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:11,offset:1},i.a.createElement(S.a.Item,Object.assign({label:"\u5185\u5b58"},t,{name:"memory"}),i.a.createElement(O.a,null))),i.a.createElement(ce.a,{span:11},i.a.createElement(S.a.Item,Object.assign({label:"\u5e26\u5bbd"},t,{name:"bandwidth"}),i.a.createElement(O.a,null)))),i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:11,offset:1},i.a.createElement(S.a.Item,Object.assign({label:"\u521b\u5efa\u65f6\u95f4"},t,{name:"createTime",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u521b\u5efa\u65f6\u95f4"}]}),i.a.createElement(be.a,{format:"YYYY-MM-DD",style:{width:"100%"}}))),i.a.createElement(ce.a,{span:11},i.a.createElement(S.a.Item,Object.assign({label:"\u8fc7\u671f\u65f6\u95f4"},t,{name:"expiredTime",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8fc7\u671f\u65f6\u95f4"}]}),i.a.createElement(be.a,{format:"YYYY-MM-DD",style:{width:"100%"}})))),i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:11,offset:1},i.a.createElement(S.a.Item,Object.assign({label:"\u4e91\u8d26\u53f7"},t,{name:"cloudAccountId"}),i.a.createElement(ye.a,null,e))))))}}]),t}(r.Component),dn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).changePage=function(e,t){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e,pageSize:t})},function(){a.refreshTableData()})},a.refreshTableData=function(){a.setState({tableLoading:!0});var e={page:a.state.pagination.page,size:a.state.pagination.pageSize,queryKeyword:a.state.queryKeyword,queryResType:a.state.queryResType,queryExpiredTime:null===a.state.queryExpiredTime?null:a.state.queryExpiredTime.format("YYYY-MM-DD HH:mm:ss"),queryCloudAccount:a.state.queryCloudAccount};Ke(e).then(function(e){var t=a.state.pagination;t.total=parseInt(e.data.total),t.page=parseInt(e.data.page),t.showTotal(parseInt(e.data.total)),a.setState({pagination:Object(fe.a)({},t)});for(var n=e.data.otherRes,r=[],i=0;i<n.length;i++)r.push({key:n[i].ID,ID:n[i].ID,CloudAccountId:n[i].CloudAccountId,CloudAccountName:n[i].CloudAccountName,ResType:n[i].ResType,InstanceId:n[i].InstanceId,InstanceName:n[i].InstanceName,Connections:n[i].Connections,Region:n[i].Region,Engine:n[i].Engine,Cpu:n[i].Cpu,Bandwidth:n[i].Bandwidth,RenewStatus:n[i].RenewStatus,RenewSiteId:n[i].RenewSiteId,BankAccount:n[i].BankAccount,CreateTime:we()(n[i].CreateTime).format("YYYY-MM-DD"),ExpiredTime:we()(n[i].ExpiredTime).format("YYYY-MM-DD")});a.setState({tableData:r,tableLoading:!1})}).catch(function(e){D.b.error(e)})},a.onExpiredDateChange=function(e){null==e?a.setState({queryExpiredTime:null}):a.setState({queryExpiredTime:e})},a.handleManageUserChange=function(e){a.setState({queryManageUser:e})},a.handleBatchUpdate=function(){var e=a.state.selectedRowKeys;0!==e.length?a.setState({extraInfoModalVisible:!0,updateMode:"batch",idsList:e}):D.b.warn("\u8bf7\u5148\u9009\u62e9\u6570\u636e")},a.onSelectChange=function(e){a.setState({selectedRowKeys:e})},a.keywordOnChange=a.keywordOnChange.bind(Object(g.a)(a)),a.handleQuery=a.handleQuery.bind(Object(g.a)(a)),a.handlePostOtherInfoSubmit=a.handlePostOtherInfoSubmit.bind(Object(g.a)(a)),a.handlePostOtherInfoCancel=a.handlePostOtherInfoCancel.bind(Object(g.a)(a)),a.changePage=a.changePage.bind(Object(g.a)(a)),a.handleAdd=a.handleAdd.bind(Object(g.a)(a)),a.handleResTypeChange=a.handleResTypeChange.bind(Object(g.a)(a)),a.handleCloudAccountChange=a.handleCloudAccountChange.bind(Object(g.a)(a)),a.formRef=i.a.createRef(),a.state={columns:[{title:"Id",dataIndex:"ID",key:"ID",className:"small_font",render:function(e){return i.a.createElement(ln,{ellipsis:!0},e)}},{title:"\u8d44\u6e90\u7c7b\u578b",dataIndex:"ResType",key:"ResType",className:"small_font",render:function(e){return i.a.createElement(ln,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8b\u540d\u79f0",dataIndex:"InstanceName",key:"InstanceName",className:"small_font",render:function(e){return i.a.createElement(pe.a,{title:e},i.a.createElement(ln,{ellipsis:!0},e))}},{title:"\u4e91\u8d26\u53f7",dataIndex:"CloudAccountName",key:"CloudAccountName",className:"small_font",render:function(e){return i.a.createElement(ln,{ellipsis:!0},e)}},{title:"\u5b9e\u4f8bid",dataIndex:"InstanceId",key:"InstanceId",className:"small_font",render:function(e){return i.a.createElement(ln,{ellipsis:!0},e)}},{title:"\u8bbf\u95ee\u5730\u5740",dataIndex:"Connections",key:"Connections",className:"small_font",render:function(e){return i.a.createElement(sn,{style:{marginBottom:0},copyable:""!==e},e)}},{title:"Region",dataIndex:"Region",key:"Region",className:"small_font",render:function(e){return i.a.createElement(ln,null,e)}},{title:"Engine",dataIndex:"Engine",key:"Engine",className:"small_font",render:function(e){return i.a.createElement(ln,null,e)}},{title:"Cpu",dataIndex:"Cpu",key:"Cpu",className:"small_font",render:function(e){return i.a.createElement(ln,null,e)}},{title:"\u5e26\u5bbd",dataIndex:"Bandwidth",key:"Bandwidth",className:"small_font",render:function(e){return i.a.createElement(ln,{ellipsis:!0},e)}},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"CreateTime",key:"CreateTime",className:"small_font",render:function(e){return i.a.createElement(ln,{ellipsis:!0},e)}},{title:"\u8fc7\u671f\u65f6\u95f4",dataIndex:"ExpiredTime",key:"ExpiredTime",className:"small_font",render:function(e){return i.a.createElement(ln,{ellipsis:!0},e)}},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",align:"center",className:"small_font",render:function(e,t){return i.a.createElement("div",null,i.a.createElement(me.a,{type:"info",size:"small",onClick:a.serverEdit.bind(Object(g.a)(a),t)},"\u7f16\u8f91"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(de.a,{title:"\u786e\u5b9a\u5220\u9664\u8be5\u9879\u5185\u5bb9?",onConfirm:a.serverDelete.bind(Object(g.a)(a),t),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(me.a,{type:"danger",size:"small"},"\u5220\u9664")))}}],tableLoading:!1,tableData:[],pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:function(e,t){return a.onShowSizeChange(e,t)},showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e,t){return a.changePage(e,t)}},actionType:"add",editId:0,extraInfoModalVisible:!1,other_info_modal_visible:!1,queryExpiredTime:null,queryKeyword:"",queryCloudAccount:"0",queryManageUser:"0",cloudAccountList:[],queryResType:"\u6240\u6709",selectedRowKeys:[],idsList:[],updateMode:"single"},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.refreshTableData(),this.loadCloudAccountsData()}},{key:"loadCloudAccountsData",value:function(){var e=this;Le(1,100).then(function(t){0===t.code?e.setState({cloudAccountList:t.data.accounts}):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"onShowSizeChange",value:function(e,t){var a=this,n=Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t});this.setState({pagination:n},function(){a.refreshTableData()})}},{key:"handleAdd",value:function(){this.setState({other_info_modal_visible:!0,actionType:"add",editId:0})}},{key:"handleQuery",value:function(){var e=this;this.setState({pagination:Object(fe.a)({},this.state.pagination,{page:1,current:1})},function(){e.refreshTableData()})}},{key:"keywordOnChange",value:function(e){this.setState({queryKeyword:e.target.value})}},{key:"handleResTypeChange",value:function(e){this.setState({queryResType:e})}},{key:"handleCloudAccountChange",value:function(e){this.setState({queryCloudAccount:e})}},{key:"serverEdit",value:function(e){var t=this;this.setState({other_info_modal_visible:!0,editId:e.ID,actionType:"update",updateMode:"single"},function(){setTimeout(function(){t.formRef.current.setFieldsValue({cloudAccountId:0!==e.CloudAccountId?e.CloudAccountId:null,resType:e.ResType,instanceId:e.InstanceId,instanceName:e.InstanceName,connections:e.Connections,region:e.Region,engine:e.Engine,cpu:e.Cpu,bandwidth:e.Bandwidth,createTime:""!==e.CreateTime?we()(e.CreateTime,"YYYY-MM-DD"):void 0,expiredTime:""!==e.ExpiredTime?we()(e.ExpiredTime,"YYYY-MM-DD"):void 0})},500)})}},{key:"serverDelete",value:function(e){var t,a=this;(t=e.ID,B("cloud/other",{id:t})).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),a.refreshTableData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handlePostOtherInfoSubmit",value:function(){var e=this;this.formRef.current.validateFields().then(function(t){var a;(a=Object(fe.a)({},t,{id:e.state.editId,createTime:t.createTime.format("YYYY-MM-DD"),expiredTime:void 0===t.expiredTime?void 0:t.expiredTime.format("YYYY-MM-DD")}),P("cloud/other",a)).then(function(t){0===t.code?("add"===e.state.actionType?D.b.success("\u6dfb\u52a0\u6210\u529f\uff0c\u8bf7\u5230\u6743\u9650\u7ba1\u7406\u4e2d\u589e\u52a0\u8bbf\u95ee\u6743\u9650\uff01"):D.b.success("\u7f16\u8f91\u6210\u529f"),e.setState({other_info_modal_visible:!1}),e.refreshTableData()):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})})}},{key:"handlePostOtherInfoCancel",value:function(){this.setState({other_info_modal_visible:!1})}},{key:"handleExtraInfoOk",value:function(e){var t=this,a="";a="single"===this.state.updateMode?String(this.state.editId):this.state.idsList.join(","),function(e){return V("cloud/other",e)}(Object(fe.a)({},e,{id:a})).then(function(e){0===e.code?(D.b.success("\u4fee\u6539\u6210\u529f"),t.setState({extraInfoModalVisible:!1,selectedRowKeys:[]})):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleExtraInfoCancel",value:function(e){this.setState({extraInfoModalVisible:!1})}},{key:"render",value:function(){var e=this;return i.a.createElement(on,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u4e91\u8d44\u6e90","\u5176\u5b83\u8d44\u6e90","\u5176\u5b83\u8d44\u6e90\u6c47\u603b\u5217\u8868"]}),i.a.createElement(oe.a,{style:{padding:"0px 0px 10px 0px"}},i.a.createElement(ce.a,{span:4,className:"col-span"},i.a.createElement(be.a,{style:{width:"100%"},defaultValue:this.state.queryExpiredTime,placeholder:"\u5230\u671f\u622a\u6b62\u65f6\u95f4",onChange:this.onExpiredDateChange})),i.a.createElement(ce.a,{span:4,className:"col-span"},i.a.createElement(O.a,{placeholder:"\u8f93\u5165\u5b9e\u4f8bid/\u540d\u79f0/\u5730\u5740\u67e5\u8be2",value:this.state.queryKeyword,onChange:this.keywordOnChange})),i.a.createElement(ce.a,{span:3,className:"col-span"},i.a.createElement(ye.a,{defaultValue:this.state.queryResType,style:{width:"100%"},onChange:this.handleResTypeChange},i.a.createElement(rn,{value:"\u6240\u6709"},"\u6240\u6709"),i.a.createElement(rn,{value:"MongoDB"},"MongoDB"),i.a.createElement(rn,{value:"MaxCompute"},"MaxCompute"),i.a.createElement(rn,{value:"SSL"},"SSL"),i.a.createElement(rn,{value:"\u5e26\u5bbd"},"\u5e26\u5bbd"),i.a.createElement(rn,{value:"\u540e\u4ed8\u8d39"},"\u540e\u4ed8\u8d39"),i.a.createElement(rn,{value:"\u5f39\u6027IP"},"\u5f39\u6027IP"),i.a.createElement(rn,{value:"Memcached"},"Memcached"),i.a.createElement(rn,{value:"Kafka"},"Kafka"),i.a.createElement(rn,{value:"NAS"},"NAS"),i.a.createElement(rn,{value:"PolarDB"},"PolarDB"),i.a.createElement(rn,{value:"HBase"},"HBase"))),i.a.createElement(ce.a,{span:2,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},type:"primary",icon:i.a.createElement(ke.a,null),onClick:this.handleQuery},"\u67e5 \u8be2")),i.a.createElement(ce.a,{span:2,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},icon:i.a.createElement(Ie.a,null),onClick:this.handleAdd},"\u65b0 \u589e"))),i.a.createElement(Qe,{wrappedComponentRef:function(t){return e.extraInfoFormRef=t},visible:this.state.extraInfoModalVisible,handleOk:this.handleExtraInfoOk,handleCancel:this.handleExtraInfoCancel}),i.a.createElement(cn,{formRef:this.formRef,server_info_modal_visible:this.state.other_info_modal_visible,actionType:this.state.actionType,handlePostServerInfoSubmit:this.handlePostOtherInfoSubmit,handlePostServerInfoCancel:this.handlePostOtherInfoCancel}),i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,bordered:!0,size:"small"}))}}]),t}(r.Component),un=(a(1206),a(661)),mn=function(e){return V("settings/value",e)},hn=b.a.Content,pn=be.a.RangePicker,fn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).onChangeAllowRenewConfirm=a.onChangeAllowRenewConfirm.bind(Object(g.a)(a)),a.dateOnChange=a.dateOnChange.bind(Object(g.a)(a)),a.handleSetExpireDateSubmit=a.handleSetExpireDateSubmit.bind(Object(g.a)(a)),a.handleSetExpireDateCancel=a.handleSetExpireDateCancel.bind(Object(g.a)(a)),a.state={expireSettingModalVisible:!1,isOpenRenewConfirm:!1,expireStartDate:null,expireEndDate:null},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){this.loadAllowRenewConfirmStatus()}},{key:"loadAllowRenewConfirmStatus",value:function(){var e,t=this;(e={key_name:"open_renew_confirm"},z("settings/value",e)).then(function(e){0===e.code?t.setState({isOpenRenewConfirm:"true"===e.data.value}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"onChangeAllowRenewConfirm",value:function(e){this.setState({isOpenRenewConfirm:e}),!0===e?this.setState({expireSettingModalVisible:!0}):mn({key_name:"open_renew_confirm",value:e.toLocaleString()}).then(function(e){0===e.code?D.b.success("\u8bbe\u7f6e\u6210\u529f"):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"dateOnChange",value:function(e,t){this.setState({expireStartDate:t[0],expireEndDate:t[1]})}},{key:"handleSetExpireDateSubmit",value:function(){var e=this;mn({key_name:"open_renew_confirm",value:this.state.isOpenRenewConfirm.toLocaleString()}).then(function(e){0===e.code?D.b.success("\u8bbe\u7f6e\u6210\u529f"):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())}),mn({key_name:"expire_start_date",value:this.state.expireStartDate}).then(function(e){0!==e.code&&D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())}),mn({key_name:"expire_end_date",value:this.state.expireEndDate}).then(function(t){0!==t.code?D.b.error(t.msg):e.setState({expireSettingModalVisible:!1})}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleSetExpireDateCancel",value:function(){this.setState({expireSettingModalVisible:!1})}},{key:"render",value:function(){return i.a.createElement(hn,{style:{background:"#fff",padding:20,margin:0,height:"100%"}},i.a.createElement(E.a,{title:"\u8bbe\u7f6e\u8fc7\u671f\u786e\u8ba4\u65f6\u95f4\u533a\u95f4",destroyOnClose:!0,visible:this.state.expireSettingModalVisible,onOk:this.handleSetExpireDateSubmit,onCancel:this.handleSetExpireDateCancel,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",width:700},i.a.createElement(Yt.a,{message:"\u8d1f\u8d23\u4eba\u53ea\u53ef\u786e\u8ba4\u8be5\u65f6\u95f4\u6bb5\u5185\u8fc7\u671f\u7684\u8d44\u6e90",banner:!0}),i.a.createElement(oe.a,{style:{marginTop:30,marginBottom:30}},i.a.createElement(ce.a,{span:4}),i.a.createElement(ce.a,{span:3,style:{textAlign:"right"}},i.a.createElement("label",{style:{fontSize:14,lineHeight:"32px",marginRight:10,fontWeight:500}},"\u8fc7\u671f\u65f6\u95f4: ")),i.a.createElement(ce.a,{span:13},i.a.createElement(pn,{style:{width:"100%"},onChange:this.dateOnChange,format:"YYYY-MM-DD"})),i.a.createElement(ce.a,{span:4}))),i.a.createElement(Ft.a,{style:{width:200,textAlign:"center"}},i.a.createElement(un.a,{checked:this.state.isOpenRenewConfirm,onChange:this.onChangeAllowRenewConfirm}),i.a.createElement("p",{style:{paddingTop:20,fontWeight:500}},"\u662f\u5426\u5f00\u542f\u7eed\u8d39\u786e\u8ba4\u7a97\u53e3")))}}]),t}(r.Component),bn=function(e){function t(){return Object(o.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){localStorage.removeItem("ops_token"),localStorage.removeItem("token_info"),window.location.href="/login"}},{key:"render",value:function(){return i.a.createElement("div",null,"\u6ce8\u9500\u4e2d...")}}]),t}(r.Component),gn=function(e,t){return z("user/feedback",{page:e,size:t})},yn=b.a.Content,En={overFlow:"hidden",textOverflow:"ellipsis",display:"-webkit-box"},vn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).changePage=function(e){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e})},function(){a.refreshTableData()})},a.refreshTableData=function(){a.setState({tableLoading:!0}),gn(a.state.pagination.page,a.state.pagination.pageSize).then(function(e){var t=a.state.pagination;t.total=parseInt(e.data.total),t.page=parseInt(e.data.page),t.showTotal(parseInt(e.data.total)),a.setState({pagination:t});for(var n=e.data.feedbacks,r=[],i=0;i<n.length;i++)r.push({id:n[i].id,createTime:n[i].createTime,username:n[i].username,content:n[i].content,score:n[i].score});a.setState({tableData:r,tableLoading:!1})}).catch(function(e){console.log(e)})},a.refreshTableData=a.refreshTableData.bind(Object(g.a)(a)),a.onShowSizeChange=a.onShowSizeChange.bind(Object(g.a)(a)),a.state={columns:[{title:"ID",dataIndex:"id",key:"id",width:30,className:"small_font"},{title:"\u7528\u6237",dataIndex:"username",key:"username",className:"small_font"},{title:"\u5185\u5bb9",dataIndex:"content",key:"content",className:"small_font "+{columnStyle:En}},{title:"\u8bc4\u5206",dataIndex:"score",key:"score",className:"small_font "+{columnStyle:En}},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"createTime",key:"createTime",className:"small_font "+{columnStyle:En}}],tableData:[],tableLoading:!1,authLinkModalVisible:!1,current_data_id:null,pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:a.onShowSizeChange,showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e){return a.changePage(e)}}},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onShowSizeChange",value:function(e,t){var a=this;this.setState({pagination:Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t})},function(){a.refreshTableData()})}},{key:"componentDidMount",value:function(){this.refreshTableData()}},{key:"render",value:function(){return i.a.createElement(yn,{style:{background:"#fff",padding:20,margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["\u7cfb\u7edf\u7ba1\u7406","\u7528\u6237\u53cd\u9988"]}),i.a.createElement("div",{style:{marginBottom:20}},i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:3},i.a.createElement(me.a,{type:"primary",onClick:this.refreshTableData},"\u5237 \u65b0")))),i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,rowClassName:"fixedHeight",size:"small"}))}}]),t}(r.Component),Sn=b.a.Content,kn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).jumpJobDetail=a.jumpJobDetail.bind(Object(g.a)(a)),a.state={jobs:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.loadJenkinsAllJobs()}},{key:"loadJenkinsAllJobs",value:function(){var e,t=this;z("jenkins/jobs",e).then(function(e){0===e.code?t.setState({jobs:e.data}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"jumpJobDetail",value:function(e){this.props.history.push({pathname:"/admin/cicd/job_detail",state:{jobName:e}})}},{key:"render",value:function(){var e=this;return i.a.createElement(Sn,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["CI & CD","\u4efb\u52a1\u5217\u8868"]}),i.a.createElement(oe.a,null,i.a.createElement(Ft.a,{title:"\u5f53\u524d\u4efb\u52a1",size:"small"},this.state.jobs.map(function(t,a){return i.a.createElement(Ft.a.Grid,{key:a,style:{width:"25%",textAlign:"center"}},i.a.createElement(me.a,{type:"link",onClick:e.jumpJobDetail.bind(e,t.name)},t.name))}))))}}]),t}(r.Component),In=(a(366),a(168)),Cn=(a(252),a(115)),Dn=b.a.Content,On=Z.a.Text,xn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).onDrawerClose=a.onDrawerClose.bind(Object(g.a)(a)),a.startBuildJob=a.startBuildJob.bind(Object(g.a)(a)),a.refreshJobInfo=a.refreshJobInfo.bind(Object(g.a)(a)),a.disableJob=a.disableJob.bind(Object(g.a)(a)),a.enableJob=a.enableJob.bind(Object(g.a)(a)),a.loadJenkinsJobBuildList=a.loadJenkinsJobBuildList.bind(Object(g.a)(a)),a.state={buildInfo:[],buildConsoleLog:"",logLoading:!1,jobBuilding:!1,refreshInfoLoading:!1,buildLog:[],start:0,timer:null,progressLoading:"none",nextBuildNumber:0},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.loadJenkinsJobBuildList({name:this.props.location.state.jobName}),this.setState({buildName:this.props.location.state.jobName})}},{key:"loadJenkinsJobBuildList",value:function(e){var t=this;this.setState({refreshInfoLoading:!0}),function(e){return z("jenkins/jobBuildList",e)}(e).then(function(e){if(0===e.code){var a=[];void 0!==e.data.buildLog&&null!==e.data.buildLog&&(a=e.data.buildLog),t.setState({buildInfo:e.data,buildLog:a,nextBuildNumber:parseInt(e.data.nextBuildNumber)})}else D.b.error(e.msg);t.setState({refreshInfoLoading:!1})}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"refreshJobInfo",value:function(){this.loadJenkinsJobBuildList({name:this.props.location.state.jobName})}},{key:"onDrawerClose",value:function(){this.setState({drawerVisible:!1,progressLoading:"none",buildConsoleLog:"",start:0}),clearTimeout(this.timer),this.timer=null,this.refreshJobInfo()}},{key:"showBuildConsoleLog",value:function(e){var t,a=this;this.setState({drawerVisible:!0,logLoading:!0,jobBuilding:!0}),(t={name:this.state.buildName,buildId:e,start:parseInt(this.state.start)},z("jenkins/jobBuildLog",t)).then(function(t){0===t.code?(a.setState({buildConsoleLog:a.state.buildConsoleLog+t.data.content,logLoading:!1,jobBuilding:!1,start:t.data.start}),"true"===t.data.hasMore?(a.setState({progressLoading:"inline-block"}),a.timer=setTimeout(function(){a.showBuildConsoleLog(e)},2e3)):(a.setState({progressLoading:"none"}),clearTimeout(a.timer),a.timer=null,a.refreshJobInfo())):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"startBuildJob",value:function(){var e,t=this;this.setState({jobBuilding:!0}),(e={name:this.state.buildName},P("jenkins/jobBuild",e)).then(function(e){0===e.code?setTimeout(function(){t.setState({jobBuilding:!1}),t.refreshJobInfo()},4e3):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"disableJob",value:function(){var e,t=this;(e={name:this.state.buildName},P("jenkins/disableJob",e)).then(function(e){0===e.code?(D.b.success("\u7981\u7528\u6210\u529f"),t.refreshJobInfo()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"enableJob",value:function(){var e,t=this;(e={name:this.state.buildName},P("jenkins/enableJob",e)).then(function(e){0===e.code?(D.b.success("\u542f\u7528\u6210\u529f"),t.refreshJobInfo()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"render",value:function(){var e=this,t=i.a.createElement("div",null,"\u6784\u5efa\u65e5\u5fd7",i.a.createElement(Cn.a,{type:"loading",style:{marginLeft:"20px",display:this.state.progressLoading}})),a=!0,n=i.a.createElement(me.a,{size:"small",onClick:this.disableJob,style:{marginLeft:"20px"}},"\u7981 \u7528");return!1===this.state.buildInfo.buildable&&(a=!1,n=i.a.createElement(me.a,{size:"small",onClick:this.enableJob,style:{marginLeft:"20px"}},"\u542f \u7528")),i.a.createElement(Dn,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["CI & CD","\u4efb\u52a1\u8be6\u60c5"]}),i.a.createElement(oe.a,{style:{padding:"0px 0px 10px 0px"}},i.a.createElement(ce.a,{span:2},i.a.createElement(me.a,{type:"primary",onClick:this.refreshJobInfo},"\u5237 \u65b0"))),i.a.createElement(le.a,{spinning:this.state.refreshInfoLoading},i.a.createElement(ie.a,{bordered:!0,size:"small",column:2},i.a.createElement(ie.a.Item,{label:"\u4efb\u52a1\u540d"},this.state.buildInfo.displayName),i.a.createElement(ie.a.Item,{label:"\u4efb\u52a1\u63cf\u8ff0"},this.state.buildInfo.description),i.a.createElement(ie.a.Item,{label:"\u4efb\u52a1\u64cd\u4f5c"},i.a.createElement(me.a,{size:"small",disabled:!a,loading:this.state.jobBuilding,onClick:this.startBuildJob},"\u6784\u5efa"),n))),i.a.createElement(re.a,{title:t,placement:"left",closable:!1,onClose:this.onDrawerClose,visible:this.state.drawerVisible,width:700},i.a.createElement(le.a,{spinning:this.state.logLoading},i.a.createElement(On,{style:{whiteSpace:"pre"}},this.state.buildConsoleLog))),i.a.createElement(In.b,{header:i.a.createElement("div",null,"\u8fd15\u6b21\u6784\u5efa\u72b6\u6001"),footer:null,bordered:!0,dataSource:this.state.buildLog,style:{marginTop:"10px",width:"50%"},renderItem:function(t){var a=JSON.parse(t),n=i.a.createElement(ca.a,{color:"#2db7f5"},"\u6784\u5efa\u4e2d");void 0!==a.result&&null!==a.result&&(n="SUCCESS"===a.result?i.a.createElement(ca.a,{color:"#108ee9"},"\u6210 \u529f"):"FAILURE"===a.result?i.a.createElement(ca.a,{color:"#f50"},"\u5931 \u8d25"):"ABORTED"===a.result?i.a.createElement(ca.a,{color:"#f50"},"\u4e2d \u6b62"):i.a.createElement(ca.a,{color:"magenta"},a.result));var r=i.a.createElement(On,{type:"secondary"},we()(a.timestamp).format("MM-DD HH:mm:ss")),l=i.a.createElement("div",{style:{display:"inline-block",float:"right"}},i.a.createElement(me.a,{type:"link",size:"small",onClick:e.showBuildConsoleLog.bind(e,a.id)},"\u6784\u5efa\u65e5\u5fd7"));return i.a.createElement(In.b.Item,null,n," - ",a.fullDisplayName," - ",r,l)}}))}}]),t}(r.Component),wn=b.a.Content,jn=function(e){function t(){return Object(o.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(wn,{style:{background:"#fff",padding:0,margin:0,height:"100%"}},i.a.createElement(p.a,null,i.a.createElement(f.a,{path:"/admin/cicd/jobs",component:kn}),i.a.createElement(f.a,{path:"/admin/cicd/job_detail",component:xn})))}}]),t}(r.Component),Tn=(a(1213),a(622)),Ln=function(e){return z("/kubernetes/metrics/node",e)},Mn=function(e){return z("/kubernetes/metrics/pod",e)},An=a(328),_n=(a(585),{rc:"apiVersion: v1\nkind: ReplicationController\nmetadata:\n  name: redis-rc\nspec:\n  replicas: 1\n  selector:\n    app: redis\n  template:\n    metadata:\n      name: redis\n      labels:\n        app: redis\n    spec:\n      containers:\n      - name: redis\n        image: redis\n        ports:\n        - containerPort: 6379",rs:"apiVersion: apps/v1\nkind: ReplicaSet\nmetadata:\n  name: redis-rs\n  labels:\n    app: redis\nspec:\n  replicas: 1\n  selector:\n    app: redis\n  template:\n    metadata:\n      labels:\n        app: redis\n    spec:\n      containers:\n      - name: redis\n        image: redis\n        ports:\n        - containerPort: 6379",deployment:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  labels:\n    app: nginx\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:latest\n        ports:\n        - containerPort: 80",statefull_rs:'kind: StatefulSet\nmetadata:\n  name: web\nspec:\n  selector:\n    matchLabels:\n      app: nginx # has to match .spec.template.metadata.labels\n  serviceName: "nginx"\n  replicas: 3 # by default is 1\n  template:\n    metadata:\n      labels:\n        app: nginx # has to match .spec.selector.matchLabels\n    spec:\n      terminationGracePeriodSeconds: 10\n      containers:\n      - name: nginx\n        image: k8s.gcr.io/nginx-slim:0.8\n        ports:\n        - containerPort: 80\n          name: web\n        volumeMounts:\n        - name: www\n          mountPath: /usr/share/nginx/html\n  volumeClaimTemplates:\n  - metadata:\n      name: www\n    spec:\n      accessModes: [ "ReadWriteOnce" ]\n      storageClassName: "my-storage-class"\n      resources:\n        requests:\n          storage: 1Gi',daemon_set:"apiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: fluentd-elasticsearch\n  namespace: kube-system\n  labels:\n    k8s-app: fluentd-logging\nspec:\n  selector:\n    matchLabels:\n      name: fluentd-elasticsearch\n  template:\n    metadata:\n      labels:\n        name: fluentd-elasticsearch\n    spec:\n      tolerations:\n      - key: node-role.kubernetes.io/master\n        effect: NoSchedule\n      containers:\n      - name: fluentd-elasticsearch\n        image: gcr.io/fluentd-elasticsearch/fluentd:v2.5.1\n        resources:\n          limits:\n            memory: 200Mi\n          requests:\n            cpu: 100m\n            memory: 200Mi\n        volumeMounts:\n        - name: varlog\n          mountPath: /var/log\n        - name: varlibdockercontainers\n          mountPath: /var/lib/docker/containers\n          readOnly: true\n      terminationGracePeriodSeconds: 30\n      volumes:\n      - name: varlog\n        hostPath:\n          path: /var/log\n      - name: varlibdockercontainers\n        hostPath:\n          path: /var/lib/docker/containers",service:"apiVersion: v1\nkind: Service\nmetadata:\n  name: redis\nspec:\n  type: NodePort\n  ports:\n   - port: 6379\n     nodePort: 30003\n  selector:\n    app: redis",config_map:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: example-config\ndata:\n  example.property.1: hello",secret_map:'apiVersion: v1\nkind: Secret\nmetadata:\n  name: example-config\ntype: Opaque\nstringData:\n  example.property.1: "test"'}),Rn=b.a.Content,Nn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={rcDetail:a.props.location.state},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=[];for(var t in this.state.rcDetail.data.metadata.labels)e.push(i.a.createElement("div",{key:t},i.a.createElement(ca.a,{color:"geekblue"},t+":"+this.state.rcDetail.data.metadata.labels[t])));var a=[];for(var n in this.state.rcDetail.data.spec.selector)a.push(i.a.createElement("div",{key:n},i.a.createElement(ca.a,{color:"geekblue"},n+":"+this.state.rcDetail.data.spec.selector[n])));for(var r=[],l=this.state.rcDetail.data.spec.template.spec.containers,s=0;s<l.length;s++)r.push(i.a.createElement("div",{key:s},i.a.createElement(ca.a,{color:"geekblue"},l[s].image)));return i.a.createElement(Rn,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Ft.a,{size:"small",title:"Replication Controller \u8be6\u60c5",style:{width:"100%"}},i.a.createElement(ie.a,{bordered:!0,size:"small",column:2},i.a.createElement(ie.a.Item,{label:"\u540d\u79f0"},this.state.rcDetail.data.metadata.name),i.a.createElement(ie.a.Item,{label:"\u547d\u540d\u7a7a\u95f4"},this.state.rcDetail.data.metadata.namespace),i.a.createElement(ie.a.Item,{label:"\u521b\u5efa\u65f6\u95f4"},this.state.rcDetail.data.metadata.creationTimestamp),i.a.createElement(ie.a.Item,{label:"\u6807\u7b7e"},e),i.a.createElement(ie.a.Item,{label:"\u9009\u62e9\u5668"},a),i.a.createElement(ie.a.Item,{label:"\u955c\u50cf"},r),i.a.createElement(ie.a.Item,{label:"\u526f\u672c\u6570"},this.state.rcDetail.data.status.replicas),i.a.createElement(ie.a.Item,{label:"\u8fd0\u884c\u4e2d"},this.state.rcDetail.data.status.readyReplicas))))}}]),t}(r.Component),zn=b.a.Content,Pn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={serviceDetail:a.props.location.state},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=[];for(var t in this.state.serviceDetail.data.metadata.labels)e.push(i.a.createElement("div",{key:t},i.a.createElement(ca.a,{color:"geekblue"},t+":"+this.state.serviceDetail.data.metadata.labels[t])));var a=[];for(var n in this.state.serviceDetail.data.spec.selector)a.push(i.a.createElement("div",{key:n},i.a.createElement(ca.a,{color:"geekblue"},n+":"+this.state.serviceDetail.data.spec.selector[n])));for(var r=[],l=this.state.serviceDetail.data.spec.ports,s=0;s<l.length;s++){var o="";l[s].hasOwnProperty("port")&&(o+=l[s].port+"(port) "),l[s].hasOwnProperty("targetPort")&&(o+=l[s].targetPort+"(targetPort) "),l[s].hasOwnProperty("nodePort")&&(o+=l[s].nodePort+"(nodePort) "),r.push(i.a.createElement(ca.a,{color:"geekblue"},l[s].protocol+": "+o))}return i.a.createElement(zn,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Ft.a,{size:"small",title:"Service \u8be6\u60c5",style:{width:"100%"}},i.a.createElement(ie.a,{bordered:!0,size:"small",column:2},i.a.createElement(ie.a.Item,{label:"\u540d\u79f0"},this.state.serviceDetail.data.metadata.name),i.a.createElement(ie.a.Item,{label:"\u547d\u540d\u7a7a\u95f4"},this.state.serviceDetail.data.metadata.namespace),i.a.createElement(ie.a.Item,{label:"\u521b\u5efa\u65f6\u95f4"},this.state.serviceDetail.data.metadata.creationTimestamp),i.a.createElement(ie.a.Item,{label:"\u6807\u7b7e"},e),i.a.createElement(ie.a.Item,{label:"clusterIP"},this.state.serviceDetail.data.spec.clusterIP),i.a.createElement(ie.a.Item,{label:"\u7c7b\u578b"},this.state.serviceDetail.data.spec.type),i.a.createElement(ie.a.Item,{label:"sessionAffinity"},this.state.serviceDetail.data.spec.sessionAffinity),i.a.createElement(ie.a.Item,{label:"\u7aef\u53e3"},r),i.a.createElement(ie.a.Item,{label:"\u9009\u62e9\u6807\u7b7e"},a))))}}]),t}(r.Component),Vn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).id=a.uuid(),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"uuid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},{key:"componentDidMount",value:function(){var e=this,t=this.id,a=this.props.data,n=this.props.xField?this.props.xField:"date",r=this.props.yField?this.props.yField:"value";setTimeout(function(){e.area=new We.Area(t,{data:a,width:e.props.width,height:e.props.height,xField:n,yField:r,padding:"auto",isStack:!1,yAxis:{label:{formatter:function(t){return t+" "+e.props.unit},style:{fill:"#FE740C"}}}}),e.area.render()},300)}},{key:"componentDidUpdate",value:function(){this.area.changeData(this.props.data)}},{key:"render",value:function(){return i.a.createElement("div",{id:this.id,style:{height:this.props.height,width:this.props.width}})}}]),t}(r.Component),Bn=a(618),qn=Z.a.Text,Yn=b.a.Content,Fn=Ee.a.TabPane,Un=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).loadPodLog=a.loadPodLog.bind(Object(g.a)(a)),a.handleCancelLogModal=a.handleCancelLogModal.bind(Object(g.a)(a)),a.openWebTerminal=a.openWebTerminal.bind(Object(g.a)(a)),a.state={serviceDetail:a.props.location.state,memoryChartData:[],cpuChartData:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.refreshPodCpuMetrics(),this.refreshPodMemoryMetrics()}},{key:"refreshPodCpuMetrics",value:function(){var e=this;Mn({clusterId:localStorage.getItem("clusterId"),metricName:"cpu",namespace:this.props.location.state.data.metadata.namespace,podName:this.props.location.state.data.metadata.name}).then(function(t){0===t.code&&e.setState({cpuChartData:t.data.items[0].metricPoints})})}},{key:"refreshPodMemoryMetrics",value:function(){var e=this;Mn({clusterId:localStorage.getItem("clusterId"),metricName:"memory",namespace:this.props.location.state.data.metadata.namespace,podName:this.props.location.state.data.metadata.name}).then(function(t){0===t.code&&e.setState({memoryChartData:t.data.items[0].metricPoints})})}},{key:"loadPodLog",value:function(e){"Running"===this.state.serviceDetail.data.status.phase?this.props.history.push({pathname:"/admin/k8s_cluster/manage/container_log",state:{namespace:this.state.serviceDetail.data.metadata.namespace,podName:this.state.serviceDetail.data.metadata.name,containerName:e}}):D.b.error("\u5f53\u524dpod\u672a\u8fd0\u884c\uff0c\u65e0\u6cd5\u67e5\u770b\u65e5\u5fd7\uff01")}},{key:"handleCancelLogModal",value:function(){this.setState({logModalVisible:!1,logLoading:!1})}},{key:"openWebTerminal",value:function(e){"Running"===this.state.serviceDetail.data.status.phase?this.props.history.push({pathname:"/admin/k8s_cluster/manage/container_terminal",state:{namespace:this.state.serviceDetail.data.metadata.namespace,podName:this.state.serviceDetail.data.metadata.name,containerName:e}}):D.b.error("\u5f53\u524dpod\u672a\u8fd0\u884c\uff0c\u65e0\u6cd5\u4f7f\u7528\u7ec8\u7aef\uff01")}},{key:"render",value:function(){var e=this,t=[];for(var a in this.state.serviceDetail.data.metadata.labels)t.push(i.a.createElement("div",{key:a},i.a.createElement(ca.a,{color:"geekblue"},a+":"+this.state.serviceDetail.data.metadata.labels[a])));var n=this.state.serviceDetail.data.spec.containers.map(function(t){var a=[];if(t.hasOwnProperty("ports"))for(var n=0;n<t.ports.length;n++)a.push(i.a.createElement(ca.a,{color:"geekblue"},t.ports[n].containerPort+"("+t.ports[n].protocol+")"));return i.a.createElement(oe.a,{style:{width:"100%",borderBottom:"1px solid #e8e8e8"}},i.a.createElement(ce.a,{span:24},i.a.createElement(In.b,{itemLayout:"horizontal"},i.a.createElement(In.b.Item,{style:{width:"100%"}},i.a.createElement(In.b.Item.Meta,{avatar:i.a.createElement(nt,null),title:i.a.createElement(qn,{type:"secondary"},"\u5bb9\u5668\u540d\uff1a",t.name," \xa0\xa0",i.a.createElement(me.a,{type:"link",onClick:e.loadPodLog.bind(e,t.name)},"\u67e5\u770b\u65e5\u5fd7"),i.a.createElement(me.a,{type:"link",onClick:e.openWebTerminal.bind(e,t.name)},"\u6267\u884c\u547d\u4ee4")),description:i.a.createElement(qn,{type:"secondary"},"\u955c\u50cf\uff1a",t.image," \xa0\xa0 \u7aef\u53e3: ",a)})))))});return i.a.createElement(Yn,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Ee.a,{defaultActiveKey:"Pod\u8be6\u60c5"},i.a.createElement(Fn,{tab:"Pod\u8be6\u60c5",key:"Pod\u8be6\u60c5"},i.a.createElement(ie.a,{bordered:!0,size:"small",column:2},i.a.createElement(ie.a.Item,{label:"Pod\u540d\u79f0"},this.state.serviceDetail.data.metadata.name),i.a.createElement(ie.a.Item,{label:"\u547d\u540d\u7a7a\u95f4"},this.state.serviceDetail.data.metadata.namespace),i.a.createElement(ie.a.Item,{label:"\u521b\u5efa\u65f6\u95f4"},this.state.serviceDetail.data.metadata.creationTimestamp),i.a.createElement(ie.a.Item,{label:"\u6807\u7b7e"},t),i.a.createElement(ie.a.Item,{label:"\u72b6\u6001"},this.state.serviceDetail.data.status.phase),i.a.createElement(ie.a.Item,{label:"Host IP"},this.state.serviceDetail.data.status.hostIP),i.a.createElement(ie.a.Item,{label:"Pod IP"},this.state.serviceDetail.data.status.podIP)),i.a.createElement(Ft.a,{size:"small",title:"\u5bb9\u5668\u5217\u8868",style:{width:"100%",marginTop:"10px"}},n)),i.a.createElement(Fn,{tab:"Pod\u76d1\u63a7",key:"Pod\u76d1\u63a7"},i.a.createElement(Ft.a,{size:"small",title:"CPU",extra:i.a.createElement(Bn.a,{onClick:this.refreshPodCpuMetrics.bind(this)}),style:{marginBottom:20}},i.a.createElement(Vn,{width:"100%",height:200,xField:"timestamp",unit:"m",data:this.state.cpuChartData})),i.a.createElement(Ft.a,{size:"small",title:"Memory",extra:i.a.createElement(Bn.a,{onClick:this.refreshPodMemoryMetrics.bind(this)})},i.a.createElement(Vn,{width:"100%",height:200,xField:"timestamp",unit:"Mi",data:this.state.memoryChartData})))))}}]),t}(r.Component),Kn=b.a.Content,Hn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).goBack=a.goBack.bind(Object(g.a)(a)),a.rws=new st.a(R+"ws/kubernetes/container_terminal"),a.terminal=new it.Terminal({rows:36,fontSize:14,cursorBlink:!0,cursorStyle:"block",bellStyle:"sound",theme:"Console"}),a.terminal.prompt=function(){a.terminal.write("\r\n$ ")},a.state={containerDetail:a.props.location.state,connectionStatus:0},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.terminal.open(document.getElementById("terminal")),this.terminal.writeln("Welcome to use Web Terminal."),this.terminal.prompt(),this.initWsConnection(),ha=new lt.AttachAddon(this.rws),this.terminal.loadAddon(ha),this.terminal.focus()}},{key:"componentWillUnmount",value:function(){this.rws.send(JSON.stringify({action:"connection_close",clusterId:localStorage.getItem("clusterId"),namespace:this.state.containerDetail.namespace,podName:this.state.containerDetail.podName,containerName:this.state.containerDetail.containerName})),this.rws.close(),this.terminal.dispose()}},{key:"initWsConnection",value:function(){var e=this;this.rws.addEventListener("open",function(){e.rws.send(JSON.stringify({action:"init_connection",clusterId:localStorage.getItem("clusterId"),namespace:e.state.containerDetail.namespace,podName:e.state.containerDetail.podName,containerName:e.state.containerDetail.containerName})),e.setState({connectionStatus:1})}),this.rws.addEventListener("close",function(){e.setState({connectionStatus:0})}),this.rws.addEventListener("error",function(){e.setState({connectionStatus:0})})}},{key:"goBack",value:function(){this.rws.send(JSON.stringify({action:"connection_close",clusterId:localStorage.getItem("clusterId"),namespace:this.state.containerDetail.namespace,podName:this.state.containerDetail.podName,containerName:this.state.containerDetail.containerName})),this.rws.close(),this.props.history.goBack()}},{key:"render",value:function(){var e=i.a.createElement(Yt.a,{message:"\u8fdc\u7a0b\u8fde\u63a5\u672a\u5efa\u7acb",type:"error",showIcon:!0});return 1===this.state.connectionStatus&&(e=i.a.createElement(Yt.a,{message:"\u8fdc\u7a0b\u8fde\u63a5\u6210\u529f",type:"success",showIcon:!0})),i.a.createElement(Kn,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(me.a,{type:"link",onClick:this.goBack},i.a.createElement(Cn.a,{type:"left"}),"\u8fd4\u56de\u4e0a\u7ea7"),e,i.a.createElement(Ft.a,{size:"small",title:"\u7ec8\u7aef",style:{width:"100%"},bodyStyle:{padding:0}},i.a.createElement("div",{id:"terminal",style:{width:"100%"}})))}}]),t}(r.Component),Jn=b.a.Content,Gn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).goBack=a.goBack.bind(Object(g.a)(a)),a.syncLogs=a.syncLogs.bind(Object(g.a)(a)),a.state={logLoading:!1,containerInfo:a.props.location.state},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.syncLogs()}},{key:"goBack",value:function(){var e=this;this.setState({logContent:""},function(){e.props.history.goBack()})}},{key:"syncLogs",value:function(){var e,t=this;this.setState({logLoading:!0}),(e={namespace:this.state.containerInfo.namespace,podName:this.state.containerInfo.podName,containerName:this.state.containerInfo.containerName},z("/kubernetes/pod/log",e)).then(function(e){0===e.code?t.setState({logContent:e.data,logLoading:!1},function(){t.scrollToBottom()}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"scrollToBottom",value:function(){var e=document.getElementById("logPanel");e.scrollTop=e.scrollHeight}},{key:"render",value:function(){return i.a.createElement(Jn,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(oe.a,{style:{padding:"0px 0px 10px 0px"}},i.a.createElement(me.a,{type:"link",onClick:this.goBack},i.a.createElement(Cn.a,{type:"left"}),"\u8fd4\u56de\u4e0a\u7ea7"),i.a.createElement(me.a,{type:"link",icon:"reload",onClick:this.syncLogs,style:{float:"right"}},"\u5237 \u65b0")),i.a.createElement(le.a,{spinning:this.state.logLoading},i.a.createElement("div",{style:{height:"85vh"}},i.a.createElement("div",{id:"logPanel",style:{whiteSpace:"pre-line",backgroundColor:"rgb(19, 19, 19)",color:"#fff",fontSize:"14px",lineHeight:"20px",height:"100%",padding:"10px",overflow:"scroll"}},this.state.logContent))))}}]),t}(r.Component),Qn=b.a.Content,Wn=Z.a.Text,Zn=Ee.a.TabPane,$n=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={nodeDetail:a.props.location.state,memoryChartData:[],cpuChartData:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.refreshNodeCpuMetrics(),this.refreshNodeMemoryMetrics()}},{key:"refreshNodeCpuMetrics",value:function(){var e=this;Ln({clusterId:localStorage.getItem("clusterId"),metricName:"cpu",nodeName:this.props.location.state.data.metadata.name}).then(function(t){0===t.code&&e.setState({cpuChartData:t.data.items[0].metricPoints})})}},{key:"refreshNodeMemoryMetrics",value:function(){var e=this;Ln({clusterId:localStorage.getItem("clusterId"),metricName:"memory",nodeName:this.props.location.state.data.metadata.name}).then(function(t){0===t.code&&e.setState({memoryChartData:t.data.items[0].metricPoints})})}},{key:"render",value:function(){var e=[];for(var t in this.state.nodeDetail.data.metadata.labels)e.push(i.a.createElement("div",{key:t},i.a.createElement(ca.a,{color:"geekblue"},t+":"+this.state.nodeDetail.data.metadata.labels[t])));var a=[];for(var n in this.state.nodeDetail.data.metadata.annotations)a.push(i.a.createElement("div",{key:n},i.a.createElement(ca.a,{color:"geekblue"},n+":"+this.state.nodeDetail.data.metadata.annotations[n])));for(var r=[],l=this.state.nodeDetail.data.status.addresses,s=0;s<l.length;s++)r.push(i.a.createElement(Wn,null,l[s].type+":  "+l[s].address)),r.push(i.a.createElement("br",null));return i.a.createElement(Qn,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Ee.a,{defaultActiveKey:"Node\u4fe1\u606f"},i.a.createElement(Zn,{tab:"Node\u4fe1\u606f",key:"Node\u4fe1\u606f"},i.a.createElement(ie.a,{bordered:!0,size:"small",column:1},i.a.createElement(ie.a.Item,{label:"\u540d\u79f0"},this.state.nodeDetail.data.metadata.name),i.a.createElement(ie.a.Item,{label:"\u521b\u5efa\u65f6\u95f4"},this.state.nodeDetail.data.metadata.creationTimestamp),i.a.createElement(ie.a.Item,{label:"\u6807\u7b7e"},e),i.a.createElement(ie.a.Item,{label:"\u6ce8\u89e3"},a),i.a.createElement(ie.a.Item,{label:"\u5730\u5740"},r),i.a.createElement(ie.a.Item,{label:"kubelet\u7aef\u53e3"},this.state.nodeDetail.data.status.daemonEndpoints.kubeletEndpoint.Port),i.a.createElement(ie.a.Item,{label:"\u5bb9\u5668\u7248\u672c"},this.state.nodeDetail.data.status.nodeInfo.containerRuntimeVersion),i.a.createElement(ie.a.Item,{label:"kubelet\u7248\u672c"},this.state.nodeDetail.data.status.nodeInfo.kubeletVersion),i.a.createElement(ie.a.Item,{label:"kubeProxy\u7248\u672c"},this.state.nodeDetail.data.status.nodeInfo.kubeProxyVersion),i.a.createElement(ie.a.Item,{label:"\u7cfb\u7edf"},this.state.nodeDetail.data.status.nodeInfo.operatingSystem),i.a.createElement(ie.a.Item,{label:"\u67b6\u6784"},this.state.nodeDetail.data.status.nodeInfo.architecture))),i.a.createElement(Zn,{tab:"Node\u76d1\u63a7",key:"Node\u76d1\u63a7"},i.a.createElement(Ft.a,{size:"small",title:"CPU",extra:i.a.createElement(Bn.a,{onClick:this.refreshNodeCpuMetrics.bind(this)}),style:{marginBottom:20}},i.a.createElement(Vn,{width:"100%",height:200,xField:"timestamp",unit:"m",data:this.state.cpuChartData})),i.a.createElement(Ft.a,{size:"small",title:"Memory",extra:i.a.createElement(Bn.a,{onClick:this.refreshNodeMemoryMetrics.bind(this)})},i.a.createElement(Vn,{width:"100%",height:200,xField:"timestamp",unit:"Mi",data:this.state.memoryChartData})))))}}]),t}(r.Component),Xn=b.a.Content,er=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={rsDetail:a.props.location.state},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=[];for(var t in this.state.rsDetail.data.metadata.labels)e.push(i.a.createElement("div",{key:t},i.a.createElement(ca.a,{color:"geekblue"},t+":"+this.state.rsDetail.data.metadata.labels[t])));var a=[];for(var n in this.state.rsDetail.data.metadata.annotations)a.push(i.a.createElement("div",{key:n},i.a.createElement(ca.a,{color:"geekblue"},n+":"+this.state.rsDetail.data.metadata.annotations[n])));var r=[];for(var l in this.state.rsDetail.data.spec.selector.matchLabels)r.push(i.a.createElement("div",{key:l},i.a.createElement(ca.a,{color:"geekblue"},l+":"+this.state.rsDetail.data.spec.selector.matchLabels[l])));for(var s=[],o=this.state.rsDetail.data.spec.template.spec.containers,c=0;c<o.length;c++)s.push(i.a.createElement("div",{key:c},i.a.createElement(ca.a,{color:"geekblue"},o[c].image)));return i.a.createElement(Xn,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Ft.a,{size:"small",title:"ReplicaSet \u8be6\u60c5",style:{width:"100%"}},i.a.createElement(ie.a,{bordered:!0,size:"small",column:2},i.a.createElement(ie.a.Item,{label:"\u540d\u79f0"},this.state.rsDetail.data.metadata.name),i.a.createElement(ie.a.Item,{label:"\u547d\u540d\u7a7a\u95f4"},this.state.rsDetail.data.metadata.namespace),i.a.createElement(ie.a.Item,{label:"\u521b\u5efa\u65f6\u95f4"},this.state.rsDetail.data.metadata.creationTimestamp),i.a.createElement(ie.a.Item,{label:"\u6807\u7b7e"},e),i.a.createElement(ie.a.Item,{label:"\u6ce8\u89e3"},a),i.a.createElement(ie.a.Item,{label:"\u9009\u62e9\u5668"},r),i.a.createElement(ie.a.Item,{label:"\u955c\u50cf"},s),i.a.createElement(ie.a.Item,{label:"\u526f\u672c\u6570"},this.state.rsDetail.data.status.replicas),i.a.createElement(ie.a.Item,{label:"\u8fd0\u884c\u4e2d"},this.state.rsDetail.data.status.readyReplicas))))}}]),t}(r.Component),tr=b.a.Content,ar=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={rsDetail:a.props.location.state},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=[];for(var t in this.state.rsDetail.data.metadata.labels)e.push(i.a.createElement("div",{key:t},i.a.createElement(ca.a,{color:"geekblue"},t+":"+this.state.rsDetail.data.metadata.labels[t])));var a=[];for(var n in this.state.rsDetail.data.metadata.annotations)a.push(i.a.createElement("div",{key:n},i.a.createElement(ca.a,{color:"geekblue"},n+":"+this.state.rsDetail.data.metadata.annotations[n])));var r=[];for(var l in this.state.rsDetail.data.spec.selector.matchLabels)r.push(i.a.createElement("div",{key:l},i.a.createElement(ca.a,{color:"geekblue"},l+":"+this.state.rsDetail.data.spec.selector.matchLabels[l])));for(var s=[],o=this.state.rsDetail.data.spec.template.spec.containers,c=0;c<o.length;c++)s.push(i.a.createElement("div",{key:c},i.a.createElement(ca.a,{color:"geekblue"},o[c].image)));return i.a.createElement(tr,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Ft.a,{size:"small",title:"Deployment \u8be6\u60c5",style:{width:"100%"}},i.a.createElement(ie.a,{bordered:!0,size:"small",column:2},i.a.createElement(ie.a.Item,{label:"\u540d\u79f0"},this.state.rsDetail.data.metadata.name),i.a.createElement(ie.a.Item,{label:"\u547d\u540d\u7a7a\u95f4"},this.state.rsDetail.data.metadata.namespace),i.a.createElement(ie.a.Item,{label:"\u521b\u5efa\u65f6\u95f4"},this.state.rsDetail.data.metadata.creationTimestamp),i.a.createElement(ie.a.Item,{label:"\u6807\u7b7e"},e),i.a.createElement(ie.a.Item,{label:"\u6ce8\u89e3"},a),i.a.createElement(ie.a.Item,{label:"\u9009\u62e9\u5668"},r),i.a.createElement(ie.a.Item,{label:"\u955c\u50cf"},s),i.a.createElement(ie.a.Item,{label:"\u526f\u672c\u6570"},this.state.rsDetail.data.status.replicas),i.a.createElement(ie.a.Item,{label:"\u8fd0\u884c\u4e2d"},this.state.rsDetail.data.status.readyReplicas))))}}]),t}(r.Component),nr=b.a.Content,rr=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={ingressDetail:a.props.location.state},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.state.ingressDetail.data.spec.tls.map(function(e,t){return i.a.createElement("span",null,e.secretName,i.a.createElement("br",null))}),t=this.state.ingressDetail.data.spec.rules.map(function(e,t){return i.a.createElement(In.b,{header:i.a.createElement("div",null,e.host),bordered:!0,dataSource:e.http.paths,renderItem:function(e){return i.a.createElement(In.b.Item,null,i.a.createElement(ie.a,{column:2},i.a.createElement(ie.a.Item,{label:"path"},e.path),i.a.createElement(ie.a.Item,{label:"pathType"},e.pathType),i.a.createElement(ie.a.Item,{label:"backend"},e.backend.serviceName,":",e.backend.servicePort)))}})});return i.a.createElement(nr,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Ft.a,{size:"small",title:"Ingress \u8be6\u60c5",style:{width:"100%"}},i.a.createElement(ie.a,{bordered:!0,size:"small",column:2},i.a.createElement(ie.a.Item,{label:"\u540d\u79f0"},this.state.ingressDetail.data.metadata.name),i.a.createElement(ie.a.Item,{label:"\u547d\u540d\u7a7a\u95f4"},this.state.ingressDetail.data.metadata.namespace),i.a.createElement(ie.a.Item,{label:"\u521b\u5efa\u65f6\u95f4"},we()(this.state.ingressDetail.data.metadata.creationTimestamp).format("YYYY-MM-DD HH:mm:ss")),i.a.createElement(ie.a.Item,{label:"\u8bc1\u4e66"},e),i.a.createElement(ie.a.Item,{label:"\u57df\u540d\u914d\u7f6e"},t))))}}]),t}(r.Component),ir=a(662),lr=a.n(ir),sr=Ee.a.TabPane,or=b.a.Content,cr=ye.a.Option,dr=Tn.a.Panel,ur=E.a.confirm,mr={background:"#f7f7f7",borderRadius:4,marginBottom:24,border:0,overflow:"hidden"},hr=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).showLoading=function(){a.setState({refreshDataLoading:!0}),setTimeout(function(){a.setState({refreshDataLoading:!1})},800)},a.getColumnSearchProps=function(e){return{filterDropdown:function(e){var t=e.setSelectedKeys,n=e.selectedKeys,r=e.confirm,l=e.clearFilters;return i.a.createElement("div",{style:{padding:8}},i.a.createElement(O.a,{ref:function(e){a.searchInput=e},value:n[0],onChange:function(e){return t(e.target.value?[e.target.value]:[])},onPressEnter:function(){return a.handleSearch(n,r)},style:{width:188,marginBottom:8,display:"block"}}),i.a.createElement(me.a,{type:"primary",onClick:function(){return a.handleSearch(n,r)},icon:"search",size:"small",style:{width:90,marginRight:8}},"\u67e5\u627e"),i.a.createElement(me.a,{onClick:function(){return a.handleReset(l)},size:"small",style:{width:90}},"\u91cd\u7f6e"))},filterIcon:function(e){return i.a.createElement(Cn.a,{type:"search",style:{color:e?"#1890ff":"#40a9ff"}})},onFilter:function(t,a){return console.log(e,a),a.metadata[e].toString().toLowerCase().includes(t.toLowerCase())},onFilterDropdownVisibleChange:function(e){e&&setTimeout(function(){return a.searchInput.select()})},render:function(e){return i.a.createElement(lr.a,{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[a.state.searchText],autoEscape:!0,textToHighlight:e.toString()})}}},a.handleSearch=function(e,t){t(),a.setState({searchText:e[0]})},a.handleReset=function(e){e(),a.setState({searchText:""})},a.refreshNamespaceResources=a.refreshNamespaceResources.bind(Object(g.a)(a)),a.selectChange=a.selectChange.bind(Object(g.a)(a)),a.yarmCreateK8sResource=a.yarmCreateK8sResource.bind(Object(g.a)(a)),a.handleOk=a.handleOk.bind(Object(g.a)(a)),a.handleCancel=a.handleCancel.bind(Object(g.a)(a)),a.selectTemplateChange=a.selectTemplateChange.bind(Object(g.a)(a)),a.onDrawerClose=a.onDrawerClose.bind(Object(g.a)(a)),a.handleYamlDetailCancel=a.handleYamlDetailCancel.bind(Object(g.a)(a)),a.handleScaleCancel=a.handleScaleCancel.bind(Object(g.a)(a)),a.handleScaleCommit=a.handleScaleCommit.bind(Object(g.a)(a)),a.onInputNumberChange=a.onInputNumberChange.bind(Object(g.a)(a)),a.handleConfigCancel=a.handleConfigCancel.bind(Object(g.a)(a)),a.state={nodeColumns:[Object(fe.a)({title:"\u540d\u79f0",key:"name"},a.getColumnSearchProps("name"),{render:function(e,t){return i.a.createElement(me.a,{type:"link",onClick:a.showDetail.bind(Object(g.a)(a),"node",t)},t.metadata.name)}}),{title:"\u6807\u7b7e",key:"labels",render:function(e,t){var a=[];for(var n in t.metadata.labels)a.push(i.a.createElement("div",{key:n},i.a.createElement(ca.a,{color:"geekblue"},n+":"+t.metadata.labels[n])));return a}},{title:"\u5df2\u5c31\u7eea",key:"ready",render:function(e,t){for(var a=t.status.conditions,n=i.a.createElement(ca.a,{color:"#f50"},"False"),r=0;r<a.length;r++)if("Ready"===a[r].type){"False"!==a[r].status&&(n=i.a.createElement(ca.a,{color:"#87d068"},"True"));break}return n}},{title:"\u78c1\u76d8\u538b\u529b",key:"disk",render:function(e,t){for(var a=t.status.conditions,n=i.a.createElement(ca.a,{color:"#87d068"},"\u65e0\u538b\u529b"),r=0;r<a.length;r++)if("DiskPressure"===a[r].type){"False"!==a[r].status&&(n=i.a.createElement(ca.a,{color:"#f50"},"\u6709\u538b\u529b"));break}return n}},{title:"\u5185\u5b58\u538b\u529b",key:"memory",render:function(e,t){for(var a=t.status.conditions,n=i.a.createElement(ca.a,{color:"#87d068"},"\u65e0\u538b\u529b"),r=0;r<a.length;r++)if("MemoryPressure"===a[r].type){"False"!==a[r].status&&(n=i.a.createElement(ca.a,{color:"#f50"},"\u6709\u538b\u529b"));break}return n}},{title:"PID\u538b\u529b",key:"pid",render:function(e,t){for(var a=t.status.conditions,n=i.a.createElement(ca.a,{color:"#87d068"},"\u65e0\u538b\u529b"),r=0;r<a.length;r++)if("PIDPressure"===a[r].type){"False"!==a[r].status&&(n=i.a.createElement(ca.a,{color:"#f50"},"\u6709\u538b\u529b"));break}return n}},{title:"\u521b\u5efa\u65f6\u95f4",key:"create_time",render:function(e,t){return we()(t.metadata.creationTimestamp).format("YYYY-MM-DD")}}],rcColumns:[Object(fe.a)({title:"\u540d\u79f0",key:"name"},a.getColumnSearchProps("name"),{render:function(e,t){var n=i.a.createElement(tt,null);return(void 0===t.status.readyReplicas||t.status.readyReplicas<t.status.replicas)&&(n=i.a.createElement(at,null)),i.a.createElement("div",null,i.a.createElement("span",{style:{position:"relative",top:"5px"}},n),i.a.createElement(me.a,{type:"link",onClick:a.showDetail.bind(Object(g.a)(a),"rc",t)},t.metadata.name))}}),{title:"\u547d\u540d\u7a7a\u95f4",key:"namespace",render:function(e,t){return i.a.createElement("span",null,t.metadata.namespace)}},{title:"\u6807\u7b7e",key:"labels",render:function(e,t){var a=[];for(var n in t.metadata.labels)a.push(i.a.createElement("div",{key:n},i.a.createElement(ca.a,{color:"geekblue"},n+":"+t.metadata.labels[n])));return a}},{title:"\u5bb9\u5668\u7ec4",key:"replicas",render:function(e,t){var a=" - ";return t.status.hasOwnProperty("readyReplicas")&&(a=t.status.readyReplicas),a+" / "+t.status.replicas}},{title:"\u521b\u5efa\u65f6\u95f4",key:"create_time",render:function(e,t){return we()(t.metadata.creationTimestamp).format("YYYY-MM-DD")}},{title:"\u955c\u50cf",key:"image",render:function(e,t){for(var a=t.spec.template.spec.containers,n=[],r=0;r<a.length;r++)n.push(i.a.createElement("div",{key:r},i.a.createElement(ca.a,{color:"geekblue"},a[r].image)));return n}},{title:"\u64cd\u4f5c",key:"action",fixed:"right",render:function(e,t){var n=i.a.createElement(C.a,null,i.a.createElement(C.a.Item,{key:"0"},i.a.createElement(me.a,{type:"link",onClick:a.autoScaleHandler.bind(Object(g.a)(a),"rc",t)}," ","\u4f38\u7f29")),i.a.createElement(C.a.Item,{key:"1"},i.a.createElement(me.a,{type:"link",onClick:a.deleteHandler.bind(Object(g.a)(a),"rc",t)},"\u5220\u9664")),i.a.createElement(C.a.Item,{key:"2"},i.a.createElement(me.a,{type:"link",onClick:a.showYamlHandler.bind(Object(g.a)(a),"rc",t)},"\u67e5\u770byaml\u6587\u4ef6")));return i.a.createElement(I.a,{overlay:n,trigger:["click"]},i.a.createElement(me.a,{type:"link",className:"ant-dropdown-link"},"\u8d44\u6e90\u64cd\u4f5c ",i.a.createElement(Cn.a,{type:"down"})))}}],rsColumns:[Object(fe.a)({title:"\u540d\u79f0",key:"name"},a.getColumnSearchProps("name"),{render:function(e,t){var n=i.a.createElement(tt,null);return(void 0===t.status.readyReplicas||t.status.readyReplicas<t.status.replicas)&&(n=i.a.createElement(at,null)),i.a.createElement("div",null,i.a.createElement("span",{style:{position:"relative",top:"5px"}},n),i.a.createElement(me.a,{type:"link",onClick:a.showDetail.bind(Object(g.a)(a),"rs",t)},t.metadata.name))}}),{title:"\u547d\u540d\u7a7a\u95f4",key:"namespace",render:function(e,t){return i.a.createElement("span",null,t.metadata.namespace)}},{title:"\u6807\u7b7e",key:"labels",render:function(e,t){var a=[];for(var n in t.metadata.labels)a.push(i.a.createElement("div",{key:n},i.a.createElement(ca.a,{color:"geekblue"},n+":"+t.metadata.labels[n])));return a}},{title:"\u5bb9\u5668\u7ec4",key:"replicas",render:function(e,t){var a=" - ";return t.status.hasOwnProperty("readyReplicas")&&(a=t.status.readyReplicas),a+" / "+t.status.replicas}},{title:"\u521b\u5efa\u65f6\u95f4",key:"create_time",render:function(e,t){return we()(t.metadata.creationTimestamp).format("YYYY-MM-DD")}},{title:"\u955c\u50cf",key:"image",render:function(e,t){for(var a=t.spec.template.spec.containers,n=[],r=0;r<a.length;r++)n.push(i.a.createElement("div",{key:r},i.a.createElement(ca.a,{color:"geekblue"},a[r].image)));return n}},{title:"\u64cd\u4f5c",key:"action",fixed:"right",render:function(e,t){var n=i.a.createElement(C.a,null,i.a.createElement(C.a.Item,{key:"0"},i.a.createElement(me.a,{type:"link",onClick:a.autoScaleHandler.bind(Object(g.a)(a),"rs",t)},"\u4f38\u7f29")),i.a.createElement(C.a.Item,{key:"1"},i.a.createElement(me.a,{type:"link",onClick:a.deleteHandler.bind(Object(g.a)(a),"rs",t)},"\u5220\u9664")),i.a.createElement(C.a.Item,{key:"2"},i.a.createElement(me.a,{type:"link",onClick:a.showYamlHandler.bind(Object(g.a)(a),"rs",t)},"\u67e5\u770byaml\u6587\u4ef6")));return i.a.createElement(I.a,{overlay:n,trigger:["click"]},i.a.createElement(me.a,{type:"link",className:"ant-dropdown-link"},"\u8d44\u6e90\u64cd\u4f5c ",i.a.createElement(Cn.a,{type:"down"})))}}],serviceColumns:[Object(fe.a)({title:"\u540d\u79f0",key:"name"},a.getColumnSearchProps("name"),{render:function(e,t){return i.a.createElement(me.a,{type:"link",onClick:a.showDetail.bind(Object(g.a)(a),"service",t)},t.metadata.name)}}),{title:"\u547d\u540d\u7a7a\u95f4",key:"namespace",render:function(e,t){return i.a.createElement("span",null,t.metadata.namespace)}},{title:"\u6807\u7b7e",key:"labels",render:function(e,t){var a=[];for(var n in t.metadata.labels)a.push(i.a.createElement("div",{key:n},i.a.createElement(ca.a,{color:"geekblue"},n+":"+t.metadata.labels[n])));return a}},{title:"\u96c6\u7fa4IP",key:"replicas",render:function(e,t){return t.spec.clusterIP}},{title:"\u5185\u90e8\u7aef\u70b9",key:"image",render:function(e,t){for(var a=t.spec.ports,n=[],r=0;r<a.length;r++)n.push(i.a.createElement("div",{key:r},i.a.createElement(ca.a,{color:"geekblue"},t.metadata.name+"."+t.metadata.namespace+":"+a[r].port+" "+a[r].protocol)));return n}},{title:"\u521b\u5efa\u65f6\u95f4",key:"create_time",render:function(e,t){return we()(t.metadata.creationTimestamp).format("YYYY-MM-DD")}},{title:"\u64cd\u4f5c",key:"action",fixed:"right",render:function(e,t){var n=i.a.createElement(C.a,null,i.a.createElement(C.a.Item,{key:"0"},i.a.createElement(me.a,{type:"link",onClick:a.deleteHandler.bind(Object(g.a)(a),"service",t)},"\u5220\u9664")),i.a.createElement(C.a.Item,{key:"1"},i.a.createElement(me.a,{type:"link",onClick:a.showYamlHandler.bind(Object(g.a)(a),"service",t)},"\u67e5\u770byaml\u6587\u4ef6")));return i.a.createElement(I.a,{overlay:n,trigger:["click"]},i.a.createElement(me.a,{className:"ant-dropdown-link",type:"link"},"\u8d44\u6e90\u64cd\u4f5c ",i.a.createElement(Cn.a,{type:"down"})))}}],ingressColumns:[Object(fe.a)({title:"\u540d\u79f0",key:"name"},a.getColumnSearchProps("name"),{render:function(e,t){return i.a.createElement(me.a,{type:"link",onClick:a.showDetail.bind(Object(g.a)(a),"ingress",t)},t.metadata.name)}}),{title:"\u547d\u540d\u7a7a\u95f4",key:"namespace",render:function(e,t){return i.a.createElement("span",null,t.metadata.namespace)}},{title:"\u57df\u540d",key:"domain",render:function(e,t){var a=t.spec.rules.map(function(e,t){return i.a.createElement("span",null,e.host,i.a.createElement("br",null))});return i.a.createElement("span",null,a)}},{title:"\u8bc1\u4e66",key:"cert",render:function(e,t){var a=t.spec.tls.map(function(e,t){return i.a.createElement("span",null,e.secretName,i.a.createElement("br",null))});return i.a.createElement("span",null,a)}},{title:"\u521b\u5efa\u65f6\u95f4",key:"create_time",render:function(e,t){return we()(t.metadata.creationTimestamp).format("YYYY-MM-DD")}},{title:"\u64cd\u4f5c",key:"action",fixed:"right",render:function(e,t){var n=i.a.createElement(C.a,null,i.a.createElement(C.a.Item,{key:"1"},i.a.createElement(me.a,{type:"link",onClick:a.deleteHandler.bind(Object(g.a)(a),"ingress",t)},"\u5220\u9664")),i.a.createElement(C.a.Item,{key:"2"},i.a.createElement(me.a,{type:"link",onClick:a.showYamlHandler.bind(Object(g.a)(a),"ingress",t)},"\u67e5\u770byaml\u6587\u4ef6")));return i.a.createElement(I.a,{overlay:n,trigger:["click"]},i.a.createElement(me.a,{className:"ant-dropdown-link",type:"link"},"\u8d44\u6e90\u64cd\u4f5c ",i.a.createElement(Cn.a,{type:"down"})))}}],deploymentColumns:[Object(fe.a)({title:"\u540d\u79f0",key:"name"},a.getColumnSearchProps("name"),{render:function(e,t){var n=i.a.createElement(tt,null);return(void 0===t.status.readyReplicas||t.status.readyReplicas<t.status.replicas)&&(n=i.a.createElement(at,null)),i.a.createElement("div",null,i.a.createElement("span",{style:{position:"relative",top:"5px"}},n),i.a.createElement(me.a,{type:"link",onClick:a.showDetail.bind(Object(g.a)(a),"deployment",t)},t.metadata.name))}}),{title:"\u547d\u540d\u7a7a\u95f4",key:"namespace",render:function(e,t){return i.a.createElement("span",null,t.metadata.namespace)}},{title:"\u6807\u7b7e",key:"labels",render:function(e,t){var a=[];for(var n in t.metadata.labels)a.push(i.a.createElement("div",{key:n},i.a.createElement(ca.a,{color:"geekblue"},n+":"+t.metadata.labels[n])));return a}},{title:"\u5bb9\u5668\u7ec4",key:"replicas",render:function(e,t){var a=" - ";return t.status.hasOwnProperty("readyReplicas")&&(a=t.status.readyReplicas),a+" / "+t.status.replicas}},{title:"\u521b\u5efa\u65f6\u95f4",key:"create_time",render:function(e,t){return we()(t.metadata.creationTimestamp).format("YYYY-MM-DD")}},{title:"\u955c\u50cf",key:"image",render:function(e,t){for(var a=t.spec.template.spec.containers,n=[],r=0;r<a.length;r++)n.push(i.a.createElement("div",{key:r},i.a.createElement(ca.a,{color:"geekblue"},a[r].image)));return n}},{title:"\u64cd\u4f5c",key:"action",fixed:"right",render:function(e,t){var n=i.a.createElement(C.a,null,i.a.createElement(C.a.Item,{key:"0"},i.a.createElement(me.a,{type:"link",onClick:a.autoScaleHandler.bind(Object(g.a)(a),"deployment",t)},"\u4f38\u7f29")),i.a.createElement(C.a.Item,{key:"1"},i.a.createElement(me.a,{type:"link",onClick:a.deleteHandler.bind(Object(g.a)(a),"deployment",t)},"\u5220\u9664")),i.a.createElement(C.a.Item,{key:"2"},i.a.createElement(me.a,{type:"link",onClick:a.showYamlHandler.bind(Object(g.a)(a),"deployment",t)},"\u67e5\u770byaml\u6587\u4ef6")));return i.a.createElement(I.a,{overlay:n,trigger:["click"]},i.a.createElement(me.a,{className:"ant-dropdown-link",type:"link"},"\u8d44\u6e90\u64cd\u4f5c ",i.a.createElement(Cn.a,{type:"down"})))}}],podColumns:[Object(fe.a)({title:"\u540d\u79f0",key:"name"},a.getColumnSearchProps("name"),{render:function(e,t){return i.a.createElement(me.a,{type:"link",onClick:a.showDetail.bind(Object(g.a)(a),"pod",t)},t.metadata.name)}}),{title:"\u547d\u540d\u7a7a\u95f4",key:"namespace",render:function(e,t){return i.a.createElement("span",null,t.metadata.namespace)}},{title:"\u8282\u70b9",key:"labels",render:function(e,t){return i.a.createElement("span",null,t.spec.nodeName)}},{title:"\u72b6\u6001",key:"status",dataIndex:"",render:function(e,t){var a=t.status.phase,n=i.a.createElement(ca.a,{color:"#87d068"},a);return"Failed"===a&&(n=i.a.createElement(ca.a,{color:"#f50"},a)),"Pending"===a&&(n=i.a.createElement(ca.a,{color:"#108ee9"},a)),n}},{title:"\u91cd\u542f\u6b21\u6570",key:"count",render:function(e,t){if("Failed"===t.status.phase)return"0";for(var a=t.status.containerStatuses,n=[],r=0;r<a.length;r++)n.push(i.a.createElement("div",{key:r},i.a.createElement(ca.a,{color:"geekblue"},a[r].name+" - "+a[r].restartCount)));return n}},{title:"\u521b\u5efa\u65f6\u95f4",key:"create_time",render:function(e,t){return we()(t.metadata.creationTimestamp).format("YYYY-MM-DD")}},{title:"\u64cd\u4f5c",key:"action",fixed:"right",render:function(e,t){var n=i.a.createElement(C.a,null,i.a.createElement(C.a.Item,{key:"1"},i.a.createElement(me.a,{type:"link",onClick:a.deleteHandler.bind(Object(g.a)(a),"pod",t)},"\u5220\u9664")),i.a.createElement(C.a.Item,{key:"2"},i.a.createElement(me.a,{type:"link",onClick:a.showYamlHandler.bind(Object(g.a)(a),"pod",t)},"\u67e5\u770byaml\u6587\u4ef6")));return i.a.createElement(I.a,{overlay:n,trigger:["click"]},i.a.createElement(me.a,{className:"ant-dropdown-link",type:"link"},"\u8d44\u6e90\u64cd\u4f5c ",i.a.createElement(Cn.a,{type:"down"})))}}],configDictColumns:[Object(fe.a)({title:"\u540d\u79f0",key:"name"},a.getColumnSearchProps("name"),{render:function(e,t){return i.a.createElement("span",null,t.metadata.name)}}),{title:"\u547d\u540d\u7a7a\u95f4",key:"namespace",render:function(e,t){return i.a.createElement("span",null,t.metadata.namespace)}},{title:"\u521b\u5efa\u65f6\u95f4",key:"creationTimestamp",render:function(e,t){return i.a.createElement("span",null,we()(t.metadata.creationTimestamp).format("YYYY-MM-DD"))}},{title:"\u64cd\u4f5c",key:"data",fixed:"right",render:function(e,t){return i.a.createElement("div",null,i.a.createElement(me.a,{type:"link",onClick:a.showDictValue.bind(Object(g.a)(a),t)},"\u67e5\u770b"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{type:"link",onClick:a.deleteDictValue.bind(Object(g.a)(a),"config_map",t)},"\u5220\u9664"))}}],secretDictColumns:[Object(fe.a)({title:"\u540d\u79f0",key:"name"},a.getColumnSearchProps("name"),{render:function(e,t){return i.a.createElement("span",null,t.metadata.name)}}),{title:"\u547d\u540d\u7a7a\u95f4",key:"namespace",render:function(e,t){return i.a.createElement("span",null,t.metadata.namespace)}},{title:"\u7c7b\u578b",dataIndex:"type",key:"type"},{title:"\u521b\u5efa\u65f6\u95f4",key:"creationTimestamp",render:function(e,t){return i.a.createElement("span",null,we()(t.metadata.creationTimestamp).format("YYYY-MM-DD"))}},{title:"\u64cd\u4f5c",key:"data",fixed:"right",render:function(e,t){return i.a.createElement("div",null,i.a.createElement(me.a,{type:"link",onClick:a.showDictValue.bind(Object(g.a)(a),t)},"\u67e5\u770b"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(me.a,{type:"link",onClick:a.deleteDictValue.bind(Object(g.a)(a),"secret",t)},"\u5220\u9664"))}}],namespaceList:[],replicationControllerList:[],deploymentList:[],replicaSetList:[],serviceList:[],ingressList:[],podList:[],nodeList:[],configDictList:[],secretDictList:[],dictConfigValue:{},refreshDataLoading:!1,detailDrawerVisible:!1,yamlModalVisible:!1,scaleModalVisible:!1,configModalVisible:!1,yamlDetail:"",currentNamespace:"default",yamlCode:"",replicaCount:0,scaleResType:"",scaleResData:{spec:{replicas:0}}},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.getK8sNamespaces(),this.refreshNamespaceResources(),this.getK8sNodes()}},{key:"selectChange",value:function(e){var t=this;this.setState({currentNamespace:e},function(){t.refreshNamespaceResources()})}},{key:"getK8sNamespaces",value:function(){var e,t=this;z("/kubernetes/namespaces",e).then(function(e){0===e.code?t.setState({namespaceList:e.data.items}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"getK8sNodes",value:function(){var e,t=this;z("/kubernetes/nodes",e).then(function(e){0===e.code?t.setState({nodeList:e.data.items}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"refreshNamespaceResources",value:function(){this.getNamespaceDeployments(),this.getNamespaceReplicationControllers(),this.getNamespaceReplicaSets(),this.getNamespaceServices(),this.getNamespaceIngress(),this.getNamespacePods(),this.getNamespaceConfigDict(),this.getNamespaceSecretDict(),this.showLoading()}},{key:"getNamespaceDeployments",value:function(){var e,t=this;(e={namespace:this.state.currentNamespace},z("/kubernetes/deployments",e)).then(function(e){0===e.code?t.setState({deploymentList:e.data.items}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"getNamespaceReplicationControllers",value:function(){var e,t=this;(e={namespace:this.state.currentNamespace},z("/kubernetes/replication_controllers",e)).then(function(e){0===e.code?t.setState({replicationControllerList:e.data.items}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"getNamespaceReplicaSets",value:function(){var e,t=this;(e={namespace:this.state.currentNamespace},z("/kubernetes/replica_sets",e)).then(function(e){0===e.code?t.setState({replicaSetList:e.data.items}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"getNamespaceServices",value:function(){var e,t=this;(e={namespace:this.state.currentNamespace},z("/kubernetes/services",e)).then(function(e){0===e.code?t.setState({serviceList:e.data.items}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"getNamespacePods",value:function(){var e,t=this;(e={namespace:this.state.currentNamespace},z("/kubernetes/pods",e)).then(function(e){0===e.code?t.setState({podList:e.data.items}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"getNamespaceIngress",value:function(){var e,t=this;(e={namespace:this.state.currentNamespace},z("/kubernetes/ingress",e)).then(function(e){0===e.code?t.setState({ingressList:e.data.items}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"getNamespaceConfigDict",value:function(){var e,t=this;(e={namespace:this.state.currentNamespace},z("/kubernetes/config_dict",e)).then(function(e){0===e.code?t.setState({configDictList:e.data.items}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"getNamespaceSecretDict",value:function(){var e,t=this;(e={namespace:this.state.currentNamespace},z("/kubernetes/secret_dict",e)).then(function(e){0===e.code?t.setState({secretDictList:e.data.items}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"showDictValue",value:function(e){this.setState({configModalVisible:!0,dictConfigValue:e.data})}},{key:"deleteDictValue",value:function(e,t){var a=this;switch(e){case"config_map":(function(e){return B("/kubernetes/config_map",e)})({namespace:this.state.currentNamespace,resName:t.metadata.name}).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),a.refreshNamespaceResources()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())});break;case"secret":(function(e){return B("/kubernetes/secret",e)})({namespace:this.state.currentNamespace,resName:t.metadata.name}).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),a.refreshNamespaceResources()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())});break;default:D.b.warn("\u4e0d\u652f\u6301\u7684\u7c7b\u578b")}}},{key:"handleConfigCancel",value:function(){this.setState({configModalVisible:!1})}},{key:"yarmCreateK8sResource",value:function(){this.setState({createModalVisible:!0})}},{key:"handleOk",value:function(){var e,t=this;""!==this.state.yamlCode.trim()?(e={namespace:this.state.currentNamespace,yamlContent:this.state.yamlCode},P("/kubernetes/yaml_resource",e)).then(function(e){0===e.code?(t.setState({createModalVisible:!1}),D.b.success("\u63d0\u4ea4\u6210\u529f\uff0c\u8bf7\u5230\u5bf9\u5e94\u8d44\u6e90\u680f\u67e5\u770b\u8be6\u60c5"),t.refreshNamespaceResources()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())}):D.b.warn("\u9700\u8981\u586b\u5199\u6587\u4ef6\u5185\u5bb9\uff01")}},{key:"handleCancel",value:function(){this.setState({createModalVisible:!1})}},{key:"selectTemplateChange",value:function(e){this.setState({yamlCode:_n[e]})}},{key:"showDetail",value:function(e,t){switch(this.setState({detailDrawerVisible:!0}),e){case"node":this.props.history.push({pathname:"/admin/k8s_cluster/manage/node_detail",state:{data:t}});break;case"rc":this.props.history.push({pathname:"/admin/k8s_cluster/manage/rc_detail",state:{data:t}});break;case"rs":this.props.history.push({pathname:"/admin/k8s_cluster/manage/rs_detail",state:{data:t}});break;case"deployment":this.props.history.push({pathname:"/admin/k8s_cluster/manage/deployment_detail",state:{data:t}});break;case"service":this.props.history.push({pathname:"/admin/k8s_cluster/manage/service_detail",state:{data:t}});break;case"ingress":this.props.history.push({pathname:"/admin/k8s_cluster/manage/ingress_detail",state:{data:t}});break;case"pod":this.props.history.push({pathname:"/admin/k8s_cluster/manage/pod_detail",state:{data:t}});break;default:D.b.error("\u4e0d\u652f\u6301\u7684\u7c7b\u578b\uff1a"+e)}}},{key:"onDrawerClose",value:function(){this.setState({detailDrawerVisible:!1})}},{key:"autoScaleHandler",value:function(e,t){this.setState({scaleModalVisible:!0,scaleResType:e,scaleResData:t})}},{key:"deleteHandler",value:function(e,t){var a=this;ur({title:"\u64cd\u4f5c\u8b66\u544a?",content:"\u786e\u5b9a\u5220\u9664\u8be5 kubernetes \u8d44\u6e90\u5417\uff1f",icon:i.a.createElement(Cn.a,{type:"warning"}),onOk:function(){(function(e){return B("/kubernetes/resource",e)})({namespace:t.metadata.namespace,resType:e,resName:t.metadata.name}).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),a.showLoading()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})},onCancel:function(){console.log("Cancel")}})}},{key:"showYamlHandler",value:function(e,t){var a,n=this;this.setState({yamlModalVisible:!0}),(a={namespace:t.metadata.namespace,resType:e,resName:t.metadata.name},z("/kubernetes/yaml",a)).then(function(e){0===e.code?n.setState({yamlDetail:e.data}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleYamlDetailCancel",value:function(){this.setState({yamlModalVisible:!1})}},{key:"handleScaleCancel",value:function(){this.setState({scaleModalVisible:!1})}},{key:"handleScaleCommit",value:function(){var e,t=this;(e={namespace:this.state.scaleResData.metadata.namespace,resType:this.state.scaleResType,resName:this.state.scaleResData.metadata.name,replicaCount:this.state.replicaCount},V("/kubernetes/scale",e)).then(function(e){if(0===e.code)switch(t.setState({scaleModalVisible:!1}),D.b.success("\u63d0\u4ea4\u6210\u529f"),t.showLoading(),t.state.scaleResType){case"rc":t.getNamespaceReplicationControllers()}else D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"onInputNumberChange",value:function(e){this.setState({replicaCount:e})}},{key:"render",value:function(){var e=this,t="\u65b0\u5efa\u8d44\u6e90 - "+this.state.currentNamespace,a=i.a.createElement("div",null,"\u586b\u5165 YAML \u6587\u4ef6\u5185\u5bb9\uff0c\u5c06\u6307\u5b9a\u8d44\u6e90\u90e8\u7f72\u5230\u5f53\u524d\u6240\u9009\u547d\u540d\u7a7a\u95f4\u3002",i.a.createElement(pe.a,{title:i.a.createElement("div",null,"\u66f4\u591a\u914d\u7f6e\u4fe1\u606f\u8bf7\u67e5\u770b:"," ",i.a.createElement("a",{href:"https://kubernetes.io/docs/home/",target:"_blank",rel:"noopener noreferrer"},"\u5b98\u65b9\u6587\u6863"))},i.a.createElement(Cn.a,{type:"question-circle"}))),n=[];for(var r in this.state.dictConfigValue)n.push(i.a.createElement(dr,{header:r,key:r,style:mr},i.a.createElement(An.Controlled,{value:this.state.dictConfigValue[r]})));return i.a.createElement(or,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["Kubernetes","\u96c6\u7fa4\u7ba1\u7406"]}),i.a.createElement(oe.a,null,i.a.createElement("span",{style:{lineHeight:"30px",fontWeight:"500",marginRight:"20px"}},"\u547d\u540d\u7a7a\u95f4:"," "),i.a.createElement(ye.a,{defaultValue:"default",style:{width:"200px",marginRight:"20px"},onChange:this.selectChange},this.state.namespaceList.map(function(e,t){var a=!1;return"Active"!==e.status.phase&&(a=!0),i.a.createElement(cr,{key:t,value:e.metadata.name,disabled:a},e.metadata.name)})),i.a.createElement(me.a,{onClick:this.refreshNamespaceResources,style:{marginRight:"20px"}},"\u5237 \u65b0"),i.a.createElement(me.a,{type:"primary",onClick:this.yarmCreateK8sResource},"\u65b0 \u5efa")),i.a.createElement(E.a,{title:t,destroyOnClose:!0,visible:this.state.createModalVisible,onOk:this.handleOk,onCancel:this.handleCancel,width:700,centered:!0},i.a.createElement(Yt.a,{message:a,banner:!0,style:{marginBottom:"10px",marginTop:"-20px"}}),i.a.createElement(oe.a,{style:{marginBottom:"10px"}},i.a.createElement(ce.a,{span:4},i.a.createElement("span",{style:{lineHeight:"30px",fontWeight:"500"}},"\u9009\u62e9\u8d44\u6e90\u6a21\u677f:"," ")),i.a.createElement(ce.a,{span:6,style:{marginRight:"20px"}},i.a.createElement(ye.a,{defaultValue:"",style:{width:"100%"},onChange:this.selectTemplateChange},i.a.createElement(cr,{key:"0",value:""},"\u65e0"),i.a.createElement(cr,{key:"1",value:"deployment"},"Deployment"),i.a.createElement(cr,{key:"2",value:"rc"},"ReplicationController"),i.a.createElement(cr,{key:"3",value:"rs"},"ReplicaSet"),i.a.createElement(cr,{key:"4",value:"statefull_rs"},"StatefulSets"),i.a.createElement(cr,{key:"5",value:"service"},"Service"),i.a.createElement(cr,{key:"6",value:"ingress"},"Ingress"),i.a.createElement(cr,{key:"7",value:"daemon_set"},"DaemonSet"),i.a.createElement(cr,{key:"8",value:"config_map"},"ConfigMap"),i.a.createElement(cr,{key:"9",value:"secret_map"},"Secret")))),i.a.createElement(An.Controlled,{value:this.state.yamlCode,options:{mode:"xml",theme:"material"},onBeforeChange:function(t,a,n){e.setState({yamlCode:n})}})),i.a.createElement(E.a,{title:"YAML\u8be6\u60c5",destroyOnClose:!0,visible:this.state.yamlModalVisible,onCancel:this.handleYamlDetailCancel,width:700,centered:!0,footer:[i.a.createElement(me.a,{onClick:this.handleYamlDetailCancel},"\u53d6\u6d88")]},i.a.createElement(An.Controlled,{value:this.state.yamlDetail,options:{mode:"xml",theme:"material"},onBeforeChange:function(t,a,n){e.setState({yamlDetail:n})}})),i.a.createElement(E.a,{title:"\u81ea\u52a8\u4f38\u7f29",destroyOnClose:!0,visible:this.state.scaleModalVisible,onCancel:this.handleScaleCancel,width:400,centered:!0,bodyStyle:{textAlign:"center"},footer:[i.a.createElement(me.a,{onClick:this.handleScaleCancel},"\u53d6\u6d88"),i.a.createElement(me.a,{type:"primary",onClick:this.handleScaleCommit},"\u786e\u5b9a")]},i.a.createElement(ge.a,{min:0,defaultValue:this.state.scaleResData.spec.replicas,onChange:this.onInputNumberChange,style:{width:"70%"}})),i.a.createElement(E.a,{title:"\u914d\u7f6e\u5b57\u5178\u503c",destroyOnClose:!0,visible:this.state.configModalVisible,onCancel:this.handleConfigCancel,width:600,footer:[]},i.a.createElement(Tn.a,{bordered:!1},n)),i.a.createElement(re.a,{placement:"left",closable:!0,destroyOnClose:!0,onClose:this.onDrawerClose,visible:this.state.detailDrawerVisible,width:"70%"},i.a.createElement(p.a,null,i.a.createElement(f.a,{path:"/admin/k8s_cluster/manage/node_detail",component:$n}),i.a.createElement(f.a,{path:"/admin/k8s_cluster/manage/rc_detail",component:Nn}),i.a.createElement(f.a,{path:"/admin/k8s_cluster/manage/rs_detail",component:er}),i.a.createElement(f.a,{path:"/admin/k8s_cluster/manage/deployment_detail",component:ar}),i.a.createElement(f.a,{path:"/admin/k8s_cluster/manage/service_detail",component:Pn}),i.a.createElement(f.a,{path:"/admin/k8s_cluster/manage/ingress_detail",component:rr}),i.a.createElement(f.a,{path:"/admin/k8s_cluster/manage/pod_detail",component:Un}),i.a.createElement(f.a,{path:"/admin/k8s_cluster/manage/container_log",component:Gn}),i.a.createElement(f.a,{path:"/admin/k8s_cluster/manage/container_terminal",component:Hn}))),i.a.createElement(oe.a,{style:{marginTop:"10px"}},i.a.createElement(Ft.a,{size:"small",title:"\u8d44\u6e90\u603b\u89c8",style:{width:"100%"}},i.a.createElement(le.a,{spinning:this.state.refreshDataLoading},i.a.createElement(Ee.a,{defaultActiveKey:"1",tabPosition:"left",size:"small",style:{width:"100%"},tabBarStyle:{textAlign:"left"}},i.a.createElement(sr,{tab:i.a.createElement("div",{style:{fontSize:"13px",width:"80px",textAlign:"left"}},"Node"),key:1},i.a.createElement(ne.a,{size:"small",columns:this.state.nodeColumns,dataSource:this.state.nodeList,scroll:{x:"max-content"}})),i.a.createElement(sr,{tab:i.a.createElement("div",{style:{fontSize:"13px",width:"80px",textAlign:"left"}},"ReplicaSet"),key:2},i.a.createElement(ne.a,{size:"small",columns:this.state.rsColumns,dataSource:this.state.replicaSetList,scroll:{x:"max-content"}})),i.a.createElement(sr,{tab:i.a.createElement("div",{style:{fontSize:"13px",width:"80px",textAlign:"left"}},"Deployment"),key:3},i.a.createElement(ne.a,{size:"small",columns:this.state.deploymentColumns,dataSource:this.state.deploymentList,scroll:{x:"max-content"}})),i.a.createElement(sr,{tab:i.a.createElement("div",{style:{fontSize:"13px",width:"80px",textAlign:"left"}},"RC"),key:4},i.a.createElement(ne.a,{size:"small",columns:this.state.rcColumns,dataSource:this.state.replicationControllerList,scroll:{x:"max-content"}})),i.a.createElement(sr,{tab:i.a.createElement("div",{style:{fontSize:"13px",width:"80px",textAlign:"left"}},"Service"),key:5},i.a.createElement(ne.a,{size:"small",columns:this.state.serviceColumns,dataSource:this.state.serviceList,scroll:{x:"max-content"}})),i.a.createElement(sr,{tab:i.a.createElement("div",{style:{fontSize:"13px",width:"80px",textAlign:"left"}},"Ingress"),key:6},i.a.createElement(ne.a,{size:"small",columns:this.state.ingressColumns,dataSource:this.state.ingressList,scroll:{x:"max-content"}})),i.a.createElement(sr,{tab:i.a.createElement("div",{style:{fontSize:"13px",width:"80px",textAlign:"left"}},"Pod"),key:7},i.a.createElement(ne.a,{size:"small",columns:this.state.podColumns,dataSource:this.state.podList,scroll:{x:"max-content"}})),i.a.createElement(sr,{tab:i.a.createElement("div",{style:{fontSize:"13px",width:"80px",textAlign:"left"}},"ConfigMap"),key:8},i.a.createElement(ne.a,{size:"small",columns:this.state.configDictColumns,dataSource:this.state.configDictList,scroll:{x:"max-content"}})),i.a.createElement(sr,{tab:i.a.createElement("div",{style:{fontSize:"13px",width:"80px",textAlign:"left"}},"Secret"),key:9},i.a.createElement(ne.a,{size:"small",columns:this.state.secretDictColumns,dataSource:this.state.secretDictList,scroll:{x:"max-content"}})))))))}}]),t}(r.Component),pr=(a(232),a(162)),fr=b.a.Content,br=ye.a.Option,gr=i.a.createElement(ye.a,{defaultValue:"http://",className:"select-before"},i.a.createElement(br,{value:"http://"},"http://"),i.a.createElement(br,{value:"https://"},"https://")),yr=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).addCluster=a.addCluster.bind(Object(g.a)(a)),a.handleClusterAddOk=a.handleClusterAddOk.bind(Object(g.a)(a)),a.handleClusterAddCancel=a.handleClusterAddCancel.bind(Object(g.a)(a)),a.loadClusterData=a.loadClusterData.bind(Object(g.a)(a)),a.formRef=i.a.createRef(),a.state={addModelVisible:!1,clusterData:[]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.loadClusterData()}},{key:"enterToCluster",value:function(e){var t=this;D.b.loading("\u96c6\u7fa4\u8fde\u63a5\u521d\u59cb\u5316\u4e2d\uff0c\u5373\u5c06\u8df3\u8f6c...",.6),localStorage.setItem("clusterId",e),setTimeout(function(){t.props.history.push({pathname:"/admin/k8s_cluster/manage"})},600)}},{key:"loadClusterData",value:function(){var e,t=this;z("/kubernetes/cluster",e).then(function(e){0===e.code?t.setState({clusterData:e.data.k8sData}):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"addCluster",value:function(){this.setState({addModelVisible:!0})}},{key:"handleClusterAddOk",value:function(){var e=this;this.formRef.current.validateFields().then(function(t){var a;(a=t,P("/kubernetes/cluster",a)).then(function(t){0===t.code?(D.b.success("\u6dfb\u52a0\u6210\u529f"),e.setState({addModelVisible:!1}),e.loadClusterData()):D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})})}},{key:"handleClusterAddCancel",value:function(){this.setState({addModelVisible:!1})}},{key:"confirmDeleteCluster",value:function(e){var t,a=this;(t={id:e},B("/kubernetes/cluster",t)).then(function(e){0===e.code?(D.b.success("\u79fb\u9664\u6210\u529f"),a.loadClusterData()):D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"render",value:function(){var e=this,t={labelCol:{span:7},wrapperCol:{span:14}};return i.a.createElement(fr,{style:{background:"#fff",padding:"5px 20px",margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["Kubernetes","\u96c6\u7fa4\u4fe1\u606f"]}),i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:2},i.a.createElement(me.a,{type:"primary",onClick:this.addCluster,style:{width:"100%"}},"\u65b0\u589e\u96c6\u7fa4"))),i.a.createElement(oe.a,{style:{marginTop:"10px",width:"100%"}},0===this.state.clusterData.length?i.a.createElement(pr.a,{style:{width:"100%"},description:"\u6682\u672a\u6dfb\u52a0\u4efb\u4f55kubernetes\u96c6\u7fa4"}):i.a.createElement(In.b,{grid:{gutter:20,column:4},style:{width:"100%"},dataSource:this.state.clusterData,renderItem:function(t){return i.a.createElement(In.b.Item,null,i.a.createElement(Ft.a,{title:t.name,size:"small"},i.a.createElement("div",{style:{height:"50px",fontSize:"13px"}},t.description),i.a.createElement("div",{style:{marginTop:"10px"}},i.a.createElement(me.a,{type:"link",size:"small",style:{float:"left"},onClick:e.enterToCluster.bind(e,t.clusterId)},"\u8fdb\u5165\u96c6\u7fa4"),i.a.createElement(de.a,{title:"\u786e\u5b9a\u79fb\u9664\u8be5\u96c6\u7fa4\u5417?",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onConfirm:e.confirmDeleteCluster.bind(e,t.id)},i.a.createElement(me.a,{type:"link",size:"small",style:{color:"red",float:"right"}},"\u5220\u9664\u96c6\u7fa4")))))}})),i.a.createElement(E.a,{title:"\u65b0\u589e\u96c6\u7fa4\u4fe1\u606f",destroyOnClose:!0,visible:this.state.addModelVisible,onOk:this.handleClusterAddOk,onCancel:this.handleClusterAddCancel},i.a.createElement(S.a,{ref:this.formRef},i.a.createElement(S.a.Item,Object.assign({label:"\u96c6\u7fa4\u540d\u79f0"},t,{name:"name",rules:[{required:!0,message:"\u8be5\u9879\u4e3a\u5fc5\u586b\u9879"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"\u96c6\u7fa4\u63cf\u8ff0"},t,{name:"description",rules:[{required:!0,message:"\u8be5\u9879\u4e3a\u5fc5\u586b\u9879"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({label:"ApiServer"},t,{name:"apiServer",rules:[{required:!0,message:"\u8be5\u9879\u4e3a\u5fc5\u586b\u9879"}]}),i.a.createElement(O.a,{addonBefore:gr})),i.a.createElement(S.a.Item,Object.assign({label:"Admin Token"},t,{name:"token",rules:[{required:!0,message:"\u8be5\u9879\u4e3a\u5fc5\u586b\u9879"}]}),i.a.createElement(O.a,null)))))}}]),t}(r.Component),Er=b.a.Content,vr=function(e){function t(){return Object(o.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(Er,{style:{background:"#fff",padding:0,margin:0,height:"100%"}},i.a.createElement(p.a,null,i.a.createElement(f.a,{path:"/admin/k8s_cluster/info",component:yr}),i.a.createElement(f.a,{path:"/admin/k8s_cluster/manage",component:hr})))}}]),t}(r.Component),Sr=function(e){return P("dms/instance",e)},kr=function(e){return z("dms/databaseData",e)},Ir=function(e){return P("dms/auth",e)},Cr=function(e){return z("dms/userDatabaseData",e)},Dr=b.a.Content,Or=Z.a.Text,xr=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).changePage=function(e,t){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e,pageSize:t})},function(){a.loadInstanceData()})},a.handleQueryChange=function(e){a.setState({searchValue:e.target.value})},a.handleQuery=function(){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:1,current:1})},function(){a.loadInstanceData()})},a.handleAddInstanceCancel=function(){a.setState({addInstanceModalVisible:!1,editInstanseId:"",initialValues:{}})},a.handleSubmitAddInstance=function(){a.formRef.current.validateFields().then(function(e){Sr(Object(fe.a)({},e,{instanceId:a.state.editInstanseId})).then(function(e){0===e.code?(D.b.success("\u6dfb\u52a0\u6210\u529f!"),a.loadInstanceData()):D.b.error(e.msg),a.setState({addInstanceModalVisible:!1})}).catch(function(e){D.b.error(e.toLocaleString())}),a.setState({editInstanseId:"",initialValues:{}})})},a.onExpand=function(e,t){e&&kr({instanceId:t.InstanceId}).then(function(e){if(0===e.code){var n=a.state.expendTableData;n[t.InstanceId]=e.data,a.setState({expendTableData:n})}else D.b.error(e.msg)})},a.expandedRowRender=function(e,t,n,r){return i.a.createElement(ne.a,{style:{width:300},columns:a.state.expendColumns,dataSource:a.state.expendTableData[e.InstanceId],pagination:!1,size:"small",footer:function(){return i.a.createElement(me.a,{size:"small",onClick:a.addInstanceDb.bind(Object(g.a)(a),e.InstanceId)},"\u6dfb\u52a0")}})},a.onShowSizeChange=a.onShowSizeChange.bind(Object(g.a)(a)),a.formRef=i.a.createRef(),a.state={columns:[{title:"\u5b9e\u4f8b\u7c7b\u578b",dataIndex:"InstanceType",key:"InstanceType",align:"center",width:100,render:function(e,t){var a="Mysql";return 2===e&&(a="Mysql"),3===e&&(a="Sqlserver"),i.a.createElement(Or,{ellipsis:!0},a)}},{title:"\u5b9e\u4f8b\u540d\u79f0",dataIndex:"InstanceAlias",key:"InstanceAlias",align:"center",width:200,render:function(e){return i.a.createElement(Or,{ellipsis:!0,style:{width:"100%"}},e)}},{title:"\u5b9e\u4f8b\u5730\u5740",dataIndex:"Host",key:"Host",align:"center",width:150,render:function(e){return i.a.createElement(Or,{ellipsis:!0,style:{width:"100%"}},e)}},{title:"\u5b9e\u4f8b\u7aef\u53e3",dataIndex:"Port",key:"Port",align:"center",width:150,render:function(e){return i.a.createElement(Or,{ellipsis:!0,style:{width:"100%"}},e)}},{title:"\u6570\u636e\u5e93\u8d26\u53f7",dataIndex:"OperUser",key:"OperUser",align:"center",width:100,render:function(e){return i.a.createElement(Or,{ellipsis:!0,style:{width:"100%"}},e)}},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",align:"center",width:200,render:function(e,t){return i.a.createElement("div",null,i.a.createElement(me.a,{type:"info",size:"small",onClick:a.editInstance.bind(Object(g.a)(a),t)},"\u7f16\u8f91"),i.a.createElement(ue.a,{type:"vertical"}),i.a.createElement(de.a,{title:"\u786e\u5b9a\u5220\u9664\u8be5\u9879\u5185\u5bb9?",onConfirm:a.deleteInstance.bind(Object(g.a)(a),t),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(me.a,{type:"danger",size:"small"},"\u5220\u9664")))}}],expendColumns:[{title:"\u5e93\u540d\u79f0",dataIndex:"SchemaName",key:"SchemaName",width:100},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",align:"center",width:100,render:function(e,t){return i.a.createElement("div",null,i.a.createElement(de.a,{title:"\u786e\u5b9a\u5220\u9664\u8be5\u9879\u5185\u5bb9?",onConfirm:a.deleteInstanceDb.bind(Object(g.a)(a),t),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(me.a,{type:"danger",size:"small"},"\u5220\u9664")))}}],tableLoading:!1,addInstanceModalVisible:!1,tableData:[],pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:function(e,t){return a.onShowSizeChange(e,t)},showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e,t){return a.changePage(e,t)}},searchValue:"",initialValues:{},editInstanseId:"",addInstanceDbModalVisible:!1,addInstanceId:"",inputDbName:"",expendTableData:{}},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.loadInstanceData()}},{key:"onShowSizeChange",value:function(e,t){var a=this,n=Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t});this.setState({pagination:n},function(){a.loadInstanceData()})}},{key:"loadInstanceData",value:function(){var e=this;this.setState({tableLoading:!0});var t,a={page:this.state.pagination.page,pageSize:this.state.pagination.pageSize,query:this.state.searchValue};(t=a,z("dms/instances",t)).then(function(t){if(0===t.code){var a=e.state.pagination;a.total=parseInt(t.data.total),a.page=parseInt(t.data.page),a.showTotal(parseInt(t.data.total)),e.setState({pagination:a});for(var n=[],r=0;r<t.data.instanceData.length;r++)n.push(Object(fe.a)({key:t.data.instanceData[r].ID},t.data.instanceData[r]));e.setState({tableData:n,tableLoading:!1})}else D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleAddInstance",value:function(){this.setState({addInstanceModalVisible:!0,editInstanseId:"",initialValues:{}})}},{key:"addInstanceDb",value:function(e){this.setState({addInstanceId:e,addInstanceDbModalVisible:!0})}},{key:"dbNameChange",value:function(e){this.setState({inputDbName:e.target.value})}},{key:"handleSubmitAddInstanceDb",value:function(){var e,t=this;(e={instanceId:this.state.addInstanceId,dbName:this.state.inputDbName},P("dms/databaseData",e)).then(function(e){0===e.code?(D.b.success("\u6dfb\u52a0\u6210\u529f"),t.onExpand(!0,{InstanceId:t.state.addInstanceId}),t.setState({addInstanceDbModalVisible:!1})):D.b.error(e.msg)})}},{key:"handleAddInstanceDbCancel",value:function(){this.setState({inputDbName:"",addInstanceId:"",addInstanceDbModalVisible:!1})}},{key:"editInstance",value:function(e){this.setState({addInstanceModalVisible:!0,editInstanseId:e.InstanceId,initialValues:{instanceType:e.InstanceType,instanceAlias:e.InstanceAlias,port:e.Port,host:e.Host,operUser:e.OperUser,operPwd:e.OperPwd}})}},{key:"deleteInstance",value:function(e){var t,a=this;(t={instanceId:e.InstanceId},B("dms/instance",t)).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),a.loadInstanceData()):D.b.error(e.msg)})}},{key:"deleteInstanceDb",value:function(e){var t,a=this;(t={instanceId:e.InstanceId,databaseId:e.DatabaseId},B("dms/databaseData",t)).then(function(t){0===t.code?(D.b.success("\u5220\u9664\u6210\u529f"),a.onExpand(!0,e)):D.b.error(t.msg)})}},{key:"render",value:function(){var e={labelCol:{span:6},wrapperCol:{span:17}};return i.a.createElement(Dr,{style:{background:"#fff",padding:20,margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["DMS","\u5b9e\u4f8b\u7ba1\u7406"]}),i.a.createElement(oe.a,{style:{padding:"0px 0px 10px 0px"}},i.a.createElement(ce.a,{span:5,className:"col-span"},i.a.createElement(O.a,{placeholder:"\u8bf7\u8f93\u5165\u5b9e\u4f8b\u540d\u79f0\u5173\u952e\u5b57",style:{width:"100%"},onChange:this.handleQueryChange})),i.a.createElement(ce.a,{span:2,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},type:"primary",icon:i.a.createElement(ke.a,null),onClick:this.handleQuery},"\u67e5 \u8be2")),i.a.createElement(ce.a,{span:3,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},icon:i.a.createElement(Ie.a,null),onClick:this.handleAddInstance.bind(this)},"\u6dfb\u52a0\u5b9e\u4f8b"))),i.a.createElement(E.a,{title:"\u6dfb\u52a0\u5b9e\u4f8b\u4fe1\u606f",visible:this.state.addInstanceModalVisible,destroyOnClose:!0,width:700,onOk:this.handleSubmitAddInstance,onCancel:this.handleAddInstanceCancel},i.a.createElement(S.a,{ref:this.formRef,initialValues:this.state.initialValues},i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u7c7b\u578b\uff1a",name:"instanceType",rules:[{required:!0,message:"\u8bf7\u8bbe\u7f6e\u6570\u636e\u5e93\u5b9e\u4f8b\u7c7b\u578b!"}]}),i.a.createElement(se.a.Group,null,i.a.createElement(se.a,{value:"2"},"Mysql"),i.a.createElement(se.a,{value:"3"},"Sqlserver"))),i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u5b9e\u4f8b\u540d\u79f0\uff1a",name:"instanceAlias",rules:[{required:!0,message:"\u8bf7\u8bbe\u7f6e\u6570\u636e\u5e93\u5b9e\u4f8b\u540d\u79f0!"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u5b9e\u4f8b\u5730\u5740\uff1a",name:"host",rules:[{required:!0,message:"\u8bf7\u8bbe\u7f6e\u6570\u636e\u5e93\u5b9e\u4f8b\u5730\u5740!"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u5b9e\u4f8b\u7aef\u53e3\uff1a",name:"port",rules:[{required:!0,message:"\u8bf7\u8bbe\u7f6e\u6570\u636e\u5e93\u5b9e\u4f8b\u7aef\u53e3!"}]}),i.a.createElement(ge.a,{min:1})),i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u6570\u636e\u5e93\u8d26\u53f7\uff1a",name:"operUser",rules:[{required:!0,message:"\u8bf7\u8bbe\u7f6e\u6570\u636e\u5e93\u5b9e\u4f8b\u8d26\u53f7!"}]}),i.a.createElement(O.a,null)),i.a.createElement(S.a.Item,Object.assign({},e,{label:"\u6570\u636e\u5e93\u5bc6\u7801\uff1a",name:"operPwd",rules:[{required:!0,message:"\u8bf7\u8bbe\u7f6e\u6570\u636e\u5e93\u5b9e\u4f8b\u5bc6\u7801!"}]}),i.a.createElement(O.a.Password,{iconRender:function(e){return e?i.a.createElement(ve.a,null):i.a.createElement(Se.a,null)}})))),i.a.createElement(E.a,{title:"\u6dfb\u52a0\u5e93\u540d",visible:this.state.addInstanceDbModalVisible,destroyOnClose:!0,width:300,onOk:this.handleSubmitAddInstanceDb.bind(this),onCancel:this.handleAddInstanceDbCancel.bind(this)},i.a.createElement(O.a,{placeholder:"\u8f93\u5165\u5e93\u540d",onChange:this.dbNameChange.bind(this)})),i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,bordered:!0,size:"small",expandable:{onExpand:this.onExpand,expandedRowRender:this.expandedRowRender}}))}}]),t}(r.Component),wr=a(404),jr=(a(586),a(329)),Tr=b.a.Content,Lr=Z.a.Text,Mr=ye.a.Option,Ar=jr.a.TreeNode,_r=O.a.TextArea,Rr=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).changePage=function(e,t){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e,pageSize:t})},function(){a.getUserAuthData()})},a.handleInstanceChange=function(e){a.setState({queryInstanceId:e})},a.handleEmpIdChange=function(e){a.setState({queryEmpId:e})},a.handleOperTypeChange=function(e){a.setState({queryOperType:e})},a.handleQuery=function(){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:1,current:1})},function(){a.getUserAuthData()})},a.handleUserAuthCancel=function(){a.setState({addAuthModalVisible:!1})},a.handleSubmitUserAuth=function(){a.formRef.current.validateFields().then(function(e){if(""!==a.state.selectedNodeId&&""!==a.state.selectedNodeType){var t=Object(fe.a)({},e,{validTime:e.validTime.format("YYYY-MM-DD HH:mm:ss"),selectedNodeId:a.state.selectedNodeId,selectedNodeType:a.state.selectedNodeType});Ir(t).then(function(e){0===e.code?(D.b.success("\u6dfb\u52a0\u6210\u529f!"),a.getUserAuthData()):D.b.error(e.msg),a.setState({addAuthModalVisible:!1})}).catch(function(e){D.b.error(e.toLocaleString())})}else D.b.warn("\u8bf7\u9009\u62e9\u5177\u4f53\u7684\u6570\u636e\u8868\uff01")})},a.onLoadData=function(e){return new Promise(function(t){e.props.children?t():"instance"===e.props.dataRef.type&&kr({instanceId:e.props.dataRef.key}).then(function(n){if(0===n.code){for(var r=[],i=0;i<n.data.length;i++)r.push({title:n.data[i].SchemaName,key:n.data[i].DatabaseId,type:"database",instance_type:n.data[i].InstanceType,isLeaf:!0});e.props.dataRef.children=r,a.setState({treeData:Object(wr.a)(a.state.treeData)}),t()}else D.b.error(n.msg)}).catch(function(e){D.b.error(e.toLocaleString())})})},a.renderTreeNodes=function(e){return e.map(function(e){var t="icondatabase";return"mysql"===e.instance_type&&(t="iconmysql"),"sqlserver"===e.instance_type&&(t="iconsqlserver"),e.children?i.a.createElement(Ar,{icon:i.a.createElement(rt,{style:{fontSize:"20px",color:"#08c"},type:t}),title:e.title,key:e.key,dataRef:e},a.renderTreeNodes(e.children)):i.a.createElement(Ar,Object.assign({icon:i.a.createElement(rt,{style:{fontSize:"20px",color:"#08c"},type:t}),key:e.key},e,{dataRef:e}))})},a.onTreeNodeSelect=function(e,t){a.setState({selectedNodeId:t.selectedNodes[0].dataRef.key,selectedNodeType:t.selectedNodes[0].dataRef.type})},a.resetSelectedNodeValue=function(){a.setState({selectedNodeId:"",selectedNodeType:""})},a.onShowSizeChange=a.onShowSizeChange.bind(Object(g.a)(a)),a.formRef=i.a.createRef(),a.state={columns:[{title:"Id",dataIndex:"ID",key:"ID",width:60,render:function(e){return i.a.createElement(Lr,{ellipsis:!0},e)}},{title:"\u6743\u9650\u7c7b\u578b",dataIndex:"OperType",key:"OperType",align:"center",width:100,render:function(e,t){var a="\u53ef\u89c1";return 2===e&&(a="\u67e5\u8be2"),3===e&&(a="\u4fee\u6539"),i.a.createElement(Lr,{ellipsis:!0},a)}},{title:"\u5b9e\u4f8b\u540d\u79f0",dataIndex:"InstanceName",key:"InstanceName",align:"center",width:200,render:function(e){return i.a.createElement(Lr,{ellipsis:!0,style:{width:"100%"}},e)}},{title:"\u5e93\u540d\u79f0",dataIndex:"DatabaseName",key:"DatabaseName",align:"center",width:150,render:function(e){return i.a.createElement(Lr,{ellipsis:!0,style:{width:"100%"}},e)}},{title:"\u6388\u6743\u7528\u6237",dataIndex:"Username",key:"Username",align:"center",width:150,render:function(e){return i.a.createElement(Lr,{ellipsis:!0,style:{width:"100%"}},e)}},{title:"\u5269\u4f59\u6b21\u6570",dataIndex:"OperCount",key:"OperCount",align:"center",width:100,render:function(e){return i.a.createElement(Lr,{ellipsis:!0,style:{width:"100%"}},e)}},{title:"\u8fc7\u671f\u65f6\u95f4",dataIndex:"ValidTime",key:"ValidTime",align:"center",width:100,render:function(e){return i.a.createElement(Lr,{ellipsis:!0,style:{width:"100%"}},e)}},{title:"\u767d\u540d\u5355\u8868",dataIndex:"AllowTables",key:"AllowTables",align:"center",width:100,render:function(e){return i.a.createElement(Lr,{ellipsis:!0,style:{width:"100%"}},e)}},{title:"\u64cd\u4f5c",key:"operation",fixed:"right",align:"center",width:100,render:function(e,t){return i.a.createElement("div",null,i.a.createElement(de.a,{title:"\u786e\u5b9a\u5220\u9664\u8be5\u9879\u5185\u5bb9?",onConfirm:a.deleteUserAuth.bind(Object(g.a)(a),t),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},i.a.createElement(me.a,{type:"danger",size:"small"},"\u5220\u9664")))}}],tableLoading:!1,addAuthModalVisible:!1,tableData:[],usersData:[],instanceOptions:[],pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:function(e,t){return a.onShowSizeChange(e,t)},showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e,t){return a.changePage(e,t)}},expandedKeys:[],searchValue:"",autoExpandParent:!0,queryInstanceId:"",queryEmpId:"",queryOperType:"",treeData:[],selectedNodeId:"",selectedNodeType:""},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.getUserAuthData(),this.loadAllUsersData(),this.loadAllInstanceData()}},{key:"onShowSizeChange",value:function(e,t){var a=this,n=Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t});this.setState({pagination:n},function(){a.getUserAuthData()})}},{key:"getUserAuthData",value:function(){var e=this;this.setState({tableLoading:!0});var t,a={page:this.state.pagination.page,size:this.state.pagination.pageSize,instanceId:this.state.queryInstanceId.trim(),operType:this.state.queryOperType.trim(),empId:this.state.queryEmpId};(t=a,z("dms/authData",t)).then(function(t){if(0===t.code){var a=e.state.pagination;a.total=parseInt(t.data.total),a.page=parseInt(t.data.page),a.showTotal(parseInt(t.data.total)),e.setState({pagination:a}),e.setState({tableData:t.data.authData,tableLoading:!1})}else D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"loadAllUsersData",value:function(){var e=this;q(1,1e3).then(function(t){if(0===t.code){for(var a=t.data.users,n=[],r=0;r<a.length;r++)n.push(i.a.createElement(Mr,{key:a[r].empId,value:a[r].empId},a[r].username));e.setState({usersData:n})}else D.b.error(t.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"loadAllInstanceData",value:function(){var e,t=this;z("dms/instances/all",e).then(function(e){if(0===e.code){for(var a=[],n=[],r=0;r<e.data.length;r++)a.push(i.a.createElement(Mr,{key:e.data[r].InstanceId,value:e.data[r].InstanceId},e.data[r].InstanceAlias)),n.push({title:e.data[r].InstanceAlias,key:e.data[r].InstanceId,type:"instance",instance_type:"2"===e.data[r].InstanceType?"mysql":"sqlserver"});t.setState({instanceOptions:a,treeData:n})}else D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"handleAddAuth",value:function(){this.setState({addAuthModalVisible:!0})}},{key:"deleteUserAuth",value:function(e){var t,a=this;(t={id:""+e.ID},B("dms/userAuth",t)).then(function(e){0===e.code?(D.b.success("\u5220\u9664\u6210\u529f"),a.getUserAuthData()):D.b.error(e.msg)})}},{key:"render",value:function(){return i.a.createElement(Tr,{style:{background:"#fff",padding:20,margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["DMS","\u6743\u9650\u7ba1\u7406"]}),i.a.createElement(oe.a,{style:{padding:"0px 0px 10px 0px"}},i.a.createElement(ce.a,{span:5,className:"col-span"},i.a.createElement(ye.a,{placeholder:"\u8bf7\u9009\u62e9\u6240\u5c5e\u5b9e\u4f8b",style:{width:"100%"},onChange:this.handleInstanceChange},i.a.createElement(Mr,{value:""},"\u6240\u6709\u5b9e\u4f8b"),this.state.instanceOptions)),i.a.createElement(ce.a,{span:4,className:"col-span"},i.a.createElement(ye.a,{placeholder:"\u8bf7\u9009\u62e9\u6743\u9650\u7c7b\u578b",style:{width:"100%"},onChange:this.handleOperTypeChange},i.a.createElement(Mr,{value:2},"\u67e5\u8be2"),i.a.createElement(Mr,{value:3},"\u4fee\u6539"))),i.a.createElement(ce.a,{span:3,className:"col-span"},i.a.createElement(ye.a,{showSearch:!0,placeholder:"\u8bf7\u9009\u62e9\u7528\u6237",style:{width:"100%"},optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},onChange:this.handleEmpIdChange},i.a.createElement(Mr,{value:""},"\u6240\u6709\u7528\u6237"),this.state.usersData)),i.a.createElement(ce.a,{span:2,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},type:"primary",icon:i.a.createElement(ke.a,null),onClick:this.handleQuery},"\u67e5 \u8be2")),i.a.createElement(ce.a,{span:3,className:"col-span"},i.a.createElement(me.a,{style:{width:"100%"},icon:i.a.createElement(Ie.a,null),onClick:this.handleAddAuth.bind(this)},"\u6dfb\u52a0\u6743\u9650"))),i.a.createElement(E.a,{title:"\u7528\u6237\u6743\u9650\u8bbe\u7f6e",visible:this.state.addAuthModalVisible,destroyOnClose:!0,width:700,onOk:this.handleSubmitUserAuth,onCancel:this.handleUserAuthCancel,afterClose:this.resetSelectedNodeValue},i.a.createElement(oe.a,null,i.a.createElement(ce.a,{span:10},i.a.createElement("div",{style:{minHeight:450,maxHeight:"100%",overflowY:"scroll"}},i.a.createElement(jr.a,{showIcon:!0,loadData:this.onLoadData,showLine:!0,style:{maxHeight:"450px",overflowY:"scroll"},onSelect:this.onTreeNodeSelect},this.renderTreeNodes(this.state.treeData)))),i.a.createElement(ce.a,{span:2}),i.a.createElement(ce.a,{span:12},i.a.createElement(S.a,Object.assign({ref:this.formRef},{labelCol:{span:6},wrapperCol:{span:17}},{initialValues:{operType:2,operCount:5}}),i.a.createElement(S.a.Item,{label:"\u6307\u5b9a\u7528\u6237\uff1a",name:"empId",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7528\u6237!"}]},i.a.createElement(ye.a,{showSearch:!0,placeholder:"\u8bf7\u9009\u62e9\u7528\u6237",style:{width:"100%"},optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.usersData)),i.a.createElement(S.a.Item,{label:"\u5ba1\u6279\u4eba\uff1a",name:"approveEmpId",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5ba1\u6279\u4eba!"}]},i.a.createElement(ye.a,{showSearch:!0,placeholder:"\u8bf7\u9009\u62e9\u5ba1\u6279\u4eba",style:{width:"100%"},optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.usersData)),i.a.createElement(S.a.Item,{label:"\u6743\u9650\u7c7b\u578b\uff1a",name:"operType",rules:[{required:!0,message:"\u8bf7\u8bbe\u7f6e\u6743\u9650!"}]},i.a.createElement(se.a.Group,null,i.a.createElement(se.a,{value:2},"\u67e5\u8be2"),i.a.createElement(se.a,{value:3},"\u4fee\u6539"))),i.a.createElement(S.a.Item,{label:"\u7533\u8bf7\u539f\u56e0\uff1a",name:"authReason",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7533\u8bf7\u539f\u56e0!"}]},i.a.createElement(_r,{placeholder:"\u8bf7\u52a1\u5fc5\u8bb0\u5f55\u7528\u6237\u7533\u8bf7\u6743\u9650\u7684\u539f\u56e0",rows:3})),i.a.createElement(S.a.Item,{label:"\u64cd\u4f5c\u6b21\u6570\uff1a",name:"operCount",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u64cd\u4f5c\u6b21\u6570!"}]},i.a.createElement(ge.a,{min:1}),"\xa0\u6b21"),i.a.createElement(S.a.Item,{label:"\u6709\u6548\u65f6\u95f4\uff1a",name:"validTime",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6709\u6548\u65f6\u95f4!"}]},i.a.createElement(be.a,{showTime:!0})),i.a.createElement(S.a.Item,{label:"\u767d\u540d\u5355\u8868\uff1a",name:"allowTables",rules:[{required:!1}]},i.a.createElement(_r,{placeholder:"\u8f93\u5165\u5bf9\u7528\u6237\u5f00\u653e\u7684\u6570\u636e\u8868\uff0c\u591a\u8868\u4e4b\u95f4\u7528\u82f1\u6587\u5206\u53f7\u5206\u5272",rows:2})))))),i.a.createElement(ne.a,{columns:this.state.columns,dataSource:this.state.tableData,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,bordered:!0,size:"small"}))}}]),t}(r.Component),Nr=(a(1219),a(587),a(1221),a(1223),a(1224),b.a.Content),zr=jr.a.TreeNode,Pr=Z.a.Text,Vr=Z.a.Paragraph,Br=Ee.a.TabPane,qr={float:"left",width:"20%",height:"100%",padding:"0px 0px 0px 0px",borderRight:"solid 2px #acc3c0"},Yr={float:"right",width:"80%",height:"100%",padding:"0px 5px 0px 10px"},Fr=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).changePage=function(e){a.setState({pagination:Object(fe.a)({},a.state.pagination,{page:e,current:e})},function(){a.loadUserHistoryLog()})},a.onLoadData=function(e){return new Promise(function(t){e.props.children?t():"instance"===e.props.dataRef.type&&Cr({instanceId:e.props.dataRef.key}).then(function(n){if(0===n.code){for(var r=[],i=0;i<n.data.length;i++)r.push({title:n.data[i].DatabaseName,key:n.data[i].DatabaseId,type:"database",instance_type:n.data[i].InstanceType,isLeaf:!0});e.props.dataRef.children=r,a.setState({treeData:Object(wr.a)(a.state.treeData)}),t()}else D.b.error(n.msg)}).catch(function(e){D.b.error(e.toLocaleString())})})},a.renderTreeNodes=function(e){return e.map(function(e){var t="icondatabase";return"mysql"===e.instance_type&&(t="iconmysql"),"sqlserver"===e.instance_type&&(t="iconsqlserver"),e.children?i.a.createElement(zr,{icon:i.a.createElement(rt,{style:{fontSize:"20px",color:"#08c"},type:t}),title:e.title,key:e.key,dataRef:e},a.renderTreeNodes(e.children)):i.a.createElement(zr,Object.assign({icon:i.a.createElement(rt,{style:{fontSize:"20px",color:"#08c"},type:t}),key:e.key},e,{dataRef:e}))})},a.onTreeNodeSelect=function(e,t){if("instance"===t.selectedNodes[0].dataRef.type){var n="\u5b9e\u4f8b | "+t.selectedNodes[0].dataRef.title;a.setState({currentChoose:n})}if("database"===t.selectedNodes[0].dataRef.type){var r="\u6570\u636e\u5e93 | "+t.selectedNodes[0].dataRef.title;a.setState({currentChoose:r})}a.setState({selectedNodeId:t.selectedNodes[0].dataRef.key,selectedNodeType:t.selectedNodes[0].dataRef.type})},a.tabsOnChange=function(e){a.setState({activeKey:e})},a.sqlInputRef=i.a.createRef(),a.onShowSizeChange=a.onShowSizeChange.bind(Object(g.a)(a)),a.loadUserHistoryLog=a.loadUserHistoryLog.bind(Object(g.a)(a)),a.state={treeData:[],selectedNodeId:"",selectedNodeType:"",currentChoose:"-",activeKey:"1",sqlInput:"",sqlDescription:"",sqlExecuting:!1,execResultPanel:i.a.createElement(pr.a,{description:!1}),tableLoading:!1,pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","100"],onShowSizeChange:a.onShowSizeChange,showQuickJumper:!1,showTotal:function(e){return"\u5171 ".concat(e," \u6761")},pageSize:10,page:1,total:0,onChange:function(e){return a.changePage(e)}},sqlResultLog:[],sqlResultLogColumns:[{title:"ID",dataIndex:"ID",key:"ID",align:"center",width:"50px"},{title:"\u5e93\u540d",dataIndex:"DatabaseName",key:"DatabaseName",align:"center",width:"150px"},{title:"\u6267\u884c\u65f6\u95f4",dataIndex:"StartTime",key:"StartTime",width:"200px",align:"center"},{title:"SQL",dataIndex:"SqlContent",key:"SqlContent",ellipsis:!0,width:"200px",align:"center",render:function(e){return i.a.createElement(k.a,{placement:"topLeft",content:i.a.createElement(Vr,{copyable:!0},e),title:"\u5f53\u524dSQL"},e)}},{title:"\u8017\u65f6",dataIndex:"Duration",key:"Duration",width:"100px",align:"center",render:function(e){return e+" ms"}},{title:"\u6267\u884c\u72b6\u6001",dataIndex:"ExecStatus",key:"ExecStatus",width:"100px",fixed:"right",align:"center",render:function(e){var t=i.a.createElement(ca.a,{color:"#f50"},"\u5931\u8d25");return 1===e&&(t=i.a.createElement(ca.a,{color:"#2db7f5"},"\u6210\u529f")),t}},{title:"\u5f02\u5e38\u4fe1\u606f",dataIndex:"ExceptionOutput",key:"ExceptionOutput",ellipsis:!0,fixed:"right",align:"center",width:"100px",render:function(e){return""!==e?i.a.createElement(k.a,{placement:"topLeft",content:i.a.createElement(Vr,{copyable:!0},e),title:"\u5f02\u5e38\u8be6\u60c5",trigger:"click"},i.a.createElement(me.a,{type:"link",size:"small"},"\u70b9\u51fb\u67e5\u770b")):"\u65e0\u5f02\u5e38"}}]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.loadAllInstanceData(),this.loadUserHistoryLog()}},{key:"loadAllInstanceData",value:function(){var e,t=this;z("dms/userInstanceData",e).then(function(e){if(0===e.code){for(var a=[],n=0;n<e.data.length;n++)a.push({title:e.data[n].InstanceName,key:e.data[n].InstanceId,type:"instance",instance_type:"2"===e.data[n].InstanceType?"mysql":"sqlserver"});t.setState({treeData:a})}else D.b.error(e.msg)}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"loadUserHistoryLog",value:function(){var e=this;this.setState({tableLoading:!0});var t,a={page:this.state.pagination.page,pageSize:this.state.pagination.pageSize};(t=a,z("dms/userLog",t)).then(function(t){if(0===t.code){var a=e.state.pagination;a.total=parseInt(t.data.total),a.page=parseInt(t.data.page),a.showTotal(parseInt(t.data.total)),e.setState({pagination:Object(fe.a)({},a)}),e.setState({sqlResultLog:t.data.log})}else D.b.error(t.msg);e.setState({tableLoading:!1})})}},{key:"onShowSizeChange",value:function(e,t){var a=this;this.setState({pagination:Object(fe.a)({},this.state.pagination,{page:1,current:1,pageSize:t})},function(){a.loadUserHistoryLog()})}},{key:"sqlDescriptionChange",value:function(e){this.setState({sqlDescription:e.target.value})}},{key:"renderSqlQueryResultTable",value:function(e,t){if(null===e||null===t)return i.a.createElement(Pr,null,"\u672a\u67e5\u8be2\u5230\u6570\u636e\uff0c\u8bf7\u67e5\u770b\u300e\u6267\u884c\u5386\u53f2\u300f\u68c0\u67e5\u662f\u5426\u5b58\u5728\u5f02\u5e38");for(var a=[],n=0;n<e.length;n++)a.push({title:e[n],dataIndex:e[n]});return i.a.createElement(ne.a,{bordered:!0,columns:a,dataSource:t,size:"small",scroll:{x:"max-content"},footer:function(e){var t=e.length;return i.a.createElement("span",null,"\u6570\u636e\u884c\u6570: ",t)}})}},{key:"renderSqlExecResultPanel",value:function(e,t,a,n){var r="green",l="\u6267\u884c\u6210\u529f",s="";return 0===e&&(r="red",l="\u6267\u884c\u5931\u8d25",s=i.a.createElement("span",{style:{color:"red"}},"\u5f02\u5e38\u4fe1\u606f\uff1a",t)),i.a.createElement(Ft.a,null,i.a.createElement("span",null,"\u5f71\u54cd\u884c\u6570\uff1a",a)," ",i.a.createElement("br",null),i.a.createElement("span",{style:{color:r}},l)," ",i.a.createElement("br",null),s," ",i.a.createElement("br",null),i.a.createElement("span",null,"\u6267\u884c\u65f6\u95f4\uff1a",n," ms"))}},{key:"submitSql",value:function(){var e=this;if("database"===this.state.selectedNodeType)if(""!==this.state.sqlInput.trim()){var t,a={selectedNodeId:this.state.selectedNodeId,selectedNodeType:this.state.selectedNodeType,sqlInput:this.state.sqlInput,sqlDescription:this.state.sqlDescription};D.b.info("\u63d0\u4ea4\u6267\u884c\u4e2d..."),this.setState({sqlExecuting:!0}),(t=a,P("dms/userExecSQL",t)).then(function(t){if(0===t.code){if(1===t.data.execStatus?D.b.success("\u6267\u884c\u6210\u529f"):D.b.error("\u6267\u884c\u5931\u8d25"),"select"===t.data.sqlType){var a=e.renderSqlQueryResultTable(t.data.queryColumns,t.data.queryResult);e.setState({execResultPanel:a})}else{var n=e.renderSqlExecResultPanel(t.data.execStatus,t.data.exceptionOutput,t.data.effectRows,t.data.duration);e.setState({execResultPanel:n})}e.setState({sqlExecuting:!1})}else D.b.error(t.msg),e.setState({sqlExecuting:!1});e.loadUserHistoryLog()})}else D.b.warn("\u8bf7\u586b\u5199\u5f85\u6267\u884c\u7684SQL\u8bed\u53e5\uff01");else D.b.warn("\u8bf7\u9009\u62e9\u5177\u4f53\u7684\u6570\u636e\u5e93\uff01")}},{key:"render",value:function(){var e=this;return i.a.createElement(Nr,{style:{background:"#fff",padding:20,margin:0,height:"100%"}},i.a.createElement(Oe,{pathData:["DMS","\u6570\u636e\u7ba1\u7406"]}),i.a.createElement("div",{style:{height:"95%"}},i.a.createElement("div",{style:qr},this.state.treeData.length>0?i.a.createElement(jr.a,{showIcon:!0,loadData:this.onLoadData,showLine:!0,style:{maxHeight:"100%",overflow:"scroll"},onSelect:this.onTreeNodeSelect},this.renderTreeNodes(this.state.treeData)):i.a.createElement(pr.a,{description:"\u6682\u65e0\u6388\u6743\u5b9e\u4f8b"})),i.a.createElement("div",{style:Yr},i.a.createElement(oe.a,{style:{marginBottom:10}},i.a.createElement(Pr,{strong:!0,style:{color:"rgba(0, 102, 192, 0.86)"}},"\u4f60\u5f53\u524d\u9009\u62e9\uff1a",this.state.currentChoose)),i.a.createElement("div",null,i.a.createElement(Pr,{strong:!0},"\u5728\u6b64\u8f93\u5165SQL: ")),i.a.createElement(oe.a,{style:{height:"120px"}},i.a.createElement(ce.a,{span:24},i.a.createElement(An.Controlled,{className:"sqlEditor",ref:this.sqlInputRef,options:{mode:"text/x-mysql",showCursorWhenSelecting:!0,option:{autofocus:!0},lineWrapping:!0},value:this.state.sqlInput,onBeforeChange:function(t,a,n){e.setState({sqlInput:n})}}))),i.a.createElement(oe.a,{style:{marginTop:5}},i.a.createElement(me.a,{type:"primary",loading:this.state.sqlExecuting,onClick:this.submitSql.bind(this)},"\u63d0\u4ea4\u6267\u884c")),i.a.createElement(oe.a,{style:{marginBottom:10}},i.a.createElement(ce.a,{span:24},i.a.createElement(Ee.a,{defaultActiveKey:"1",activeKey:this.state.activeKey,size:"small",onChange:this.tabsOnChange},i.a.createElement(Br,{tab:"\u6267\u884c\u7ed3\u679c",key:"1"},this.state.execResultPanel),i.a.createElement(Br,{tab:i.a.createElement("span",null,"\u6267\u884c\u5386\u53f2"," ",i.a.createElement(Cn.a,{type:"reload",onClick:this.loadUserHistoryLog,style:{marginLeft:10}})),key:"2"},i.a.createElement(ne.a,{size:"small",dataSource:this.state.sqlResultLog,columns:this.state.sqlResultLogColumns,scroll:{x:"max-content"},pagination:this.state.pagination,loading:this.state.tableLoading,bordered:!0}))))))))}}]),t}(r.Component),Ur=b.a.Content,Kr=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={isSuperAdmin:!1},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){var e=this;z("user/tokenRefresh").then(function(t){if(0===t.code){localStorage.setItem("ops_token",t.data.token);var a=ua()(t.data.token);e.setState({isSuperAdmin:a.userInfo.isSuperAdmin})}}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"render",value:function(){var e=this;return i.a.createElement(Ur,{style:{height:"100%",minWidth:"900px",overflow:"scroll"}},i.a.createElement(p.a,null,i.a.createElement(f.a,{exact:!0,path:"/admin",component:ae}),i.a.createElement(f.a,{path:"/admin/cloud_resource/cloud_server",render:function(){return i.a.createElement(pt,{isSuperAdmin:e.state.isSuperAdmin})}}),i.a.createElement(f.a,{path:"/admin/cloud_resource/cloud_rds",render:function(){return i.a.createElement(St,{isSuperAdmin:e.state.isSuperAdmin})}}),i.a.createElement(f.a,{path:"/admin/cloud_resource/cloud_kv",render:function(){return i.a.createElement(wt,{isSuperAdmin:e.state.isSuperAdmin})}}),i.a.createElement(f.a,{path:"/admin/cloud_resource/cloud_slb",render:function(){return i.a.createElement(_t,{isSuperAdmin:e.state.isSuperAdmin})}}),i.a.createElement(f.a,{path:"/admin/cloud_resource/cloud_account",render:function(){return i.a.createElement(Vt,{isSuperAdmin:e.state.isSuperAdmin})}}),i.a.createElement(f.a,{path:"/admin/cloud_resource/cloud_other",render:function(){return i.a.createElement(dn,{isSuperAdmin:e.state.isSuperAdmin})}}),i.a.createElement(f.a,{path:"/admin/task",render:function(){return i.a.createElement(Ia,{isSuperAdmin:e.state.isSuperAdmin})}}),i.a.createElement(f.a,{path:"/admin/dms/instance_manage",render:function(){return i.a.createElement(xr,{isSuperAdmin:e.state.isSuperAdmin})}}),i.a.createElement(f.a,{path:"/admin/dms/auth_manage",render:function(){return i.a.createElement(Rr,{isSuperAdmin:e.state.isSuperAdmin})}}),i.a.createElement(f.a,{path:"/admin/dms/data_manage",render:function(){return i.a.createElement(Fr,{isSuperAdmin:e.state.isSuperAdmin})}}),i.a.createElement(f.a,{path:"/admin/cicd",render:function(){return i.a.createElement(jn,null)}}),i.a.createElement(f.a,{path:"/admin/k8s_cluster",render:function(){return i.a.createElement(vr,null)}}),i.a.createElement(f.a,{path:"/admin/data/syncAliyun",component:nn}),i.a.createElement(f.a,{path:"/admin/permission/users",component:ja}),i.a.createElement(f.a,{path:"/admin/permission/roles",component:Ka}),i.a.createElement(f.a,{path:"/admin/permission/permissions",component:Wa}),i.a.createElement(f.a,{path:"/admin/permission/password",component:Xa}),i.a.createElement(f.a,{path:"/admin/system/setting",component:fn}),i.a.createElement(f.a,{path:"/admin/system/user_feedback",component:vn}),i.a.createElement(f.a,{path:"/admin/logout",component:bn})))}}]),t}(r.Component),Hr=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).onExit=function(){a.setState(function(){return{stepsEnabled:!1}})},a.handleSiderMenu=a.handleSiderMenu.bind(Object(g.a)(a)),a.state={collapsed:!1},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"handleSiderMenu",value:function(){this.setState({collapsed:!this.state.collapsed})}},{key:"render",value:function(){return i.a.createElement(h.a,null,i.a.createElement(b.a,{style:{minHeight:"100vh"}},i.a.createElement(W,{menuCollapsed:this.state.collapsed}),i.a.createElement(b.a,null,i.a.createElement(H,{menuCollapsed:this.state.collapsed,handleSiderMenu:this.handleSiderMenu}),i.a.createElement(f.a,{path:"/admin",component:Kr}),i.a.createElement(ee,null))))}}]),t}(r.Component),Jr=Object(y.a)(Hr),Gr=(a(1225),Z.a.Text),Qr=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).handleEnterKey=function(e){13===e.nativeEvent.keyCode&&a.formRef.current.validateFields().then(function(e){a.handleSubmit(e)})},a.handleSubmit=a.handleSubmit.bind(Object(g.a)(a)),a.formRef=i.a.createRef(),a.state={currentYear:(new Date).getFullYear()},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=new URLSearchParams(this.props.location.search).get("code");void 0!==e&&null!==e&&(401===(e=parseInt(e))&&D.b.error("token\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55!",4),403===e&&D.b.error("\u7528\u6237\u4e0d\u5b58\u5728\u6216\u88ab\u7981\u7528\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458!",4))}},{key:"handleSubmit",value:function(e){var t,a=this;(t=e,P("user/login",t)).then(function(e){0===e.code?(localStorage.setItem("ops_token",e.data.token),D.b.success("\u6b22\u8fce\u4f7f\u7528\u8fd0\u7ef4\u5e73\u53f0\uff01"),a.props.history.push("/admin")):(a.formRef.current.setFieldsValue({password:""}),D.b.error(e.msg))}).catch(function(e){D.b.error(e.toLocaleString())})}},{key:"onFinishFailed",value:function(e){console.log("Failed:",e)}},{key:"render",value:function(){var e=i.a.createElement("div",null,i.a.createElement(S.a,{ref:this.formRef,onFinish:this.handleSubmit,onFinishFailed:this.onFinishFailed,className:"login-form"},i.a.createElement(S.a.Item,{name:"username",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u60a8\u7684\u6ce8\u518c\u90ae\u7bb1!"}]},i.a.createElement(O.a,{size:"large",prefix:i.a.createElement(Cn.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"\u7528\u6237\u8d26\u53f7",onKeyPress:this.handleEnterKey})),i.a.createElement(S.a.Item,{name:"password",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u60a8\u7684\u5bc6\u7801!"}]},i.a.createElement(O.a,{size:"large",prefix:i.a.createElement(Cn.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"\u7528\u6237\u5bc6\u7801",onKeyPress:this.handleEnterKey})),i.a.createElement(S.a.Item,null,i.a.createElement(me.a,{type:"primary",block:!0,className:"login-form-button",size:"large",htmlType:"submit"},"\u767b \u5f55"))));return i.a.createElement("div",null,i.a.createElement(oe.a,{style:{height:"15vh",paddingTop:"5vh"}},i.a.createElement(ce.a,{span:9}),i.a.createElement(ce.a,{span:6,style:{padding:"0px 30px"}},i.a.createElement("span",{className:"login-logo"}),i.a.createElement("span",{className:"login-logo-text"},"\u8fd0\u7ef4\u5e73\u53f0")),i.a.createElement(ce.a,{span:9})),i.a.createElement(oe.a,{style:{height:"40vh"}},i.a.createElement(ce.a,{span:9}),i.a.createElement(ce.a,{span:6,style:{paddingTop:40}},e),i.a.createElement(ce.a,{span:9})),i.a.createElement(oe.a,{style:{height:"30vh"}}),i.a.createElement(oe.a,{style:{height:"15vh",textAlign:"center",paddingTop:50,display:"block"}},"\xa92019-",this.state.currentYear," Created by \xa0",i.a.createElement(k.a,{content:i.a.createElement("div",{className:"wechat"})},i.a.createElement(Gr,{underline:!0},"KevinYang"))))}}]),t}(r.Component),Wr=(a(1227),a(409)),Zr=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).backToLogin=a.backToLogin.bind(Object(g.a)(a)),a.state={},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"backToLogin",value:function(){this.props.history.push("/admin")}},{key:"render",value:function(){return i.a.createElement(Wr.a,{status:"500",title:"\u5f02\u5e38\u63d0\u9192",subTitle:"\u670d\u52a1\u5f02\u5e38\uff0c\u8bf7\u8054\u7cfb\u8fd0\u7ef4\u4e2d\u5fc3\u5904\u7406",style:{height:"100vh"},extra:i.a.createElement(me.a,{type:"primary",onClick:this.backToLogin},"\u8fd4\u56de\u4e3b\u9875")})}}]),t}(r.Component),$r=(r.Component,function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).backToLogin=a.backToLogin.bind(Object(g.a)(a)),a.state={},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"backToLogin",value:function(){this.props.history.push("/admin")}},{key:"render",value:function(){return i.a.createElement(Wr.a,{status:"404",title:"404",subTitle:"\u8bbf\u95ee\u7684\u9875\u9762\u4e0d\u5b58\u5728",style:{height:"100vh"},extra:i.a.createElement(me.a,{type:"primary",onClick:this.backToLogin},"\u8fd4\u56de\u4e3b\u9875")})}}]),t}(r.Component)),Xr=function(e){function t(){return Object(o.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{id:"router",style:{backgroundColor:"#f0f2f5"}},i.a.createElement(h.a,null,i.a.createElement(p.a,null,i.a.createElement(f.a,{path:"/",component:Qr,exact:!0}),i.a.createElement(f.a,{path:"/admin",component:Jr}),i.a.createElement(f.a,{path:"/login",component:Qr}),i.a.createElement(f.a,{component:$r}),i.a.createElement(f.a,{path:"/exception500",component:Zr}))))}}]),t}(r.Component),ei=function(e){function t(){return Object(o.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"App"},i.a.createElement(Xr,null))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ti=a(663);s.a.render(i.a.createElement(n.b,{locale:ti.a},i.a.createElement(ei,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},309:function(e,t,a){},672:function(e,t,a){e.exports=a(1230)},939:function(e,t,a){}},[[672,2,1]]]);
//# sourceMappingURL=main.159f88fa.chunk.js.map